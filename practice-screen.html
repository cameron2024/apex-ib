<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practice ‚Äî IB Mastery</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #F7F6F3;
    --surface: #FFFFFF;
    --border: #E8E5DF;
    --border-strong: #D4CFC6;
    --text-primary: #1A1814;
    --text-secondary: #6B6560;
    --text-tertiary: #9E9890;
    --accent: #1A1814;
    --accent-blue: #2563EB;
    --accent-green: #16A34A;
    --accent-amber: #D97706;
    --accent-red: #DC2626;
    --recording: #EF4444;
    --sidebar-width: 240px;
    --radius: 10px;
    --radius-sm: 6px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
  }

  /* SIDEBAR */
  .sidebar {
    width: var(--sidebar-width);
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    z-index: 10;
  }

  .sidebar-logo {
    padding: 20px 20px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-mark {
    width: 32px;
    height: 32px;
    background: var(--text-primary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .logo-mark svg { width: 16px; height: 16px; }

  .logo-name {
    font-family: 'DM Serif Display', serif;
    font-size: 17px;
    letter-spacing: -0.3px;
    color: var(--text-primary);
  }

  .sidebar-nav {
    padding: 12px 10px;
    flex: 1;
    overflow-y: auto;
  }

  .nav-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    padding: 8px 10px 6px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 13.5px;
    font-weight: 400;
    color: var(--text-secondary);
    transition: all 0.15s ease;
    text-decoration: none;
    margin-bottom: 1px;
  }

  .nav-item:hover { background: var(--bg); color: var(--text-primary); }
  .nav-item.active { background: var(--bg); color: var(--text-primary); font-weight: 500; }

  .nav-item svg { width: 15px; height: 15px; flex-shrink: 0; opacity: 0.7; }
  .nav-item.active svg { opacity: 1; }

  .nav-badge {
    margin-left: auto;
    font-size: 11px;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text-tertiary);
    padding: 1px 6px;
    border-radius: 20px;
  }

  .nav-item.active .nav-badge {
    background: var(--text-primary);
    color: white;
    border-color: var(--text-primary);
  }

  .sidebar-bottom {
    padding: 12px 10px;
    border-top: 1px solid var(--border);
  }

  .user-card {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    cursor: pointer;
  }

  .user-avatar {
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
  }

  .user-info { flex: 1; overflow: hidden; }
  .user-name { font-size: 13px; font-weight: 500; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .user-plan { font-size: 11px; color: var(--text-tertiary); }

  /* MAIN */
  .main {
    margin-left: var(--sidebar-width);
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* TOP BAR */
  .topbar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 28px;
    height: 52px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 5;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text-tertiary);
  }

  .breadcrumb span { color: var(--text-primary); font-weight: 500; }
  .breadcrumb-sep { font-size: 11px; }

  .topbar-right {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .topic-pill {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px 4px 6px;
    background: #EFF6FF;
    border: 1px solid #BFDBFE;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    color: var(--accent-blue);
  }

  .topic-dot { width: 8px; height: 8px; background: var(--accent-blue); border-radius: 50%; }

  .btn-ghost {
    background: none;
    border: 1px solid var(--border);
    padding: 5px 12px;
    border-radius: var(--radius-sm);
    font-size: 12.5px;
    font-family: 'DM Sans', sans-serif;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .btn-ghost:hover { border-color: var(--border-strong); color: var(--text-primary); }

  /* CONTENT */
  .content {
    flex: 1;
    padding: 28px;
    max-width: 960px;
    width: 100%;
    margin: 0 auto;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* PROGRESS BAR */
  .session-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
  }

  .session-progress {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .progress-track {
    flex: 1;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--text-primary);
    border-radius: 2px;
    width: 35%;
    transition: width 0.5s ease;
  }

  .progress-label {
    font-size: 12px;
    color: var(--text-tertiary);
    white-space: nowrap;
  }

  .session-stats {
    display: flex;
    gap: 16px;
  }

  .stat-pill {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    color: var(--text-secondary);
  }

  .stat-dot { width: 7px; height: 7px; border-radius: 50%; }
  .stat-dot.green { background: var(--accent-green); }
  .stat-dot.red { background: var(--accent-red); }
  .stat-dot.amber { background: var(--accent-amber); }

  /* QUESTION CARD */
  .question-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px 32px;
    margin-bottom: 16px;
    position: relative;
  }

  .question-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
  }

  .q-tag {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 4px;
  }

  .q-tag.accounting { background: #EFF6FF; color: #2563EB; }
  .q-tag.difficulty { background: #FEF3C7; color: #B45309; }
  .q-tag.followup { background: #FEF2F2; color: #B91C1C; }

  .q-number {
    font-size: 12px;
    color: var(--text-tertiary);
    margin-left: auto;
  }

  .question-text {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    line-height: 1.45;
    color: var(--text-primary);
    letter-spacing: -0.3px;
  }

  .question-hint {
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 8px;
    font-size: 12.5px;
    color: var(--text-tertiary);
    font-style: italic;
  }

  .hint-icon { font-size: 14px; flex-shrink: 0; }

  /* ANSWER MODES TOGGLE */
  .input-mode-toggle {
    display: flex;
    align-items: center;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 4px;
    margin-bottom: 16px;
    width: fit-content;
  }

  .mode-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 7px 16px;
    border-radius: 7px;
    border: none;
    background: none;
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    color: var(--text-tertiary);
    cursor: pointer;
    transition: all 0.15s;
  }

  .mode-btn.active {
    background: var(--text-primary);
    color: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }

  .mode-btn svg { width: 14px; height: 14px; }

  /* ANSWER PANELS */
  .answer-panel { display: none; }
  .answer-panel.visible { display: block; animation: fadeIn 0.2s ease; }

  /* TEXT INPUT */
  .text-input-area {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: border-color 0.15s;
  }

  .text-input-area:focus-within { border-color: var(--text-primary); }

  .answer-textarea {
    width: 100%;
    min-height: 160px;
    padding: 18px 20px;
    border: none;
    outline: none;
    font-size: 14.5px;
    font-family: 'DM Sans', sans-serif;
    color: var(--text-primary);
    line-height: 1.7;
    resize: none;
    background: transparent;
  }

  .answer-textarea::placeholder { color: var(--text-tertiary); }

  .textarea-footer {
    padding: 10px 16px;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .word-count { font-size: 12px; color: var(--text-tertiary); }

  /* VOICE INPUT */
  .voice-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 36px 32px;
    text-align: center;
  }

  .record-btn-wrap { position: relative; display: inline-block; margin-bottom: 20px; }

  .pulse-ring {
    position: absolute;
    inset: -12px;
    border-radius: 50%;
    border: 2px solid var(--recording);
    opacity: 0;
    animation: none;
  }

  .pulse-ring.active { animation: pulse-ring 1.5s ease-out infinite; }

  @keyframes pulse-ring {
    0% { transform: scale(0.9); opacity: 0.6; }
    100% { transform: scale(1.4); opacity: 0; }
  }

  .record-btn {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    border: none;
    background: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    position: relative;
    z-index: 1;
  }

  .record-btn:hover { transform: scale(1.04); }
  .record-btn.recording { background: var(--recording); }
  .record-btn svg { width: 24px; height: 24px; color: white; }

  .record-status { font-size: 14px; font-weight: 500; color: var(--text-primary); margin-bottom: 6px; }
  .record-sub { font-size: 12.5px; color: var(--text-tertiary); }

  .waveform {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    height: 36px;
    margin: 16px 0;
  }

  .wave-bar {
    width: 3px;
    background: var(--border-strong);
    border-radius: 2px;
    transition: height 0.1s ease;
  }

  .wave-bar.active {
    background: var(--recording);
    animation: wave 0.8s ease-in-out infinite;
  }

  .wave-bar:nth-child(2) { animation-delay: 0.1s; }
  .wave-bar:nth-child(3) { animation-delay: 0.2s; }
  .wave-bar:nth-child(4) { animation-delay: 0.3s; }
  .wave-bar:nth-child(5) { animation-delay: 0.15s; }
  .wave-bar:nth-child(6) { animation-delay: 0.05s; }
  .wave-bar:nth-child(7) { animation-delay: 0.25s; }

  @keyframes wave {
    0%, 100% { height: 6px; }
    50% { height: 28px; }
  }

  /* SUBMIT ROW */
  .submit-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 16px;
  }

  .btn-primary {
    background: var(--text-primary);
    color: white;
    border: none;
    padding: 10px 22px;
    border-radius: var(--radius-sm);
    font-size: 13.5px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 7px;
    transition: all 0.15s;
  }

  .btn-primary:hover { background: #333; }
  .btn-primary svg { width: 14px; height: 14px; }

  .btn-skip {
    background: none;
    border: none;
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 10px 12px;
    transition: color 0.15s;
  }

  .btn-skip:hover { color: var(--text-secondary); }

  /* FEEDBACK STYLE TOGGLE - removed */

  /* FEEDBACK PANEL */
  .feedback-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-top: 20px;
    display: none;
    animation: slideUp 0.3s ease;
  }

  .feedback-panel.visible { display: block; }

  @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* VERDICT HEADER */
  .verdict-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .verdict-badge {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
    font-weight: 700;
    padding: 8px 16px;
    border-radius: 99px;
    border: 2px solid currentColor;
  }

  .verdict-badge.mastered { color: var(--accent-green); background: #F0FDF4; }
  .verdict-badge.needs-work { color: var(--accent-amber); background: #FFFBEB; }
  .verdict-badge.miss { color: var(--accent-red); background: #FEF2F2; }

  .verdict-score-wrap {
    display: flex;
    align-items: baseline;
    gap: 3px;
  }

  .verdict-score {
    font-family: 'DM Serif Display', serif;
    font-size: 44px;
    letter-spacing: -1px;
    line-height: 1;
    color: var(--text-primary);
  }

  .verdict-score-sub {
    font-size: 16px;
    color: var(--text-tertiary);
    margin-bottom: 4px;
  }

  /* SCORE DIMENSIONS */
  .score-dims-row {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .dim-item { display: flex; flex-direction: column; gap: 5px; }

  .dim-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
  }

  .dim-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); }
  .dim-score { font-size: 12px; font-weight: 700; color: var(--text-primary); }

  .dim-bar-track {
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }

  .dim-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.9s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dim-bar-fill.high { background: var(--accent-green); }
  .dim-bar-fill.mid { background: var(--accent-amber); }
  .dim-bar-fill.low { background: var(--accent-red); }

  /* FEEDBACK CONTENT */
  .feedback-body {
    padding: 22px 24px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    border-bottom: 1px solid var(--border);
  }

  .feedback-section-title {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    margin-bottom: 8px;
  }

  .feedback-points { display: flex; flex-direction: column; gap: 8px; }

  .feedback-point {
    display: flex;
    gap: 10px;
    font-size: 13.5px;
    line-height: 1.65;
    color: var(--text-secondary);
    align-items: flex-start;
  }

  .point-icon { font-size: 13px; flex-shrink: 0; margin-top: 2px; }

  .feedback-point strong { color: var(--text-primary); font-weight: 600; }

  /* MODEL ANSWER BOX */
  .model-answer-box {
    background: #F8F7F4;
    border: 1px solid var(--border);
    border-left: 3px solid var(--text-primary);
    border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    padding: 14px 16px;
    font-size: 13.5px;
    line-height: 1.7;
    color: var(--text-primary);
  }

  /* NEXT QUESTION / ACTIONS */
  .next-section {
    padding: 18px 24px;
    background: #FAFAF8;
  }

  .next-label {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .next-label-badge {
    background: #FEE2E2;
    color: #B91C1C;
    padding: 2px 7px;
    border-radius: 3px;
    font-size: 10px;
  }

  .next-label-badge.mastered-badge {
    background: #D1FAE5;
    color: #065F46;
  }

  .next-q-preview {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 16px;
    margin-bottom: 14px;
  }

  .next-q-text {
    font-family: 'DM Serif Display', serif;
    font-size: 15px;
    color: var(--text-primary);
    margin-bottom: 5px;
    line-height: 1.4;
  }

  .next-q-reason {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .next-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  .btn-mark-mastered {
    background: none;
    border: 1.5px solid var(--accent-green);
    color: var(--accent-green);
    padding: 9px 16px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-mark-mastered:hover {
    background: var(--accent-green);
    color: white;
  }

  /* MASTERY CELEBRATION */
  .mastery-celebration {
    display: none;
    background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
    border: 1.5px solid #86EFAC;
    border-radius: var(--radius);
    padding: 20px 24px;
    margin-top: 14px;
    text-align: center;
    animation: slideUp 0.4s ease;
  }

  .mastery-celebration.visible { display: block; }
  .mastery-celebration-icon { font-size: 32px; margin-bottom: 8px; }
  .mastery-celebration-title { font-family: 'DM Serif Display', serif; font-size: 20px; color: #15803D; margin-bottom: 4px; }
  .mastery-celebration-sub { font-size: 13px; color: #16A34A; }

  /* INTERVIEW MODE TOGGLE */
  .interview-mode-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 11px 16px;
    margin-bottom: 14px;
    transition: border-color 0.3s, background 0.3s;
  }

  .interview-mode-bar.interview-active {
    border-color: #1A1814;
    background: #FAFAF8;
  }

  .interview-mode-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .interview-mode-icon {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: var(--bg);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.3s;
  }

  .interview-active .interview-mode-icon {
    background: var(--text-primary);
    border-color: var(--text-primary);
  }

  .interview-mode-text { display: flex; flex-direction: column; gap: 1px; }
  .interview-mode-title { font-size: 13px; font-weight: 600; color: var(--text-primary); }
  .interview-mode-sub { font-size: 11.5px; color: var(--text-tertiary); }

  .interview-mode-right { display: flex; align-items: center; gap: 12px; }

  /* DURATION PICKER */
  .duration-picker {
    display: flex;
    align-items: center;
    gap: 4px;
    opacity: 0.35;
    pointer-events: none;
    transition: opacity 0.2s;
  }

  .duration-picker.enabled { opacity: 1; pointer-events: all; }
  .duration-label { font-size: 12px; color: var(--text-secondary); }

  .duration-options {
    display: flex;
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
  }

  .dur-btn {
    padding: 4px 10px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    border: none;
    background: none;
    cursor: pointer;
    color: var(--text-tertiary);
    transition: all 0.15s;
  }

  .dur-btn:not(:last-child) { border-right: 1px solid var(--border); }
  .dur-btn.active { background: var(--text-primary); color: white; }

  /* TOGGLE SWITCH */
  .toggle-switch {
    width: 38px;
    height: 22px;
    background: var(--border-strong);
    border-radius: 11px;
    position: relative;
    cursor: pointer;
    transition: background 0.25s;
    flex-shrink: 0;
    border: none;
    outline: none;
  }

  .toggle-switch.on { background: var(--text-primary); }

  .toggle-knob {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }

  .toggle-switch.on .toggle-knob { transform: translateX(16px); }

  /* QUESTION CARD COUNTDOWN STATE */
  .question-card { transition: all 0.4s ease; }

  .question-card.fading {
    animation: none;
  }

  .countdown-ring-wrap {
    display: none;
    align-items: center;
    gap: 8px;
    margin-bottom: 14px;
  }

  .countdown-ring-wrap.visible { display: flex; }

  .countdown-ring {
    position: relative;
    width: 36px;
    height: 36px;
    flex-shrink: 0;
  }

  .countdown-ring svg { transform: rotate(-90deg); }
  .countdown-ring-track { fill: none; stroke: var(--border); stroke-width: 3; }
  .countdown-ring-fill {
    fill: none;
    stroke: var(--text-primary);
    stroke-width: 3;
    stroke-linecap: round;
    stroke-dasharray: 88;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 1s linear, stroke 0.3s;
  }

  .countdown-ring-fill.urgent { stroke: var(--accent-red); }

  .countdown-number-center {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--text-primary);
    transition: color 0.3s;
  }

  .countdown-number-center.urgent { color: var(--accent-red); }

  .countdown-text { font-size: 12.5px; color: var(--text-secondary); }
  .countdown-text strong { color: var(--text-primary); }

  /* QUESTION CARD WHEN HIDDEN IN INTERVIEW MODE */
  .question-card.interview-hidden {
    background: #F0EFE9;
    border-color: var(--border);
    cursor: default;
  }

  .question-card.interview-hidden .question-text,
  .question-card.interview-hidden .question-hint {
    display: none;
  }

  .question-card.interview-hidden .question-meta { margin-bottom: 0; }

  .hidden-question-msg {
    display: none;
    align-items: center;
    gap: 10px;
    padding: 12px 0 4px;
    font-size: 13.5px;
    color: var(--text-tertiary);
  }

  .hidden-question-msg.visible { display: flex; }

  .peek-btn {
    background: none;
    border: 1px solid var(--border-strong);
    padding: 4px 10px;
    border-radius: 5px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    color: var(--text-secondary);
    cursor: pointer;
    margin-left: auto;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .peek-btn:hover { border-color: var(--text-primary); color: var(--text-primary); }

  /* DISSOLVE ANIMATION */
  @keyframes dissolve-out {
    0% { opacity: 1; filter: blur(0px); }
    70% { opacity: 0.4; filter: blur(1px); }
    100% { opacity: 0; filter: blur(3px); pointer-events: none; }
  }

  @keyframes dissolve-in {
    0% { opacity: 0; filter: blur(3px); }
    100% { opacity: 1; filter: blur(0px); }
  }

  .question-text.dissolving {
    animation: dissolve-out 0.8s ease forwards;
  }

  .question-hint.dissolving {
    animation: dissolve-out 0.6s ease 0.1s forwards;
  }

  /* LOADING STATE */
  .analyzing-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(247,246,243,0.85);
    backdrop-filter: blur(4px);
    z-index: 100;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
  }

  .analyzing-overlay.visible { display: flex; }

  .analyzing-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--text-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

  .analyzing-text { font-size: 15px; font-weight: 500; color: var(--text-primary); }
  .analyzing-sub { font-size: 13px; color: var(--text-tertiary); }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .sidebar { display: none; }
    .main { margin-left: 0; }
    .content { padding: 16px; }
  }
</style>
  <style>
    /* ‚îÄ‚îÄ AUTH MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    #authOverlay {
      position: fixed; inset: 0; z-index: 1000;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
      display: flex; align-items: center; justify-content: center;
    }
    #authOverlay.hidden { display: none; }
    .auth-modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 36px;
      width: 100%; max-width: 400px;
      box-shadow: 0 24px 64px rgba(0,0,0,0.4);
    }
    .auth-logo {
      font-size: 22px; font-weight: 700; letter-spacing: -0.5px;
      margin-bottom: 6px; color: var(--text-primary);
    }
    .auth-logo span { color: var(--accent-blue); }
    .auth-sub { font-size: 13px; color: var(--text-tertiary); margin-bottom: 28px; }
    .auth-tabs {
      display: flex; gap: 4px;
      background: var(--bg); border-radius: 8px; padding: 4px;
      margin-bottom: 24px;
    }
    .auth-tab {
      flex: 1; padding: 8px; border: none; background: none;
      border-radius: 6px; font-size: 13px; font-weight: 500;
      color: var(--text-tertiary); cursor: pointer; transition: all 0.15s;
      font-family: 'DM Sans', sans-serif;
    }
    .auth-tab.active {
      background: var(--surface); color: var(--text-primary);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .auth-field { margin-bottom: 14px; }
    .auth-field label {
      display: block; font-size: 12px; font-weight: 600;
      color: var(--text-secondary); margin-bottom: 6px;
      text-transform: uppercase; letter-spacing: 0.05em;
    }
    .auth-field input {
      width: 100%; padding: 10px 12px; box-sizing: border-box;
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 8px; color: var(--text-primary);
      font-size: 14px; font-family: 'DM Sans', sans-serif;
      outline: none; transition: border-color 0.15s;
    }
    .auth-field input:focus { border-color: var(--accent-blue); }
    .auth-btn {
      width: 100%; padding: 12px; margin-top: 8px;
      background: var(--accent-blue); color: white;
      border: none; border-radius: 8px; font-size: 14px;
      font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif;
      transition: opacity 0.15s;
    }
    .auth-btn:hover { opacity: 0.9; }
    .auth-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .auth-error {
      font-size: 13px; color: var(--accent-red);
      margin-top: 10px; text-align: center; min-height: 18px;
    }
    /* ‚îÄ‚îÄ USER BADGE in header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    #userBadge {
      display: flex; align-items: center; gap: 8px;
      font-size: 13px; color: var(--text-secondary);
    }
    #userBadge .user-name { font-weight: 500; color: var(--text-primary); }
    #userBadge .logout-btn {
      background: none; border: 1px solid var(--border);
      border-radius: 6px; padding: 4px 10px; font-size: 12px;
      color: var(--text-tertiary); cursor: pointer;
      font-family: 'DM Sans', sans-serif; transition: all 0.15s;
    }
    #userBadge .logout-btn:hover { color: var(--text-primary); border-color: var(--text-tertiary); }
    /* ‚îÄ‚îÄ SAVE INDICATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    #saveIndicator {
      position: fixed; bottom: 20px; right: 20px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; padding: 8px 14px;
      font-size: 12px; color: var(--text-tertiary);
      opacity: 0; transition: opacity 0.3s; pointer-events: none;
      z-index: 100;
    }
    #saveIndicator.visible { opacity: 1; }
  </style>
</head>
<body>

<!-- AUTH MODAL -->
<div id="authOverlay">
  <div class="auth-modal">
    <div class="auth-logo">Apex <span>IB</span></div>
    <div class="auth-sub">Your progress is saved across all devices</div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Sign In</button>
      <button class="auth-tab" id="tabRegister" onclick="switchAuthTab('register')">Create Account</button>
    </div>
    <div id="authLoginForm">
      <div class="auth-field"><label>Email</label><input type="email" id="loginEmail" placeholder="you@example.com" onkeydown="if(event.key==='Enter')doLogin()" /></div>
      <div class="auth-field"><label>Password</label><input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')doLogin()" /></div>
      <button class="auth-btn" id="loginBtn" onclick="doLogin()">Sign In</button>
    </div>
    <div id="authRegisterForm" style="display:none">
      <div class="auth-field"><label>Name</label><input type="text" id="registerName" placeholder="Your name" /></div>
      <div class="auth-field"><label>Email</label><input type="email" id="registerEmail" placeholder="you@example.com" /></div>
      <div class="auth-field"><label>Password</label><input type="password" id="registerPassword" placeholder="Min 6 characters" onkeydown="if(event.key==='Enter')doRegister()" /></div>
      <button class="auth-btn" id="registerBtn" onclick="doRegister()">Create Account</button>
    </div>
    <div class="auth-error" id="authError"></div>
    <div id="authServerStatus" style="font-size:11px;color:var(--text-tertiary);text-align:center;margin-top:8px;"></div>
  </div>
</div>

<!-- SAVE INDICATOR -->
<div id="saveIndicator">‚úì Progress saved</div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-mark">
      <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 2L13 5V11L8 14L3 11V5L8 2Z" stroke="white" stroke-width="1.5" stroke-linejoin="round"/>
        <circle cx="8" cy="8" r="2" fill="white"/>
      </svg>
    </div>
    <span class="logo-name">Apex</span>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-section-label">Overview</div>
    <a class="nav-item" href="dashboard.html">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Dashboard
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Performance
    </a>

    <div class="nav-section-label" style="margin-top:10px;">Practice</div>
    <a class="nav-item active" href="#">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Practice
      <span class="nav-badge">7 left</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>
      Saved Questions
    </a>

    <div class="nav-section-label" style="margin-top:10px;">Topics</div>
    <a class="nav-item" href="#" onclick="selectTopic('All');return false;" id="nav-All">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 010 20M12 2a15.3 15.3 0 000 20"/></svg>
      All Topics
      <span class="nav-badge" id="badge-All">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('Accounting');return false;" id="nav-Accounting">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
      Accounting
      <span class="nav-badge" id="badge-Accounting">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('Enterprise_Value');return false;" id="nav-Enterprise_Value">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/></svg>
      Enterprise Value
      <span class="nav-badge" id="badge-Enterprise_Value">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('Valuation');return false;" id="nav-Valuation">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
      Valuation
      <span class="nav-badge" id="badge-Valuation">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('DCF');return false;" id="nav-DCF">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      DCF
      <span class="nav-badge" id="badge-DCF">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('Mergers_MA');return false;" id="nav-Mergers_MA">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></svg>
      M&A
      <span class="nav-badge" id="badge-Mergers_MA">‚Äî</span>
    </a>
    <a class="nav-item" href="#" onclick="selectTopic('LBO');return false;" id="nav-LBO">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
      LBO
      <span class="nav-badge" id="badge-LBO">‚Äî</span>
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="user-card">
      <div class="user-avatar">CK</div>
      <div class="user-info">
        <div class="user-name">Chris Karimi</div>
        <div class="user-plan">Free plan</div>
      </div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div class="breadcrumb">
      Practice <span class="breadcrumb-sep">‚Ä∫</span> <span id="breadcrumbTopic">All Topics</span>
    </div>
    <div class="topic-pill">
      <span class="topic-dot"></span>
      <span id="topbarTopicPill">All Topics</span>
    </div>
    <div class="topbar-right">
      <div id="userBadge" style="display:none">
        <span class="user-name" id="userDisplayName"></span>
        <button class="logout-btn" onclick="doLogout()">Sign out</button>
      </div>
    </div>
  </div>

  <div class="content">

    <!-- SESSION HEADER -->
    <div class="session-header">
      <div class="session-progress">
        <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
        <span class="progress-label" id="progressLabel">0 of 0 questions</span>
      </div>
      <div class="session-stats">
        <div class="stat-pill"><div class="stat-dot green"></div> <span id="statMastered">0</span> mastered</div>
        <div class="stat-pill"><div class="stat-dot amber"></div> <span id="statPartial">0</span> partial</div>
        <div class="stat-pill"><div class="stat-dot red"></div> <span id="statMissed">0</span> missed</div>
      </div>
    </div>

    <!-- INTERVIEW MODE TOGGLE BAR -->
    <div class="interview-mode-bar" id="interviewModeBar">
      <div class="interview-mode-left">
        <div class="interview-mode-icon" id="interviewModeIcon">üéØ</div>
        <div class="interview-mode-text">
          <div class="interview-mode-title">Interview Mode</div>
          <div class="interview-mode-sub" id="interviewModeSub">Question stays visible while you answer</div>
        </div>
      </div>
      <div class="interview-mode-right">
        <div class="duration-picker" id="durationPicker">
          <span class="duration-label">Hide after</span>
          <div class="duration-options">
            <button class="dur-btn" onclick="setDuration(5)">5s</button>
            <button class="dur-btn active" onclick="setDuration(10)">10s</button>
            <button class="dur-btn" onclick="setDuration(15)">15s</button>
            <button class="dur-btn" onclick="setDuration(30)">30s</button>
          </div>
        </div>
        <button class="toggle-switch" id="interviewToggle" onclick="toggleInterviewMode()" aria-label="Toggle interview mode">
          <div class="toggle-knob"></div>
        </button>
      </div>
    </div>

    <!-- QUESTION CARD -->
    <div class="question-card" id="questionCard">
      <!-- COUNTDOWN ROW (visible only in interview mode) -->
      <div class="countdown-ring-wrap" id="countdownWrap">
        <div class="countdown-ring">
          <svg width="36" height="36" viewBox="0 0 36 36">
            <circle class="countdown-ring-track" cx="18" cy="18" r="14"/>
            <circle class="countdown-ring-fill" id="countdownRingFill" cx="18" cy="18" r="14"/>
          </svg>
          <div class="countdown-number-center" id="countdownNumber">10</div>
        </div>
        <span class="countdown-text" id="countdownText">Question disappearing in <strong id="countdownStrong">10</strong>s ‚Äî read carefully</span>
      </div>

      <div class="question-meta">
        <span class="q-tag accounting" id="qTagTopic">Accounting</span>
        <span class="q-tag difficulty" id="qTagDifficulty">Basic</span>
        <span class="q-number" id="qNumber">Q1</span>
      </div>
      <div class="question-text" id="questionText">
        Loading question‚Ä¶
      </div>
      <div class="question-hint" id="questionHint">
        <span class="hint-icon">üí°</span>
        You struggled with the cash flow statement impact last time. Pay special attention to how depreciation flows through each statement.
      </div>

      <!-- SHOWN WHEN QUESTION IS HIDDEN -->
      <div class="hidden-question-msg" id="hiddenMsg">
        <span>üôà</span>
        <span>Question hidden ‚Äî answer from memory</span>
        <button class="peek-btn" onclick="peekQuestion()">Peek (-5pts)</button>
      </div>
    </div>

    <!-- INPUT MODE TOGGLE -->
    <div class="input-mode-toggle">
      <button class="mode-btn active" id="modeVoice" onclick="switchMode('voice')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
        Voice
      </button>
      <button class="mode-btn" id="modeText" onclick="switchMode('text')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Text
      </button>
    </div>

    <!-- VOICE PANEL -->
    <div class="answer-panel visible" id="voicePanel">
      <div class="voice-panel">
        <div class="record-btn-wrap">
          <div class="pulse-ring" id="pulseRing"></div>
          <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
            <svg id="micIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          </button>
        </div>
        <div class="record-status" id="recordStatus">Tap to start answering</div>
        <div class="record-sub" id="recordSub">Speak your answer clearly ‚Äî just like in a real interview</div>
        <div class="waveform" id="waveform">
          <div class="wave-bar" style="height:6px"></div>
          <div class="wave-bar" style="height:10px"></div>
          <div class="wave-bar" style="height:8px"></div>
          <div class="wave-bar" style="height:6px"></div>
          <div class="wave-bar" style="height:14px"></div>
          <div class="wave-bar" style="height:6px"></div>
          <div class="wave-bar" style="height:10px"></div>
          <div class="wave-bar" style="height:8px"></div>
          <div class="wave-bar" style="height:6px"></div>
        </div>
        <!-- LIVE TRANSCRIPT -->
        <div id="transcriptWrap" style="display:none; width:100%; margin-top:16px; text-align:left;">
          <div style="
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 14px 16px;
            min-height: 80px;
            font-size: 14.5px;
            line-height: 1.7;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            position: relative;
          ">
            <div style="
              font-size: 10px;
              font-weight: 600;
              letter-spacing: 0.07em;
              text-transform: uppercase;
              color: var(--text-tertiary);
              margin-bottom: 8px;
              display: flex;
              justify-content: space-between;
              align-items: center;
            ">
              <span id="transcriptLabel">Live Transcript</span>
              <span id="transcriptEditHint" style="display:none; font-size:10px; color:var(--accent-blue); font-weight:500; text-transform:none; letter-spacing:0;">‚úèÔ∏è Click to edit</span>
            </div>
            <!-- Live recording view -->
            <div id="transcriptLive">
              <span id="transcriptFinal" style="color: var(--text-primary);"></span>
              <span id="transcriptInterim" style="color: var(--text-tertiary); font-style: italic;"></span>
              <span id="transcriptCursor" style="
                display: inline-block;
                width: 2px; height: 1em;
                background: var(--recording);
                margin-left: 2px;
                vertical-align: text-bottom;
                animation: blink 1s step-end infinite;
              "></span>
            </div>
            <!-- Editable view (shown after recording stops) -->
            <div
              id="transcriptEditable"
              contenteditable="false"
              style="
                display: none;
                outline: none;
                min-height: 40px;
                white-space: pre-wrap;
                word-break: break-word;
                cursor: default;
                border-radius: 4px;
                padding: 2px 4px;
                margin: -2px -4px;
                transition: background 0.15s;
              "
              oninput="syncEditableToTranscript()"
            ></div>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px; padding: 0 2px;">
            <span id="transcriptWordCount" style="font-size:12px; color:var(--text-tertiary);">0 words</span>
            <button onclick="clearTranscript()" style="
              background:none; border:none; font-size:12px;
              color:var(--text-tertiary); cursor:pointer; font-family:'DM Sans',sans-serif;
              padding: 2px 6px; border-radius: 4px; transition: color 0.15s;
            " onmouseover="this.style.color='var(--text-primary)'" onmouseout="this.style.color='var(--text-tertiary)'">
              Clear ‚úï
            </button>
          </div>
        </div>
        <!-- NOT SUPPORTED MESSAGE -->
        <div id="speechNotSupported" style="display:none; margin-top:12px; font-size:13px; color:var(--accent-red); text-align:center;">
          ‚ö†Ô∏è Speech recognition isn't supported in this browser. Try Chrome or Edge, or use Text mode.
        </div>
      </div>
    </div>

    <!-- TEXT PANEL -->
    <div class="answer-panel" id="textPanel">
      <div class="text-input-area">
        <textarea class="answer-textarea" id="answerTextarea" placeholder="Type your answer here. Be specific ‚Äî imagine you're sitting across from an interviewer..." oninput="updateWordCount()"></textarea>
        <div class="textarea-footer">
          <span class="word-count" id="wordCount">0 words</span>
        </div>
      </div>
    </div>

    <!-- SUBMIT ROW -->
    <div class="submit-row" id="submitRow">
      <button class="btn-primary" onclick="submitAnswer()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
        Submit Answer
      </button>
      <button class="btn-skip" onclick="skipQuestion()">Skip ‚Üí</button>
    </div>

    <!-- FEEDBACK PANEL -->
    <div class="feedback-panel" id="feedbackPanel">

      <!-- VERDICT HEADER -->
      <div class="verdict-header" id="verdictHeader">
        <div class="verdict-badge" id="verdictBadge">
          <span id="verdictIcon">‚Äî</span>
          <span id="verdictLabel">‚Äî</span>
        </div>
        <div class="verdict-score-wrap">
          <div class="verdict-score" id="verdictScore">‚Äî</div>
          <div class="verdict-score-sub">/100</div>
        </div>
      </div>

      <!-- SCORE DIMENSIONS -->
      <div class="score-dims-row">
        <div class="dim-item">
          <div class="dim-header">
            <span class="dim-label">Technical Accuracy</span>
            <span class="dim-score" id="dimTechnical">‚Äî</span>
          </div>
          <div class="dim-bar-track"><div class="dim-bar-fill" id="barTechnical" style="width:0%"></div></div>
        </div>
        <div class="dim-item">
          <div class="dim-header">
            <span class="dim-label">Completeness</span>
            <span class="dim-score" id="dimCompleteness">‚Äî</span>
          </div>
          <div class="dim-bar-track"><div class="dim-bar-fill" id="barCompleteness" style="width:0%"></div></div>
        </div>
        <div class="dim-item">
          <div class="dim-header">
            <span class="dim-label">Structure & Clarity</span>
            <span class="dim-score" id="dimStructure">‚Äî</span>
          </div>
          <div class="dim-bar-track"><div class="dim-bar-fill" id="barStructure" style="width:0%"></div></div>
        </div>
      </div>

      <!-- FEEDBACK BODY -->
      <div class="feedback-body" id="feedbackBody">

        <div class="feedback-section-title">What you got right</div>
        <div class="feedback-points" id="feedbackCorrect"></div>

        <div class="feedback-section-title" style="margin-top:18px;">What you missed or got wrong</div>
        <div class="feedback-points" id="feedbackMissed"></div>

        <div class="feedback-section-title" style="margin-top:18px;">Model answer</div>
        <div class="model-answer-box" id="modelAnswer"></div>

      </div>

      <!-- NEXT QUESTION / ACTIONS -->
      <div class="next-section" id="nextSection">
        <div class="next-label">
          Recommended next
          <span class="next-label-badge" id="nextBadge">Targeting your gap</span>
        </div>
        <div class="next-q-preview" id="nextQPreview">
          <div class="next-q-text" id="nextQText">‚Äî</div>
          <div class="next-q-reason" id="nextQReason"></div>
        </div>
        <div class="next-actions">
          <button class="btn-primary" onclick="confirmNextQuestion()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="9 18 15 12 9 6"/></svg>
            Load this question
          </button>
          <button class="btn-ghost" onclick="retryQuestion()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-4.5"/></svg>
            Retry this question
          </button>
          <button class="btn-mark-mastered" id="btnMarkMastered" onclick="markMastered()" style="display:none">
            ‚òÖ Mark as Mastered
          </button>
        </div>
      </div>

    </div>

  </div>
</main>

<!-- ANALYZING OVERLAY -->
<div class="analyzing-overlay" id="analyzingOverlay">
  <div class="analyzing-spinner"></div>
  <div class="analyzing-text">Analyzing your answer‚Ä¶</div>
  <div class="analyzing-sub">Checking technical accuracy, structure, and completeness</div>
</div>

<script>
  let currentMode = 'voice';

  // ‚îÄ‚îÄ‚îÄ AUTH STATE (must be at top ‚Äî referenced by init) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let authToken = null;
  let currentUser = null;
  let saveStateTimer = null;
  let isRecording = false;
  let recordingTimer = null;
  let feedbackStyle = 'coach';

  // Interview mode state
  let interviewModeOn = false;
  let countdownDuration = 10;
  let countdownValue = 10;
  let countdownInterval = null;
  let questionHidden = false;
  let peeked = false;

  // ‚îÄ‚îÄ‚îÄ MODE SWITCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function switchMode(mode) {
    currentMode = mode;
    document.getElementById('modeVoice').classList.toggle('active', mode === 'voice');
    document.getElementById('modeText').classList.toggle('active', mode === 'text');
    document.getElementById('voicePanel').classList.toggle('visible', mode === 'voice');
    document.getElementById('textPanel').classList.toggle('visible', mode === 'text');
  }

  // ‚îÄ‚îÄ‚îÄ SPEECH RECOGNITION SETUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition = null;
  let finalTranscript = '';
  let interimTranscript = '';

  if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'en-US';
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      console.log('Speech recognition started successfully');
      document.getElementById('speechNotSupported').style.display = 'none';
      document.getElementById('recordStatus').textContent = 'Listening‚Ä¶ speak now';
    };

    recognition.onresult = (event) => {
      interimTranscript = '';
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += transcript + ' ';
        } else {
          interimTranscript += transcript;
        }
      }
      updateTranscriptDisplay();
    };

    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
      const errEl = document.getElementById('speechNotSupported');
      errEl.style.display = 'block';
      if (event.error === 'not-allowed') {
        errEl.textContent = '‚ö†Ô∏è Microphone access denied. Click the üîí icon in your browser address bar and allow microphone, then refresh.';
      } else if (event.error === 'no-speech') {
        errEl.textContent = '‚ö†Ô∏è No speech detected. Make sure your mic is working and try again.';
        setTimeout(() => { errEl.style.display = 'none'; }, 3000);
      } else if (event.error === 'network') {
        errEl.textContent = '‚ö†Ô∏è Network error with speech service. Try switching to Text mode.';
      } else if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
        errEl.textContent = '‚ö†Ô∏è Speech recognition not allowed. Use Chrome or Edge and ensure mic permissions are granted.';
      } else {
        errEl.textContent = `‚ö†Ô∏è Speech error: ${event.error}. Try Text mode instead.`;
      }
      // Stop recording state on error
      if (isRecording) {
        isRecording = false;
        document.getElementById('recordBtn').classList.remove('recording');
        document.getElementById('pulseRing').classList.remove('active');
        document.querySelectorAll('.wave-bar').forEach(b => b.classList.remove('active'));
        document.getElementById('recordStatus').textContent = 'Tap to try again';
      }
    };

    recognition.onend = () => {
      console.log('Speech recognition ended, isRecording:', isRecording);
      // Auto-restart if still supposed to be recording (browser times out after ~60s silence)
      if (isRecording) {
        try { recognition.start(); } catch(e) { console.log('Restart failed:', e); }
      }
    };
  }

  function updateTranscriptDisplay() {
    document.getElementById('transcriptFinal').textContent = finalTranscript;
    document.getElementById('transcriptInterim').textContent = interimTranscript;
    const words = finalTranscript.trim() ? finalTranscript.trim().split(/\s+/).length : 0;
    document.getElementById('transcriptWordCount').textContent = `${words} word${words !== 1 ? 's' : ''}`;
  }

  function switchToEditableTranscript() {
    const live = document.getElementById('transcriptLive');
    const editable = document.getElementById('transcriptEditable');
    const editHint = document.getElementById('transcriptEditHint');
    const label = document.getElementById('transcriptLabel');

    // Populate editable with the final transcript
    editable.textContent = finalTranscript.trim();
    editable.contentEditable = 'true';
    editable.style.display = 'block';
    editable.style.cursor = 'text';
    live.style.display = 'none';

    label.textContent = 'Transcript';
    editHint.style.display = 'inline';

    // Focus and highlight to invite editing
    editable.style.background = 'rgba(37,99,235,0.04)';
    setTimeout(() => { editable.style.background = 'transparent'; }, 1200);
  }

  function switchToLiveTranscript() {
    const live = document.getElementById('transcriptLive');
    const editable = document.getElementById('transcriptEditable');
    const editHint = document.getElementById('transcriptEditHint');
    const label = document.getElementById('transcriptLabel');

    editable.contentEditable = 'false';
    editable.style.display = 'none';
    live.style.display = 'block';

    label.textContent = 'Live Transcript';
    editHint.style.display = 'none';
  }

  function syncEditableToTranscript() {
    // Keep finalTranscript in sync with manual edits
    finalTranscript = document.getElementById('transcriptEditable').textContent;
    const words = finalTranscript.trim() ? finalTranscript.trim().split(/\s+/).length : 0;
    document.getElementById('transcriptWordCount').textContent = `${words} word${words !== 1 ? 's' : ''}`;
  }

  function clearTranscript() {
    finalTranscript = '';
    interimTranscript = '';
    updateTranscriptDisplay();
    switchToLiveTranscript();
    document.getElementById('transcriptWrap').style.display = 'none';
    document.getElementById('recordStatus').textContent = 'Tap to start answering';
    document.getElementById('recordSub').textContent = 'Speak your answer clearly ‚Äî just like in a real interview';
    document.getElementById('micIcon').innerHTML = '<path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/>';
  }

  // ‚îÄ‚îÄ‚îÄ RECORDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleRecording() {
    if (!SpeechRecognition) {
      const errEl = document.getElementById('speechNotSupported');
      errEl.style.display = 'block';
      const isFirefox = navigator.userAgent.toLowerCase().includes('firefox');
      const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
      if (isFirefox) {
        errEl.textContent = '‚ö†Ô∏è Firefox does not support speech recognition. Please use Chrome or Edge for voice mode.';
      } else if (isSafari) {
        errEl.textContent = '‚ö†Ô∏è Safari has limited speech support. For best results, use Chrome.';
      } else {
        errEl.textContent = '‚ö†Ô∏è Speech recognition not supported in this browser. Try Chrome or Edge, or use Text mode.';
      }
      return;
    }

    isRecording = !isRecording;
    const btn = document.getElementById('recordBtn');
    const pulse = document.getElementById('pulseRing');
    const status = document.getElementById('recordStatus');
    const sub = document.getElementById('recordSub');
    const bars = document.querySelectorAll('.wave-bar');
    const micIcon = document.getElementById('micIcon');
    const transcriptWrap = document.getElementById('transcriptWrap');
    const cursor = document.getElementById('transcriptCursor');

    if (isRecording) {
      // Clear previous transcript when starting fresh only if nothing committed yet
      interimTranscript = '';
      // Switch back to live view if coming from edited state
      switchToLiveTranscript();
      try {
        recognition.start();
        console.log('Recognition start called successfully');
      } catch(e) {
        console.error('Recognition start error:', e);
        isRecording = false;
        const errEl = document.getElementById('speechNotSupported');
        errEl.style.display = 'block';
        errEl.textContent = '‚ö†Ô∏è Could not start microphone: ' + e.message + '. Try refreshing the page.';
        return;
      }

      btn.classList.add('recording');
      pulse.classList.add('active');
      status.textContent = 'Recording‚Ä¶ tap to stop';
      sub.textContent = 'Speak your answer clearly';
      bars.forEach(b => b.classList.add('active'));
      transcriptWrap.style.display = 'block';
      cursor.style.display = 'inline-block';
      // Restore mic icon
      micIcon.innerHTML = '<path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/>';
    } else {
      recognition.stop();

      btn.classList.remove('recording');
      pulse.classList.remove('active');
      bars.forEach(b => b.classList.remove('active'));
      cursor.style.display = 'none';

      if (finalTranscript.trim()) {
        status.textContent = 'Answer recorded ‚úì';
        sub.textContent = 'Ready to submit ‚Äî or tap to re-record';
        micIcon.innerHTML = '<polyline points="20 6 9 17 4 12"/>';
        // Switch to editable mode
        switchToEditableTranscript();
      } else {
        status.textContent = 'Tap to start answering';
        sub.textContent = 'Speak your answer clearly ‚Äî just like in a real interview';
        transcriptWrap.style.display = 'none';
      }
    }
  }

  function updateWordCount() {
    const text = document.getElementById('answerTextarea').value.trim();
    const words = text ? text.split(/\s+/).length : 0;
    document.getElementById('wordCount').textContent = `${words} word${words !== 1 ? 's' : ''}`;
  }

  // ‚îÄ‚îÄ‚îÄ INTERVIEW MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleInterviewMode() {
    interviewModeOn = !interviewModeOn;

    const toggle = document.getElementById('interviewToggle');
    const bar = document.getElementById('interviewModeBar');
    const icon = document.getElementById('interviewModeIcon');
    const sub = document.getElementById('interviewModeSub');
    const picker = document.getElementById('durationPicker');

    toggle.classList.toggle('on', interviewModeOn);
    bar.classList.toggle('interview-active', interviewModeOn);
    picker.classList.toggle('enabled', interviewModeOn);

    if (interviewModeOn) {
      icon.textContent = '‚è±Ô∏è';
      sub.textContent = `Question will disappear after ${countdownDuration}s`;
      // Reset any hidden state first
      resetQuestionVisibility();
      // Start countdown
      startCountdown();
    } else {
      icon.textContent = 'üéØ';
      sub.textContent = 'Question stays visible while you answer';
      clearCountdown();
      resetQuestionVisibility();
    }
  }

  function setDuration(secs) {
    countdownDuration = secs;
    document.querySelectorAll('.dur-btn').forEach(b => {
      b.classList.toggle('active', b.textContent === secs + 's');
    });
    document.getElementById('interviewModeSub').textContent = `Question will disappear after ${secs}s`;
    // If already running, restart
    if (interviewModeOn && !questionHidden) {
      clearCountdown();
      startCountdown();
    }
  }

  function startCountdown() {
    questionHidden = false;
    peeked = false;
    countdownValue = countdownDuration;

    const wrap = document.getElementById('countdownWrap');
    const numEl = document.getElementById('countdownNumber');
    const strongEl = document.getElementById('countdownStrong');
    const fillEl = document.getElementById('countdownRingFill');
    const numCenter = document.querySelector('.countdown-number-center');
    const textEl = document.getElementById('countdownText');

    wrap.classList.add('visible');
    numEl.textContent = countdownValue;
    numEl.classList.remove('urgent');
    strongEl.textContent = countdownValue;
    fillEl.classList.remove('urgent');

    // Ring circumference = 2œÄ√ó14 ‚âà 88
    const circumference = 88;
    fillEl.style.strokeDashoffset = 0;

    countdownInterval = setInterval(() => {
      countdownValue--;
      numEl.textContent = countdownValue;
      strongEl.textContent = countdownValue;

      // Update ring
      const progress = countdownValue / countdownDuration;
      fillEl.style.strokeDashoffset = circumference * (1 - progress);

      // Urgent state at 3s
      if (countdownValue <= 3) {
        fillEl.classList.add('urgent');
        numCenter.classList.add('urgent');
      }

      if (countdownValue <= 0) {
        clearInterval(countdownInterval);
        hideQuestion();
      }
    }, 1000);
  }

  function clearCountdown() {
    if (countdownInterval) {
      clearInterval(countdownInterval);
      countdownInterval = null;
    }
    document.getElementById('countdownWrap').classList.remove('visible');
    document.querySelector('.countdown-number-center').classList.remove('urgent');
    document.getElementById('countdownRingFill').classList.remove('urgent');
  }

  function hideQuestion() {
    questionHidden = true;
    clearCountdown();

    const qText = document.getElementById('questionText');
    const qHint = document.getElementById('questionHint');
    const hiddenMsg = document.getElementById('hiddenMsg');
    const card = document.getElementById('questionCard');

    // Animate out
    qText.classList.add('dissolving');
    qHint.classList.add('dissolving');

    setTimeout(() => {
      qText.style.display = 'none';
      qHint.style.display = 'none';
      qText.classList.remove('dissolving');
      qHint.classList.remove('dissolving');
      hiddenMsg.classList.add('visible');
      card.classList.add('interview-hidden');
    }, 850);

    // Update bar
    document.getElementById('interviewModeSub').textContent = 'Question hidden ‚Äî answering from memory';
  }

  function peekQuestion() {
    peeked = true;
    const qText = document.getElementById('questionText');
    const qHint = document.getElementById('questionHint');
    const hiddenMsg = document.getElementById('hiddenMsg');
    const card = document.getElementById('questionCard');

    qText.style.display = '';
    qHint.style.display = '';
    qText.style.animation = 'dissolve-in 0.4s ease forwards';
    qHint.style.animation = 'dissolve-in 0.4s ease 0.1s forwards';
    hiddenMsg.classList.remove('visible');
    card.classList.remove('interview-hidden');

    document.getElementById('interviewModeSub').textContent = 'üëÄ Peeked ‚Äî -5pts will be deducted from score';

    // Re-hide after 5s
    setTimeout(() => {
      if (interviewModeOn) {
        qText.style.display = 'none';
        qHint.style.display = 'none';
        hiddenMsg.classList.add('visible');
        card.classList.add('interview-hidden');
        document.getElementById('interviewModeSub').textContent = 'Question hidden ‚Äî answering from memory';
      }
      qText.style.animation = '';
      qHint.style.animation = '';
    }, 5000);
  }

  function resetQuestionVisibility() {
    const qText = document.getElementById('questionText');
    const qHint = document.getElementById('questionHint');
    const hiddenMsg = document.getElementById('hiddenMsg');
    const card = document.getElementById('questionCard');

    qText.style.display = '';
    qHint.style.display = '';
    qText.style.animation = '';
    qHint.style.animation = '';
    qText.classList.remove('dissolving');
    qHint.classList.remove('dissolving');
    hiddenMsg.classList.remove('visible');
    card.classList.remove('interview-hidden');
    questionHidden = false;
  }

  // ‚îÄ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ‚îÄ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function submitAnswer() {
    clearCountdown();

    const overlay = document.getElementById('analyzingOverlay');

    let userAnswer = '';
    if (currentMode === 'text') {
      userAnswer = document.getElementById('answerTextarea').value.trim();
    } else {
      userAnswer = finalTranscript.trim();
    }

    if (!userAnswer) {
      alert(currentMode === 'voice' ? 'Please record your answer before submitting.' : 'Please type your answer before submitting.');
      return;
    }

    overlay.classList.add('visible');

    const question = document.getElementById('questionText').textContent.trim();

    const systemPrompt = `You are a senior investment banking technical interviewer grading a candidate's answer. Be strict and precise ‚Äî mastery requires a near-perfect response.

Grade on exactly 3 dimensions (0-100 each):
1. technical_accuracy ‚Äî Are the facts, mechanics, and numbers correct?
2. completeness ‚Äî Did they cover ALL key points? Missing even one important piece should reduce this score significantly.
3. structure ‚Äî Was the answer logically organized and clear?

Overall score = weighted average: technical(50%) + completeness(35%) + structure(15%). Round to nearest whole number.
Mastery threshold is 95. Be honest ‚Äî most answers should score 60-85.

Rules:
- "correct": max 3 items. Each must be one short sentence referencing exactly what they said.
- "missed": max 3 items. Each must be one short sentence referencing exactly what they missed or got wrong. Prefix with "Critical:" or "Minor:" as appropriate.
- "model_answer": 2-3 sentences MAXIMUM. The essential answer only ‚Äî no elaboration.
- "next_question": one targeted follow-up based on their specific gap. If 95+, ask a harder follow-on.

Respond ONLY with valid JSON, no markdown fences:
{
  "scores": {
    "overall": 72,
    "technical": 65,
    "completeness": 60,
    "structure": 80
  },
  "correct": ["They correctly stated X", "They mentioned Y"],
  "missed": ["Critical: they missed X", "Minor: they didn't mention Y"],
  "model_answer": "2-3 sentence ideal answer.",
  "next_question": {
    "text": "The follow-up question",
    "reason": "One sentence: why this targets their gap"
  }
}`;

    const userPrompt = `Question: "${question}"

Candidate's answer: "${userAnswer}"
${peeked ? '\nNote: Candidate peeked at the question after it was hidden ‚Äî deduct 5 points from overall.' : ''}

Grade strictly and return JSON only.`;

    try {
      const response = await fetch('/api/grade', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-haiku-4-5-20251001',
          max_tokens: 1200,
          system: systemPrompt,
          messages: [{ role: 'user', content: userPrompt }]
        })
      });

      if (!response.ok) throw new Error(`API ${response.status}: ${await response.text()}`);

      // Hide spinner, show feedback panel in loading state immediately
      overlay.classList.remove('visible');
      if (document.getElementById('apiErrorBanner')) document.getElementById('apiErrorBanner').style.display = 'none';
      showFeedbackLoading();

      // Read SSE stream
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let fullText = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });
        for (const line of chunk.split('\n')) {
          if (!line.startsWith('data: ')) continue;
          const data = line.slice(6).trim();
          if (!data || data === '[DONE]') continue;
          try {
            const event = JSON.parse(data);
            if (event.type === 'content_block_delta' && event.delta?.type === 'text_delta') {
              fullText += event.delta.text;
              tryStreamRender(fullText);
            }
          } catch(e) {}
        }
      }

      // Final full render
      try {
        const result = JSON.parse(fullText.replace(/```json|```/g, '').trim());
        renderFeedback(result);
      } catch(e) {
        console.error('Parse error:', e, fullText);
        showApiError('Could not parse response ‚Äî please try again.');
      }

    } catch (err) {
      overlay.classList.remove('visible');
      console.error('Grading error:', err);
      showApiError(err.message);
    }
  }

  function showFeedbackLoading() {
    const panel = document.getElementById('feedbackPanel');
    panel.classList.add('visible');
    document.getElementById('verdictScore').textContent = '‚Ä¶';
    document.getElementById('verdictLabel').textContent = 'Grading';
    document.getElementById('verdictBadge').className = 'verdict-badge';
    document.getElementById('verdictBadge').style.opacity = '0.5';
    document.getElementById('feedbackCorrect').innerHTML = '<div class="feedback-point" style="color:var(--text-tertiary)"><span class="point-icon">¬∑</span><span>Analyzing your answer‚Ä¶</span></div>';
    document.getElementById('feedbackMissed').innerHTML = '<div class="feedback-point" style="color:var(--text-tertiary)"><span class="point-icon">¬∑</span><span>Identifying gaps‚Ä¶</span></div>';
    document.getElementById('modelAnswer').textContent = 'Generating model answer‚Ä¶';
    document.getElementById('nextQText').textContent = 'Selecting next question‚Ä¶';
    document.getElementById('nextQReason').textContent = '';
    panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function tryStreamRender(text) {
    // Stream model_answer as it types in
    const maMatch = text.match(/"model_answer"\s*:\s*"((?:[^"\\]|\\.)*)"/);
    if (maMatch) {
      document.getElementById('modelAnswer').textContent = maMatch[1].replace(/\\n/g, '\n').replace(/\\"/g, '"');
    }
    // Show scores as soon as the scores block is complete
    const scMatch = text.match(/"scores"\s*:\s*(\{[^}]+\})/);
    if (scMatch) {
      try {
        const scores = JSON.parse(scMatch[1]);
        if (scores.overall) {
          document.getElementById('verdictScore').textContent = scores.overall;
          document.getElementById('verdictBadge').style.opacity = '1';
          updateDimBars(scores);
          updateVerdict(scores.overall);
        }
      } catch(e) {}
    }
  }

  function updateVerdict(overall) {
    const badge = document.getElementById('verdictBadge');
    const icon = document.getElementById('verdictIcon');
    const label = document.getElementById('verdictLabel');
    if (overall >= 95) { badge.className = 'verdict-badge mastered'; icon.textContent = '‚òÖ'; label.textContent = 'Mastered'; }
    else if (overall >= 75) { badge.className = 'verdict-badge needs-work'; icon.textContent = '‚óé'; label.textContent = 'Needs Work'; }
    else { badge.className = 'verdict-badge miss'; icon.textContent = '‚úï'; label.textContent = 'Miss'; }
  }

  function updateDimBars(scores) {
    [
      { key: 'technical', score: 'dimTechnical', bar: 'barTechnical' },
      { key: 'completeness', score: 'dimCompleteness', bar: 'barCompleteness' },
      { key: 'structure', score: 'dimStructure', bar: 'barStructure' },
    ].forEach(d => {
      const val = scores[d.key];
      if (!val) return;
      document.getElementById(d.score).textContent = val;
      const bar = document.getElementById(d.bar);
      bar.className = 'dim-bar-fill ' + (val >= 85 ? 'high' : val >= 65 ? 'mid' : 'low');
      setTimeout(() => { bar.style.width = val + '%'; }, 50);
    });
  }

  function showApiError(msg) {
    let errEl = document.getElementById('apiErrorBanner');
    if (!errEl) {
      errEl = document.createElement('div');
      errEl.id = 'apiErrorBanner';
      errEl.style.cssText = 'background:#FEF2F2;border:1px solid #FECACA;border-radius:8px;padding:14px 18px;margin-top:14px;font-size:13px;color:#991B1B;line-height:1.7;';
      document.getElementById('submitRow').after(errEl);
    }
    errEl.style.display = 'block';
    errEl.innerHTML = `<strong>‚ö†Ô∏è Grading failed.</strong> Make sure the server is running with your API key.<br><span style="font-size:11px;color:#B91C1C;">Error: ${msg}</span>`;
  }

  // ‚îÄ‚îÄ‚îÄ RENDER FEEDBACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderFeedback(result) {
    const scores = result.scores;
    const overall = scores.overall;

    // Verdict
    const verdictBadge = document.getElementById('verdictBadge');
    const verdictIcon = document.getElementById('verdictIcon');
    const verdictLabel = document.getElementById('verdictLabel');
    const verdictScore = document.getElementById('verdictScore');

    verdictScore.textContent = overall;

    if (overall >= 95) {
      verdictBadge.className = 'verdict-badge mastered';
      verdictIcon.textContent = '‚òÖ';
      verdictLabel.textContent = 'Mastered';
    } else if (overall >= 75) {
      verdictBadge.className = 'verdict-badge needs-work';
      verdictIcon.textContent = '‚óé';
      verdictLabel.textContent = 'Needs Work';
    } else {
      verdictBadge.className = 'verdict-badge miss';
      verdictIcon.textContent = '‚úï';
      verdictLabel.textContent = 'Miss';
    }

    // Dimension bars ‚Äî animate after brief delay
    const dimMap = [
      { scoreKey: 'technical', scoreEl: 'dimTechnical', barEl: 'barTechnical' },
      { scoreKey: 'completeness', scoreEl: 'dimCompleteness', barEl: 'barCompleteness' },
      { scoreKey: 'structure', scoreEl: 'dimStructure', barEl: 'barStructure' },
    ];

    dimMap.forEach(d => {
      const score = scores[d.scoreKey] || 0;
      document.getElementById(d.scoreEl).textContent = score;
      const bar = document.getElementById(d.barEl);
      bar.style.width = '0%';
      bar.className = 'dim-bar-fill ' + (score >= 85 ? 'high' : score >= 65 ? 'mid' : 'low');
      setTimeout(() => { bar.style.width = score + '%'; }, 120);
    });

    // Correct points
    const correct = (result.correct || []).slice(0, 3);
    document.getElementById('feedbackCorrect').innerHTML = correct.length
      ? correct.map(p => `<div class="feedback-point"><span class="point-icon">‚úÖ</span><span>${p}</span></div>`).join('')
      : `<div class="feedback-point"><span class="point-icon" style="color:var(--text-tertiary)">‚Äî</span><span style="color:var(--text-tertiary)">Nothing clearly correct identified.</span></div>`;

    // Missed points
    const missed = (result.missed || []).slice(0, 3);
    document.getElementById('feedbackMissed').innerHTML = missed.length
      ? missed.map(p => {
          const isCritical = p.toLowerCase().startsWith('critical');
          const icon = isCritical ? '‚ùå' : '‚ö†Ô∏è';
          return `<div class="feedback-point"><span class="point-icon">${icon}</span><span>${p}</span></div>`;
        }).join('')
      : `<div class="feedback-point"><span class="point-icon">‚úÖ</span><span>No significant gaps ‚Äî excellent answer.</span></div>`;

    // Model answer
    document.getElementById('modelAnswer').textContent = result.model_answer || '';

    // Next question
    if (result.next_question) {
      document.getElementById('nextQText').textContent = result.next_question.text;
      document.getElementById('nextQReason').textContent = 'üìç ' + result.next_question.reason;
      // Store AI's suggested next question for navigation
      pendingNextQuestion = result.next_question.text;
    }

    // Show "Mark as Mastered" button only if score is just below threshold (75-94)
    // If already mastered (95+), show it too so user can confirm
    const btnMastered = document.getElementById('btnMarkMastered');
    if (overall >= 75) {
      btnMastered.style.display = 'inline-flex';
      btnMastered.style.alignItems = 'center';
      btnMastered.style.gap = '6px';
    } else {
      btnMastered.style.display = 'none';
    }

    // Update next badge
    const nextBadge = document.getElementById('nextBadge');
    if (overall >= 95) {
      nextBadge.textContent = 'Harder follow-on';
      nextBadge.className = 'next-label-badge mastered-badge';
    } else {
      nextBadge.textContent = 'Targeting your gap';
      nextBadge.className = 'next-label-badge';
    }

    // Show panel
    document.getElementById('feedbackPanel').classList.add('visible');
    document.getElementById('feedbackPanel').scrollIntoView({ behavior: 'smooth', block: 'start' });

    // Track session result
    recordQuestionResult(overall);

    // Auto-show mastery celebration if 95+
    if (overall >= 95) {
      setTimeout(() => showMasteryCelebration(), 600);
    }
  }

  // ‚îÄ‚îÄ‚îÄ MASTERY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function markMastered() {
    showMasteryCelebration();
    document.getElementById('btnMarkMastered').textContent = '‚òÖ Marked as Mastered';
    document.getElementById('btnMarkMastered').disabled = true;
    document.getElementById('btnMarkMastered').style.opacity = '0.5';
  }

  function showMasteryCelebration() {
    let cel = document.getElementById('masteryCelebration');
    if (!cel) {
      cel = document.createElement('div');
      cel.id = 'masteryCelebration';
      cel.className = 'mastery-celebration';
      cel.innerHTML = `
        <div class="mastery-celebration-icon">üèÜ</div>
        <div class="mastery-celebration-title">Question Mastered</div>
        <div class="mastery-celebration-sub">This question has been marked as mastered and removed from your queue.</div>
      `;
      document.getElementById('feedbackPanel').after(cel);
    }
    cel.classList.add('visible');
  }

  // ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function confirmNextQuestion() {
    resetForNextQuestion();
    loadNextQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function retryQuestion() {
    resetForNextQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
    // Keep same question ‚Äî no loadNextQuestion call
  }

  function skipQuestion() {
    clearCountdown();
    resetForNextQuestion();
    loadNextQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function resetForNextQuestion() {
    clearCountdown();
    resetQuestionVisibility();
    peeked = false;

    if (interviewModeOn) setTimeout(() => startCountdown(), 300);

    document.getElementById('feedbackPanel').classList.remove('visible');
    const cel = document.getElementById('masteryCelebration');
    if (cel) cel.classList.remove('visible');

    // Reset voice
    finalTranscript = '';
    interimTranscript = '';
    updateTranscriptDisplay();
    switchToLiveTranscript();
    document.getElementById('transcriptWrap').style.display = 'none';
    document.getElementById('transcriptCursor').style.display = 'none';
    document.getElementById('recordBtn').classList.remove('recording');
    document.getElementById('pulseRing').classList.remove('active');
    document.getElementById('recordStatus').textContent = 'Tap to start answering';
    document.getElementById('recordSub').textContent = 'Speak your answer clearly ‚Äî just like in a real interview';
    document.getElementById('micIcon').innerHTML = '<path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/>';
    document.querySelectorAll('.wave-bar').forEach(b => { b.classList.remove('active'); b.style.height = '6px'; });
    isRecording = false;

    // Reset text
    document.getElementById('answerTextarea').value = '';
    updateWordCount();

    // Reset verdict
    document.getElementById('verdictScore').textContent = '‚Äî';
    document.getElementById('verdictLabel').textContent = '‚Äî';
    document.getElementById('verdictBadge').className = 'verdict-badge';
    ['barTechnical','barCompleteness','barStructure'].forEach(id => {
      document.getElementById(id).style.width = '0%';
    });
  }

  // ‚îÄ‚îÄ‚îÄ QUESTION BANK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const QUESTION_BANK = [{"id": "acc_basic_001", "question": "Walk me through the 3 financial statements.", "model_answer": "‚ÄúThe 3 major financial statements are the Income Statement, Balance Sheet and Cash Flow Statement. The Income Statement gives the company‚Äôs revenue and expenses, and goes down to Net Income, the final line on the statement. The Balance Sheet shows the company‚Äôs Assets ‚Äì its resources ‚Äì such as Cash, Inventory and PP&E, as well as its Liabilities ‚Äì such as Debt and Accounts Payable ‚Äì and Shareholders‚Äô Equity. Assets must equal Liabilities plus Shareholders‚Äô Equity. The Cash Flow Statement begins with Net Income, adjusts for non-cash expenses and working capital changes, and then lists cash flow from investing and financing activities; at the end, you see the company‚Äôs net change in cash.‚Äù", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_002", "question": "Can you give examples of major line items on each of the financial statements?", "model_answer": "Income Statement: Revenue; Cost of Goods Sold; SG&A (Selling, General & Administrative Expenses); Operating Income; Pretax Income; Net Income. Balance Sheet: Cash; Accounts Receivable; Inventory; Plants, Property & Equipment (PP&E); Accounts Payable; Accrued Expenses; Debt; Shareholders‚Äô Equity. Cash Flow Statement: Net Income; Depreciation & Amortization; Stock-Based Compensation; Changes in Operating Assets & Liabilities; Cash Flow From Operations; Capital Expenditures; Cash Flow From Investing; Sale/Purchase of Securities; Dividends Issued; Cash Flow From Financing.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_003", "question": "How do the 3 statements link together?", "model_answer": "‚ÄúTo tie the statements together, Net Income from the Income Statement flows into Shareholders‚Äô Equity on the Balance Sheet, and into the top line of the Cash Flow Statement. Changes to Balance Sheet items appear as working capital changes on the Cash Flow Statement, and investing and financing activities affect Balance Sheet items such as PP&E, Debt and Shareholders‚Äô Equity. The Cash and Shareholders‚Äô Equity items on the Balance Sheet act as ‚Äúplugs,‚Äù with Cash flowing in from the final line on the Cash Flow Statement.‚Äù", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_004", "question": "If I were stranded on a desert island, only had 1 statement and I wanted to review the overall health of a company ‚Äì which statement would I use and why?", "model_answer": "You would use the Cash Flow Statement because it gives a true picture of how much cash the company is actually generating, independent of all the non-cash expenses you might have. And that‚Äôs the #1 thing you care about when analyzing the overall financial health of any business ‚Äì its cash flow.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_005", "question": "Let‚Äôs say I could only look at 2 statements to assess a company‚Äôs prospects ‚Äì which 2 would I use and why?", "model_answer": "You would pick the Income Statement and Balance Sheet, because you can create the Cash Flow Statement from both of those (assuming, of course that you have ‚Äúbefore‚Äù and ‚Äúafter‚Äù versions of the Balance Sheet that correspond to the same period the Income Statement is tracking).", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_006", "question": "Walk me through how Depreciation going up by $10 would affect the statements.", "model_answer": "Income Statement: Operating Income would decline by $10 and assuming a 40% tax rate, Net Income would go down by $6. Cash Flow Statement: The Net Income at the top goes down by $6, but the $10 Depreciation is a non-cash expense that gets added back, so overall Cash Flow from Operations goes up by $4. There are no changes elsewhere, so the overall Net Change in Cash goes up by $4. Balance Sheet: Plants, Property & Equipment goes down by $10 on the Assets side because of the Depreciation, and Cash is up by $4 from the changes on the Cash Flow Statement. Overall, Assets is down by $6. Since Net Income fell by $6 as well, Shareholders‚Äô Equity on the Liabilities & Shareholders‚Äô Equity side is down by $6 and both sides of the Balance Sheet balance. Note: With this type of question I always recommend going in the order:", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_007", "question": "If Depreciation is a non-cash expense, why does it affect the cash balance?", "model_answer": "Although Depreciation is a non-cash expense, it is tax-deductible. Since taxes are a cash expense, Depreciation affects cash by reducing the amount of taxes you pay.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_009", "question": "What happens when Accrued Compensation goes up by $10?", "model_answer": "For this question, confirm that the accrued compensation is now being recognized as an expense (as opposed to just changing non-accrued to accrued compensation). Assuming that‚Äôs the case, Operating Expenses on the Income Statement go up by $10, Pre-Tax Income falls by $10, and Net Income falls by $6 (assuming a 40% tax rate). On the Cash Flow Statement, Net Income is down by $6, and Accrued Compensation will increase Cash Flow by $10, so overall Cash Flow from Operations is up by $4 and the Net Change in Cash at the bottom is up by $4. On the Balance Sheet, Cash is up by $4 as a result, so Assets are up by $4. On the Liabilities & Equity side, Accrued Compensation is a liability so Liabilities are up by $10 and Retained Earnings are down by $6 due to the Net Income, so both sides balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_010", "question": "What happens when Inventory goes up by $10, assuming you pay for it with cash? No changes to the Income Statement.", "model_answer": "On the Cash Flow Statement, Inventory is an asset so that decreases your Cash Flow from Operations ‚Äì it goes down by $10, as does the Net Change in Cash at the bottom. On the Balance Sheet under Assets, Inventory is up by $10 but Cash is down by $10, so the changes cancel out and Assets still equals Liabilities & Shareholders‚Äô Equity.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_011", "question": "Why is the Income Statement not affected by changes in Inventory?", "model_answer": "This is a common interview mistake ‚Äì incorrectly stating that Working Capital changes show up on the Income Statement. In the case of Inventory, the expense is only recorded when the goods associated with it are sold ‚Äì so if it‚Äôs just sitting in a warehouse, it does not count as a Cost of Good Sold or Operating Expense until the company manufactures it into a product and sells it.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_012", "question": "Let‚Äôs say Apple is buying $100 worth of new iPod factories with debt. How are all 3 statements affected at the start of ‚ÄúYear 1,‚Äù before anything else happens? At the start of ‚ÄúYear 1,‚Äù before anything else has happened, there would be no changes on Apple‚Äôs Income Statement (yet).", "model_answer": "On the Cash Flow Statement, the additional investment in factories would show up under Cash Flow from Investing as a net reduction in Cash Flow (so Cash Flow is down by $100 so far). And the additional $100 worth of debt raised would show up as an addition to Cash Flow, canceling out the investment activity. So the cash number stays the same. On the Balance Sheet, there is now an additional $100 worth of factories in the Plants, Property & Equipment line, so PP&E is up by $100 and Assets is therefore up by $100. On the other side, debt is up by $100 as well and so both sides balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_013", "question": "Now let‚Äôs go out 1 year, to the start of Year 2. Assume the debt is high-yield so no principal is paid off, and assume an interest rate of 10%. Also assume the factories depreciate at a rate of 10% per year. What happens?", "model_answer": "After a year has passed, Apple must pay interest expense and must record the depreciation. Operating Income would decrease by $10 due to the 10% depreciation charge each year, and the $10 in additional Interest Expense would decrease the Pre-Tax Income by $20 altogether ($10 from the depreciation and $10 from Interest Expense). Assuming a tax rate of 40%, Net Income would fall by $12. On the Cash Flow Statement, Net Income at the top is down by $12. Depreciation is a non-cash expense, so you add it back and the end result is that Cash Flow from Operations is down by $2. That‚Äôs the only change on the Cash Flow Statement, so overall Cash is down by $2. On the Balance Sheet, under Assets, Cash is down by $2 and PP&E is down by $10 due to the depreciation, so overall Assets are down by $12. On the other side, since Net Income was down by $12, Shareholders‚Äô Equity is also down by $12 and both sides balance. Remember, the debt number under Liabilities does not change since we‚Äôve assumed none of the debt is actually paid back.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_014", "question": "At the start of Year 3, the factories all break down and the value of the equipment is written down to $0. The loan must also be paid back now. Walk me through the 3 statements.", "model_answer": "After 2 years, the value of the factories is now $80 if we go with the 10% depreciation per year assumption. It is this $80 that we will write down in the 3 statements. First, on the Income Statement, the $80 write-down shows up in the Pre-Tax Income line. With a 40% tax rate, Net Income declines by $48. On the Cash Flow Statement, Net Income is down by $48 but the write-down is a non- cash expense, so we add it back ‚Äì and therefore Cash Flow from Operations increases by $32. There are no changes under Cash Flow from Investing, but under Cash Flow from Financing there is a $100 charge for the loan payback ‚Äì so Cash Flow from Investing falls by $100. Overall, the Net Change in Cash falls by $68. On the Balance Sheet, Cash is now down by $68 and PP&E is down by $80, so Assets have decreased by $148 altogether. On the other side, Debt is down $100 since it was paid off, and since Net Income was down by $48, Shareholders‚Äô Equity is down by $48 as well. Altogether, Liabilities & Shareholders‚Äô Equity are down by $148 and both sides balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_015", "question": "Now let‚Äôs look at a different scenario and assume Apple is ordering $10 of additional iPod inventory, using cash on hand. They order the inventory, but they have not manufactured or sold anything yet ‚Äì what happens to the 3 statements?", "model_answer": "No changes to the Income Statement. Cash Flow Statement ‚Äì Inventory is up by $10, so Cash Flow from Operations decreases by $10. There are no further changes, so overall Cash is down by $10. On the Balance Sheet, Inventory is up by $10 and Cash is down by $10 so the Assets number stays the same and the Balance Sheet remains in balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_016", "question": "Now let‚Äôs say they sell the iPods for revenue of $20, at a cost of $10. Walk me through the 3 statements under this scenario.", "model_answer": "Income Statement: Revenue is up by $20 and COGS is up by $10, so Gross Profit is up by $10 and Operating Income is up by $10 as well. Assuming a 40% tax rate, Net Income is up by $6. Cash Flow Statement: Net Income at the top is up by $6 and Inventory has decreased by $10 (since we just manufactured the inventory into real iPods), which is a net addition to cash flow ‚Äì so Cash Flow from Operations is up by $16 overall. These are the only changes on the Cash Flow Statement, so Net Change in Cash is up by $16. On the Balance Sheet, Cash is up by $16 and Inventory is down by $10, so Assets is up by $6 overall. On the other side, Net Income was up by $6 so Shareholders‚Äô Equity is up by $6 and both sides balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_002", "question": "It can also happen if the company has been losing money consistently and therefore has a declining Retained Earnings balance, which is a portion of Shareholders‚Äô Equity.", "model_answer": "It doesn‚Äôt ‚Äúmean‚Äù anything in particular, but it can be a cause for concern and possibly demonstrate that the company is struggling (in the second scenario). Note: Shareholders‚Äô equity never turns negative immediately after an LBO ‚Äì it would only happen following a dividend recap or continued net losses.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_018", "question": "What is working capital? How is it used? Working Capital = Current Assets ‚Äì Current Liabilities. If it‚Äôs positive, it means a company can pay off its short-term liabilities with its short- term assets. It is often presented as a financial metric and its magnitude and sign (negative or positive) tells you whether or not the company is ‚Äúsound.‚Äù", "model_answer": "Bankers look at Operating Working Capital more commonly in models, and that is defined as (Current Assets ‚Äì Cash & Cash Equivalents) ‚Äì (Current Liabilities ‚Äì Debt).", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_020", "question": "Recently, banks have been writing down their assets and taking huge quarterly losses. Walk me through what happens on the 3 statements when there‚Äôs a write- down of $100.", "model_answer": "First, on the Income Statement, the $100 write-down shows up in the Pre-Tax Income line. With a 40% tax rate, Net Income declines by $60. On the Cash Flow Statement, Net Income is down by $60 but the write-down is a non- cash expense, so we add it back ‚Äì and therefore Cash Flow from Operations increases by $40. Overall, the Net Change in Cash rises by $40. On the Balance Sheet, Cash is now up by $40 and an asset is down by $100 (it‚Äôs not clear which asset since the question never stated the specific asset to write-down). Overall, the Assets side is down by $60. On the other side, since Net Income was down by $60, Shareholders‚Äô Equity is also down by $60 ‚Äì and both sides balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_021", "question": "Walk me through a $100 ‚Äúbailout‚Äù of a company and how it affects the 3 statements.", "model_answer": "First, confirm what type of ‚Äúbailout‚Äù this is ‚Äì Debt? Equity? A combination? The most common scenario here is an equity investment from the government, so here‚Äôs what happens: No changes to the Income Statement. On the Cash Flow Statement, Cash Flow from Financing goes up by $100 to reflect the government‚Äôs investment, so the Net Change in Cash is up by $100. On the Balance Sheet, Cash is up by $100 so Assets are up by $100; on the other side, Shareholders‚Äô Equity would go up by $100 to make it balance.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_022", "question": "Walk me through a $100 write-down of debt ‚Äì as in OWED debt, a liability ‚Äì on a company‚Äôs balance sheet and how it affects the 3 statements.", "model_answer": "This is counter-intuitive. When a liability is written down you record it as a gain on the Income Statement (with an asset write-down, it‚Äôs a loss) ‚Äì so Pre-Tax Income goes up by $100 due to this write-down. Assuming a 40% tax rate, Net Income is up by $60. On the Cash Flow Statement, Net Income is up by $60, but we need to subtract that debt write-down ‚Äì so Cash Flow from Operations is down by $40, and Net Change in Cash is down by $40. On the Balance Sheet, Cash is down by $40 so Assets are down by $40. On the other side, Debt is down by $100 but Shareholders‚Äô Equity is up by $60 because the Net Income was up by $60 ‚Äì so Liabilities & Shareholders‚Äô Equity is down by $40 and it balances. If this seems strange to you, you‚Äôre not alone ‚Äì see this Forbes article for more on why writing down debt actually benefits companies accounting-wise:", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_003", "question": "Magazine publishers that sell subscriptions Companies that agree to services in the future often collect cash upfront to ensure stable revenue ‚Äì this makes investors happy as well since they can better predict a company‚Äôs performance.", "model_answer": "Per the rules of GAAP (Generally Accepted Accounting Principles), you only record revenue when you actually perform the services ‚Äì so the company would not record everything as revenue right away.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_027", "question": "What‚Äôs the difference between cash-based and accrual accounting? Cash-based accounting recognizes revenue and expenses when cash is actually received or paid out; accrual accounting recognizes revenue when collection is reasonably certain (i.e. after a customer has ordered the product) and recognizes expenses when they are incurred rather than when they are paid out in cash.", "model_answer": "Most large companies use accrual accounting because paying with credit cards and lines of credit is so prevalent these days; very small businesses may use cash-based accounting to simplify their financial statements.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_028", "question": "Let‚Äôs say a customer pays for a TV with a credit card. What would this look like under cash-based vs. accrual accounting? In cash-based accounting, the revenue would not show up until the company charges the customer‚Äôs credit card, receives authorization, and deposits the funds in its bank account ‚Äì at which point it would show up as both Revenue on the Income Statement and Cash on the Balance Sheet.", "model_answer": "In accrual accounting, it would show up as Revenue right away but instead of appearing in Cash on the Balance Sheet, it would go into Accounts Receivable at first. Then, once the cash is actually deposited in the company‚Äôs bank account, it would ‚Äúturn into‚Äù Cash.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_029", "question": "How do you decide when to capitalize rather than expense a purchase? If the asset has a useful life of over 1 year, it is capitalized (put on the Balance Sheet rather than shown as an expense on the Income Statement). Then it is depreciated (tangible assets) or amortized (intangible assets) over a certain number of years.", "model_answer": "Purchases like factories, equipment and land all last longer than a year and therefore show up on the Balance Sheet. Employee salaries and the cost of manufacturing products (COGS) only cover a short period of operations and therefore show up on the Income Statement as normal expenses instead.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_030", "question": "Why do companies report both GAAP and non-GAAP (or ‚ÄúPro Forma‚Äù) earnings? These days, many companies have ‚Äúnon-cash‚Äù charges such as Amortization of Intangibles, Stock-Based Compensation, and Deferred Revenue Write-down in their", "model_answer": "Income Statements. As a result, some argue that Income Statements under GAAP no longer reflect how profitable most companies truly are. Non-GAAP earnings are almost always higher because these expenses are excluded.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_032", "question": "Normally Goodwill remains constant on the Balance Sheet ‚Äì why would it be impaired and what does Goodwill Impairment mean? Usually this happens when a company has been acquired and the acquirer re-assesses its intangible assets (such as customers, brand, and intellectual property) and finds that they are worth significantly less than they originally thought.", "model_answer": "It often happens in acquisitions where the buyer ‚Äúoverpaid‚Äù for the seller and can result in a large net loss on the Income Statement (see: eBay/Skype). It can also happen when a company discontinues part of its operations and must impair the associated goodwill.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_002", "question": "The company acquires another company and pays more than what its assets are worth ‚Äì this is then reflected in the Goodwill number. Accounting Questions & Answers ‚Äì Advanced", "model_answer": "These more advanced questions cover topics like deferred tax assets and liabilities and how to actually project a company‚Äôs financial statements in an operating model. You may get some of these in investment banking interviews, but they‚Äôre more common if you‚Äôve had significant finance experience or you‚Äôre interviewing for private equity, or with a more technical group.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_002", "question": "What are deferred tax assets/liabilities and how do they arise? They arise because of temporary differences between what a company can deduct for cash tax purposes vs. what they can deduct for book tax purposes.", "model_answer": "Deferred Tax Liabilities arise when you have a tax expense on the Income Statement but haven‚Äôt actually paid that tax in cold, hard cash yet; Deferred Tax Assets arise when you pay taxes in cash but haven‚Äôt expensed them on the Income Statement yet. The most common way they occur is with asset write-ups and write-downs in M&A deals ‚Äì an asset write-up will produce a deferred tax liability while a write-down will produce a deferred tax asset (see the Merger Model section for more on this).", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_basic_003", "question": "Walk me through how you create a revenue model for a company. There are 2 ways you could do this: a bottoms-up build and a tops-down build. ‚Ä¢", "model_answer": "Bottoms-Up: Start with individual products / customers, estimate the average sale value or customer value, and then the growth rate in sales and sale values to tie everything together.", "topic": "Accounting", "difficulty": "easy", "source": "BIWS_400"}, {"id": "acc_adv_004", "question": "Walk me through how you create an expense model for a company. To do a true bottoms-up build, you start with each different department of a company, the # of employees in each, the average salary, bonuses, and benefits, and then make assumptions on those going forward.", "model_answer": "Usually you assume that the number of employees is tied to revenue, and then you assume growth rates for salary, bonuses, benefits, and other metrics. Cost of Goods Sold should be tied directly to Revenue and each ‚Äúunit‚Äù produced should incur an expense. Other items such as rent, Capital Expenditures, and miscellaneous expenses are either linked to the company‚Äôs internal plans for building expansion plans (if they have them), or to Revenue for a more simple model.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_005", "question": "Let‚Äôs say we‚Äôre trying to create these models but don‚Äôt have enough information or the company doesn‚Äôt tell us enough in its filings ‚Äì what do we do? Use estimates. For the revenue if you don‚Äôt have enough information to look at separate product lines or divisions of the company, you can just assume a simple growth rate into future years.", "model_answer": "For the expenses, if you don‚Äôt have employee-level information then you can just assume that major expenses like SG&A are a percent of revenue and carry that assumption forward.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_006", "question": "Walk me through the major items in Shareholders‚Äô Equity. Common items include: ‚Ä¢", "model_answer": "Common Stock ‚Äì Simply the par value of however much stock the company has issued. ‚Ä¢ Retained Earnings ‚Äì How much of the company‚Äôs Net Income it has ‚Äúsaved up‚Äù over time. ‚Ä¢ Additional Paid in Capital ‚Äì This keeps track of how much stock-based compensation has been issued and how much new stock employees exercising options have created. It also includes how much over par value a company raises in an IPO or other equity offering. ‚Ä¢ Treasury Stock ‚Äì The dollar amount of shares that the company has bought back. ‚Ä¢ Accumulated Other Comprehensive Income ‚Äì This is a ‚Äúcatch-all‚Äù that includes other items that don‚Äôt fit anywhere else, like the effect of foreign currency exchange rates changing.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_007", "question": "Walk me through what flows into Retained Earnings. Retained Earnings = Old Retained Earnings Balance + Net Income ‚Äì Dividends Issued If you‚Äôre calculating Retained Earnings for the current year, take last year‚Äôs Retained", "model_answer": "Earnings number, add this year‚Äôs Net Income, and subtract however much the company paid out in dividends.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_009", "question": "What is the Statement of Shareholders‚Äô Equity and why do we use it? This statement shows everything we went through above ‚Äì the major items that comprise Shareholders‚Äô Equity, and how we arrive at each of them using the numbers elsewhere in the statement.", "model_answer": "You don‚Äôt use it too much, but it can be helpful for analyzing companies with unusual stock-based compensation and stock option situations.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_010", "question": "What are examples of non-recurring charges we need to add back to a company‚Äôs EBIT / EBITDA when looking at its financial statements? ‚Ä¢", "model_answer": "Restructuring Charges ‚Ä¢ Goodwill Impairment ‚Ä¢ Asset Write-Downs ‚Ä¢ Bad Debt Expenses ‚Ä¢ Legal Expenses ‚Ä¢ Disaster Expenses ‚Ä¢ Change in Accounting Procedures Note that to be an ‚Äúadd-back‚Äù or ‚Äúnon-recurring‚Äù charge for EBITDA / EBIT purposes, it needs to affect Operating Income on the Income Statement. So if you have one of these charges ‚Äúbelow the line‚Äù then you do not add it back for the EBITDA / EBIT calculation. Also note that you do add back Depreciation, Amortization, and sometimes Stock-Based Compensation for EBITDA / EBIT, but that these are not ‚Äúnon-recurring charges‚Äù because all companies have them every year ‚Äì these are just non-cash charges.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_011", "question": "How do you project Balance Sheet items like Accounts Receivable and Accrued Expenses in a 3-statement model? Normally you make very simple assumptions here and assume these are percentages of revenue, operating expenses, or cost of goods sold. Examples: ‚Ä¢", "model_answer": "Accounts Receivable: % of revenue. ‚Ä¢ Deferred Revenue: % of revenue. ‚Ä¢ Accounts Payable: % of COGS. ‚Ä¢ Accrued Expenses: % of operating expenses or SG&A. Then you either carry the same percentages across in future years or assume slight changes depending on the company.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_013", "question": "How do Net Operating Losses (NOLs) affect a company‚Äôs 3 statements? The ‚Äúquick and dirty‚Äù way to do this: reduce the Taxable Income by the portion of the NOLs that you can use each year, apply the same tax rate, and then subtract that new", "model_answer": "Tax number from your old Pretax Income number (which should stay the same). The way you should do this: create a book vs. cash tax schedule where you calculate the Taxable Income based on NOLs, and then look at what you would pay in taxes without the NOLs. Then you book the difference as an increase to the Deferred Tax Liability on the Balance Sheet. This method reflects the fact that you‚Äôre saving on cash flow ‚Äì since the DTL, a liability, is rising ‚Äì but correctly separates the NOL impact into book vs. cash taxes.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_014", "question": "What‚Äôs the difference between capital leases and operating leases? Operating leases are used for short-term leasing of equipment and property, and do not involve ownership of anything. Operating lease expenses show up as operating expenses on the Income Statement.", "model_answer": "Capital leases are used for longer-term items and give the lessee ownership rights; they depreciate and incur interest payments, and are counted as debt. A lease is a capital lease if any one of the following 4 conditions is true:", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_015", "question": "Why would the Depreciation & Amortization number on the Income Statement be different from what‚Äôs on the Cash Flow Statement? This happens if D&A is embedded in other Income Statement line items. When this happens, you need to use the Cash Flow Statement number to arrive at EBITDA because otherwise you‚Äôre undercounting D&A.", "model_answer": "Enterprise / Equity Value Questions & Answers ‚Äì Basic For the most part, Enterprise Value and Equity Value questions are straightforward. Just make sure you know all the relevant formulas and understand concepts like the Treasury Stock Method for calculating diluted shares.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_001", "question": "Why do we look at both Enterprise Value and Equity Value? Enterprise Value represents the value of the company that is attributable to all investors; Equity Value only represents the portion available to shareholders (equity investors).", "model_answer": "You look at both because Equity Value is the number the public-at-large sees, while Enterprise Value represents its true value.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_003", "question": "What‚Äôs the formula for Enterprise Value? EV = Equity Value + Debt + Preferred Stock + Minority Interest - Cash (This formula does not tell the whole story and can get more complex ‚Äì see the", "model_answer": "Advanced Questions. Most of the time you can get away with stating this formula in an interview, though).", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "acc_adv_004", "question": "Why do you need to add Minority Interest to Enterprise Value? Whenever a company owns over 50% of another company, it is required to report the financial performance of the other company as part of its own performance.", "model_answer": "So even though it doesn‚Äôt own 100%, it reports 100% of the majority-owned subsidiary‚Äôs financial performance. In keeping with the ‚Äúapples-to-apples‚Äù theme, you must add Minority Interest to get to Enterprise Value so that your numerator and denominator both reflect 100% of the majority-owned subsidiary.", "topic": "Accounting", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ev_basic_005", "question": "How do you calculate fully diluted shares? Take the basic share count and add in the dilutive effect of stock options and any other dilutive securities, such as warrants, convertible debt or convertible preferred stock.", "model_answer": "To calculate the dilutive effect of options, you use the Treasury Stock Method (detail on this below).", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_006", "question": "Let‚Äôs say a company has 100 shares outstanding, at a share price of $10 each. It also has 10 options outstanding at an exercise price of $5 each ‚Äì what is its fully diluted equity value?", "model_answer": "Its basic equity value is $1,000 (100 * $10 = $1,000). To calculate the dilutive effect of the options, first you note that the options are all ‚Äúin-the-money‚Äù ‚Äì their exercise price is less than the current share price. When these options are exercised, there will be 10 new shares created ‚Äì so the share count is now 110 rather than 100. However, that doesn‚Äôt tell the whole story. In order to exercise the options, we had to ‚Äúpay‚Äù the company $5 for each option (the exercise price). As a result, it now has $50 in additional cash, which it now uses to buy back 5 of the new shares we created. So the fully diluted share count is 105, and the fully diluted equity value is $1,050.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_008", "question": "Why do you subtract cash in the formula for Enterprise Value? Is that always accurate? The ‚Äúofficial‚Äù reason: Cash is subtracted because it‚Äôs considered a non-operating asset and because Equity Value implicitly accounts for it.", "model_answer": "The way I think about it: In an acquisition, the buyer would ‚Äúget‚Äù the cash of the seller, so it effectively pays less for the company based on how large its cash balance is. Remember, Enterprise Value tells us how much you‚Äôd really have to ‚Äúpay‚Äù to acquire another company. It‚Äôs not always accurate because technically you should be subtracting only excess cash ‚Äì the amount of cash a company has above the minimum cash it requires to operate.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_009", "question": "Is it always accurate to add Debt to Equity Value when calculating Enterprise Value? In most cases, yes, because the terms of a debt agreement usually say that debt must be refinanced in an acquisition. And in most cases a buyer will pay off a seller‚Äôs debt, so it is accurate to say that any debt ‚Äúadds‚Äù to the purchase price.", "model_answer": "However, there could always be exceptions where the buyer does not pay off the debt. These are rare and I‚Äôve personally never seen it, but once again ‚Äúnever say never‚Äù applies.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_013", "question": "How do you account for convertible bonds in the Enterprise Value formula? If the convertible bonds are in-the-money, meaning that the conversion price of the bonds is below the current share price, then you count them as additional dilution to the", "model_answer": "Equity Value; if they‚Äôre out-of-the-money then you count the face value of the convertibles as part of the company‚Äôs Debt.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_014", "question": "A company has 1 million shares outstanding at a value of $100 per share. It also has $10 million of convertible bonds, with par value of $1,000 and a conversion price of $50. How do I calculate diluted shares outstanding?", "model_answer": "This gets confusing because of the different units involved. First, note that these convertible bonds are in-the-money because the company‚Äôs share price is $100, but the conversion price is $50. So we count them as additional shares rather than debt. Next, we need to divide the value of the convertible bonds ‚Äì $10 million ‚Äì by the par value ‚Äì $1,000 ‚Äì to figure out how many individual bonds we get: $10 million / $1,000 = 10,000 convertible bonds. Next, we need to figure out how many shares this number represents. The number of shares per bond is the par value divided by the conversion price: $1,000 / $50 = 20 shares per bond. So we have 200,000 new shares (20 * 10,000) created by the convertibles, giving us 1.2 million diluted shares outstanding. We do not use the Treasury Stock Method with convertibles because the company is not ‚Äúreceiving‚Äù any cash from us.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_015", "question": "What‚Äôs the difference between Equity Value and Shareholders‚Äô Equity? Equity Value is the market value and Shareholders‚Äô Equity is the book value. Equity Value can never be negative because shares outstanding and share prices can never be negative, whereas Shareholders‚Äô Equity could be any value. For healthy companies,", "model_answer": "Equity Value usually far exceeds Shareholders‚Äô Equity. Enterprise / Equity Value Questions & Answers ‚Äì Advanced These more advanced questions cover some of the ‚Äúproblems‚Äù with the traditional formula for Enterprise Value, as well as details about book value and market value. You‚Äôre not likely to get these in the standard entry-level investment banking interview, but it‚Äôs always good to be prepared.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_basic_001", "question": "Are there any problems with the Enterprise Value formula you just gave me? Yes ‚Äì it‚Äôs too simple. There are lots of other things you need to add into the formula with real companies: ‚Ä¢", "model_answer": "Net Operating Losses ‚Äì Should be valued and arguably added in, similar to cash. ‚Ä¢ Long-Term Investments ‚Äì These should be counted, similar to cash. ‚Ä¢ Equity Investments ‚Äì Any investments in other companies should also be added in, similar to cash (though they might be discounted). ‚Ä¢ Capital Leases ‚Äì Like debt, these have interest payments ‚Äì so they should be added in like debt. ‚Ä¢ (Some) Operating Leases ‚Äì Sometimes you need to convert operating leases to capital leases and add them as well. ‚Ä¢ Pension Obligations ‚Äì Sometimes these are counted as debt as well. So a more ‚Äúcorrect‚Äù formula would be Enterprise Value = Equity Value ‚Äì Cash + Debt + Preferred Stock + Minority Interest ‚Äì NOLs ‚Äì Investments + Capital Leases + Pension Obligations‚Ä¶ In interviews, usually you can get away with saying ‚ÄúEnterprise Value = Equity Value ‚Äì Cash + Debt + Preferred Stock + Minority Interest‚Äù I mention this here because in more advanced interviews you might get questions on this topic.", "topic": "Enterprise_Value", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ev_adv_003", "question": "What percentage dilution in Equity Value is ‚Äútoo high?‚Äù There‚Äôs no strict ‚Äúrule‚Äù here but most bankers would say that anything over 10% is odd. If your basic Equity Value is $100 million and the diluted Equity Value is $115 million, you might want to check your calculations ‚Äì it‚Äôs not necessarily wrong, but over 10% dilution is unusual for most companies.", "model_answer": "Valuation Questions & Answers ‚Äì Basic These days, you need to have a better-than-average understanding of Valuation. Forget about just knowing the 3 methodologies ‚Äì you need to understand how and why they‚Äôre used, which ones produce the highest or lowest values and also keep in mind some exceptions to each ‚Äúrule.‚Äù", "topic": "Enterprise_Value", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ev_adv_002", "question": "Rank the 3 valuation methodologies from highest to lowest expected value. Trick question ‚Äì there is no ranking that always holds. In general, Precedent Transactions will be higher than Comparable Companies due to the Control Premium built into acquisitions.", "model_answer": "Beyond that, a DCF could go either way and it‚Äôs best to say that it‚Äôs more variable than other methodologies. Often it produces the highest value, but it can produce the lowest value as well depending on your assumptions.", "topic": "Enterprise_Value", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ev_adv_003", "question": "When would you not use a DCF in a Valuation? You do not use a DCF if the company has unstable or unpredictable cash flows (tech or bio-tech startup) or when debt and working capital serve a fundamentally different role.", "model_answer": "For example, banks and financial institutions do not re-invest debt and working capital is a huge part of their Balance Sheets ‚Äì so you wouldn‚Äôt use a DCF for such companies.", "topic": "Enterprise_Value", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ev_adv_004", "question": "What other Valuation methodologies are there? Other methodologies include: ‚Ä¢", "model_answer": "Liquidation Valuation ‚Äì Valuing a company‚Äôs assets, assuming they are sold off and then subtracting liabilities to determine how much capital, if any, equity investors receive ‚Ä¢ Replacement Value ‚Äì Valuing a company based on the cost of replacing its assets ‚Ä¢ LBO Analysis ‚Äì Determining how much a PE firm could pay for a company to hit a ‚Äútarget‚Äù IRR, usually in the 20-25% range", "topic": "Enterprise_Value", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_basic_005", "question": "When would you use a Liquidation Valuation?", "model_answer": "This is most common in bankruptcy scenarios and is used to see whether equity shareholders will receive any capital after the company‚Äôs debts have been paid off. It is often used to advise struggling businesses on whether it‚Äôs better to sell off assets separately or to try and sell the entire company.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_006", "question": "When would you use Sum of the Parts?", "model_answer": "This is most often used when a company has completely different, unrelated divisions ‚Äì a conglomerate like General Electric, for example. If you have a plastics division, a TV and entertainment division, an energy division, a consumer financing division and a technology division, you should not use the same set of Comparable Companies and Precedent Transactions for the entire company. Instead, you should use different sets for each division, value each one separately, and then add them together to get the Combined Value.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_007", "question": "When do you use an LBO Analysis as part of your Valuation? Obviously you use this whenever you‚Äôre looking at a Leveraged Buyout ‚Äì but it is also used to establish how much a private equity firm could pay, which is usually lower than what companies will pay.", "model_answer": "It is often used to set a ‚Äúfloor‚Äù on a possible Valuation for the company you‚Äôre looking at.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_008", "question": "What are the most common multiples used in Valuation?", "model_answer": "The most common multiples are EV/Revenue, EV/EBITDA, EV/EBIT, P/E (Share Price / Earnings per Share), and P/BV (Share Price / Book Value).", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_009", "question": "What are some examples of industry-specific multiples? Technology (Internet): EV / Unique Visitors, EV / Pageviews Retail / Airlines: EV / EBITDAR (Earnings Before Interest, Taxes, Depreciation,", "model_answer": "Amortization & Rent) Energy: P / MCFE, P / MCFE / D (MCFE = 1 Million Cubic Foot Equivalent, MCFE/D = MCFE per Day), P / NAV (Share Price / Net Asset Value) Real Estate Investment Trusts (REITs): Price / FFO, Price / AFFO (Funds From Operations, Adjusted Funds From Operations) Technology and Energy should be straightforward ‚Äì you‚Äôre looking at traffic and energy reserves as value drivers rather than revenue or profit. For Retail / Airlines, you often remove Rent because it is a major expense and one that varies significantly between different types of companies. For REITs, Funds From Operations is a common metric that adds back Depreciation and subtracts gains on the sale of property. Depreciation is a non-cash yet extremely large expense in real estate, and gains on sales of properties are assumed to be non-recurring, so FFO is viewed as a ‚Äúnormalized‚Äù picture of the cash flow the REIT is generating.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_010", "question": "When you‚Äôre looking at an industry-specific multiple like EV / Scientists or EV / Subscribers, why do you use Enterprise Value rather than Equity Value?", "model_answer": "You use Enterprise Value because those scientists or subscribers are ‚Äúavailable‚Äù to all the investors (both debt and equity) in a company. The same logic doesn‚Äôt apply to everything, though ‚Äì you need to think through the multiple and see which investors the particular metric is ‚Äúavailable‚Äù to.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_011", "question": "Would an LBO or DCF give a higher valuation? Technically it could go either way, but in most cases the LBO will give you a lower valuation.", "model_answer": "Here‚Äôs the easiest way to think about it: with an LBO, you do not get any value from the cash flows of a company in between Year 1 and the final year ‚Äì you‚Äôre only valuing it based on its terminal value. With a DCF, by contrast, you‚Äôre taking into account both the company‚Äôs cash flows in between and its terminal value, so values tend to be higher. Note: Unlike a DCF, an LBO model by itself does not give a specific valuation. Instead, you set a desired IRR and determine how much you could pay for the company (the valuation) based on that.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_012", "question": "How would you present these Valuation methodologies to a company or its investors? Usually you use a ‚Äúfootball field‚Äù chart where you show the valuation range implied by each methodology. You always show a range rather than one specific number.", "model_answer": "As an example, see page 10 of this document (a Valuation done by Credit Suisse for the Leveraged Buyout of Sungard Data Systems in 2005):", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_013", "question": "How would you value an apple tree? The same way you would value a company: by looking at what comparable apple trees are worth (relative valuation) and the value of the apple tree‚Äôs cash flows (intrinsic valuation).", "model_answer": "Yes, you could do a DCF for anything ‚Äì even an apple tree.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_014", "question": "Why can‚Äôt you use Equity Value / EBITDA as a multiple rather than Enterprise Value / EBITDA? EBITDA is available to all investors in the company ‚Äì rather than just equity holders.", "model_answer": "Similarly, Enterprise Value is also available to all shareholders so it makes sense to pair them together. Equity Value / EBITDA, however, is comparing apples to oranges because Equity Value does not reflect the company‚Äôs entire capital structure ‚Äì only the part available to equity investors.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_015", "question": "When would a Liquidation Valuation produce the highest value?", "model_answer": "This is highly unusual, but it could happen if a company had substantial hard assets but the market was severely undervaluing it for a specific reason (such as an earnings miss or cyclicality). As a result, the company‚Äôs Comparable Companies and Precedent Transactions would likely produce lower values as well ‚Äì and if its assets were valued highly enough, Liquidation Valuation might give a higher value than other methodologies.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_016", "question": "Let‚Äôs go back to 2004 and look at Facebook back when it had no profit and no revenue. How would you value it?", "model_answer": "You would use Comparable Companies and Precedent Transactions and look at more ‚Äúcreative‚Äù multiples such as EV/Unique Visitors and EV/Pageviews rather than EV/Revenue or EV/EBITDA. You would not use a ‚Äúfar in the future DCF‚Äù because you can‚Äôt reasonably predict cash flows for a company that is not even making money yet. This is a very common wrong answer given by interviewees. When you can‚Äôt predict cash flow, use other metrics ‚Äì don‚Äôt try to predict cash flow anyway!", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_017", "question": "What would you use in conjunction with Free Cash Flow multiples ‚Äì Equity Value or Enterprise Value? Trick question. For Unlevered Free Cash Flow, you would use Enterprise Value, but for", "model_answer": "Levered Free Cash Flow you would use Equity Value. Remember, Unlevered Free Cash Flow excludes Interest and thus represents money available to all investors, whereas Levered already includes Interest and the money is therefore only available to equity investors. Debt investors have already ‚Äúbeen paid‚Äù with the interest payments they received.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_018", "question": "You never use Equity Value / EBITDA, but are there any cases where you might use Equity Value / Revenue? Never say never. It‚Äôs very rare to see this, but sometimes large financial institutions with big cash balances have negative Enterprise Values ‚Äì so you might use Equity Value / Revenue instead.", "model_answer": "You might see Equity Value / Revenue if you‚Äôve listed a set of financial and non- financial companies on a slide, you‚Äôre showing Revenue multiples for the non-financial companies, and you want to show something similar for the financials. Note, however, that in most cases you would be using other multiples such as P/E and P/BV with banks anyway.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_003", "question": "Geography For Precedent Transactions, you often limit the set based on date and only look at transactions within the past 1-2 years.", "model_answer": "The most important factor is industry ‚Äì that is always used to screen for companies/transactions, and the rest may or may not be used depending on how specific you want to be. Here are a few examples: Comparable Company Screen: Oil & gas producers with market caps over $5 billion Comparable Company Screen: Digital media companies with over $100 million in revenue Precedent Transaction Screen: Airline M&A transactions over the past 2 years involving sellers with over $1 billion in revenue Precedent Transaction Screen: Retail M&A transactions over the past year", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_020", "question": "How do you apply the 3 valuation methodologies to actually get a value for the company you‚Äôre looking at? Sometimes this simple fact gets lost in discussion of Valuation methodologies. You take the median multiple of a set of companies or transactions, and then multiply it by the relevant metric from the company you‚Äôre valuing.", "model_answer": "Example: If the median EBITDA multiple from your set of Precedent Transactions is 8x and your company‚Äôs EBITDA is $500 million, the implied Enterprise Value would be $4 billion. To get the ‚Äúfootball field‚Äù valuation graph you often see, you look at the minimum, maximum, 25th percentile and 75th percentile in each set as well and create a range of values based on each methodology.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_021", "question": "What do you actually use a valuation for? Usually you use it in pitch books and in client presentations when you‚Äôre providing updates and telling them what they should expect for their own valuation.", "model_answer": "It‚Äôs also used right before a deal closes in a Fairness Opinion, a document a bank creates that ‚Äúproves‚Äù the value their client is paying or receiving is ‚Äúfair‚Äù from a financial point of view. Valuations can also be used in defense analyses, merger models, LBO models, DCFs (because terminal multiples are based off of comps), and pretty much anything else in finance.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_022", "question": "Why would a company with similar growth and profitability to its Comparable Companies be valued at a premium? This could happen for a number of reasons: ‚Ä¢", "model_answer": "The company has just reported earnings well-above expectations and its stock price has risen recently. ‚Ä¢ It has some type of competitive advantage not reflected in its financials, such as a key patent or other intellectual property. ‚Ä¢ It has just won a favorable ruling in a major lawsuit. ‚Ä¢ It is the market leader in an industry and has greater market share than its competitors.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_023", "question": "What are the flaws with public company comparables? ‚Ä¢ No company is 100% comparable to another company. ‚Ä¢", "model_answer": "The stock market is ‚Äúemotional‚Äù ‚Äì your multiples might be dramatically higher or lower on certain dates depending on the market‚Äôs movements. ‚Ä¢ Share prices for small companies with thinly-traded stocks may not reflect their full value.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_026", "question": "You mentioned that Precedent Transactions usually produce a higher value than Comparable Companies ‚Äì can you think of a situation where this is not the case? Sometimes this happens when there is a substantial mismatch between the M&A market and the public market. For example, no public companies have been acquired recently but there have been a lot of small private companies acquired at extremely low valuations.", "model_answer": "For the most part this generalization is true but keep in mind that there are exceptions to almost every ‚Äúrule‚Äù in finance.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_027", "question": "What are some flaws with precedent transactions? ‚Ä¢ Past transactions are rarely 100% comparable ‚Äì the transaction structure, size of the company, and market sentiment all have huge effects. ‚Ä¢", "model_answer": "Data on precedent transactions is generally more difficult to find than it is for public company comparables, especially for acquisitions of small private companies.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_029", "question": "Why does Warren Buffett prefer EBIT multiples to EBITDA multiples? Warren Buffett once famously said, \"Does management think the tooth fairy pays for capital expenditures?‚Äù", "model_answer": "He dislikes EBITDA because it excludes the often sizable Capital Expenditures companies make and hides how much cash they are actually using to finance their operations. In some industries there is also a large gap between EBIT and EBITDA ‚Äì anything that is very capital-intensive, for example, will show a big disparity.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_030", "question": "The EV / EBIT, EV / EBITDA, and P / E multiples all measure a company‚Äôs profitability. What‚Äôs the difference between them, and when do you use each one? P / E depends on the company‚Äôs capital structure whereas EV / EBIT and EV / EBITDA are capital structure-neutral. Therefore, you use P / E for banks, financial institutions, and other companies where interest payments / expenses are critical.", "model_answer": "EV / EBIT includes Depreciation & Amortization whereas EV / EBITDA excludes it ‚Äì you‚Äôre more likely to use EV / EBIT in industries where D&A is large and where capital expenditures and fixed assets are important (e.g. manufacturing), and EV / EBITDA in industries where fixed assets are less important and where D&A is comparatively smaller (e.g. Internet companies).", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_031", "question": "If you were buying a vending machine business, would you pay a higher multiple for a business where you owned the machines and they depreciated normally, or one in which you leased the machines? The cost of depreciation and lease are the same dollar amounts and everything else is held constant.", "model_answer": "You would pay more for the one where you lease the machines. Enterprise Value would be the same for both companies, but with the depreciated situation the charge is not reflected in EBITDA ‚Äì so EBITDA is higher, and the EV / EBITDA multiple is lower as a result. For the leased situation, the lease would show up in SG&A so it would be reflected in EBITDA, making EBITDA lower and the EV / EBITDA multiple higher.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_032", "question": "How do you value a private company?", "model_answer": "You use the same methodologies as with public companies: public company comparables, precedent transactions, and DCF. But there are some differences: ‚Ä¢ You might apply a 10-15% (or more) discount to the public company comparable multiples because the private company you‚Äôre valuing is not as ‚Äúliquid‚Äù as the public comps. ‚Ä¢ You can‚Äôt use a premiums analysis or future share price analysis because a private company doesn‚Äôt have a share price. ‚Ä¢ Your valuation shows the Enterprise Value for the company as opposed to the implied per-share price as with public companies. ‚Ä¢ A DCF gets tricky because a private company doesn‚Äôt have a market capitalization or Beta ‚Äì you would probably just estimate WACC based on the public comps‚Äô WACC rather than trying to calculate it.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_033", "question": "Let‚Äôs say we‚Äôre valuing a private company. Why might we discount the public company comparable multiples but not the precedent transaction multiples? There‚Äôs no discount because with precedent transactions, you‚Äôre acquiring the entire company ‚Äì and once it‚Äôs acquired, the shares immediately become illiquid.", "model_answer": "But shares ‚Äì the ability to buy individual ‚Äúpieces‚Äù of a company rather than the whole thing ‚Äì can be either liquid (if it‚Äôs public) or illiquid (if it‚Äôs private). Since shares of public companies are always more liquid, you would discount public company comparable multiples to account for this.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_034", "question": "Can you use private companies as part of your valuation? Only in the context of precedent transactions ‚Äì it would make no sense to include them for public company comparables or as part of the Cost of Equity / WACC calculation in a DCF because they are not public and therefore have no values for market cap or Beta.", "model_answer": "Valuation Questions & Answers ‚Äì Advanced These more advanced questions cover industry-specific valuation in more detail, as well as scenarios like IPO valuation, M&A premiums, and future share price analysis that are not likely to come up in entry-level interviews ‚Äì but which could come up if you‚Äôre going for more advanced positions.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_basic_001", "question": "How do you value banks and financial institutions differently from other companies? You mostly use the same methodologies, except: ‚Ä¢", "model_answer": "You look at P / E and P / BV (Book Value) multiples rather than EV / Revenue, EV / EBITDA, and other ‚Äúnormal‚Äù multiples, since banks have unique capital structures. ‚Ä¢ You pay more attention to bank-specific metrics like NAV (Net Asset Value) and you might screen companies and precedent transactions based on those instead. ‚Ä¢ Rather than a DCF, you use a Dividend Discount Model (DDM) which is similar but is based on the present value of the company‚Äôs dividends rather than its free cash flows. You need to use these methodologies and multiples because interest is a critical component of a bank‚Äôs revenue and because debt is part of its business model rather than just a way to finance acquisitions or expand the business.", "topic": "Valuation", "difficulty": "easy", "source": "BIWS_400"}, {"id": "val_adv_003", "question": "I‚Äôm looking at financial data for a public company comparable, and it‚Äôs April (Q2) right now. Walk me through how you would ‚Äúcalendarize‚Äù this company‚Äôs financial statements to show the Trailing Twelve Months as opposed to just the last Fiscal Year.", "model_answer": "The ‚Äúformula‚Äù to calendarize financial statements is as follows: TTM = Most Recent Fiscal Year + New Partial Period ‚Äì Old Partial Period So in the example above, we would take the company‚Äôs Q1 numbers, add the most recent fiscal year‚Äôs numbers, and then subtract the Q1 numbers from that most recent fiscal year. For US companies you can find these quarterly numbers in the 10-Q; for international companies they‚Äôre in the ‚Äúinterim‚Äù reports.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_004", "question": "Get the medians for each set, and then apply them to your company‚Äôs current share price, share price 20 days ago, etc. to estimate how much of a premium a buyer might pay for it.", "model_answer": "Note that you only use this analysis when valuing public companies because private companies don‚Äôt have share prices. Sometimes the set of companies here is exactly the same as your set of precedent transactions but typically it is broader.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_006", "question": "Both M&A premiums analysis and precedent transactions involve looking at previous M&A transactions. What‚Äôs the difference in how we select them? ‚Ä¢", "model_answer": "All the sellers in the M&A premiums analysis must be public. ‚Ä¢ Usually we use a broader set of transactions for M&A premiums ‚Äì we might use fewer than 10 precedent transactions but we might have dozens of M&A premiums. The industry and financial screens are usually less stringent. ‚Ä¢ Aside from those, the screening criteria is similar ‚Äì financial, industry, geography, and date.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_007", "question": "Walk me through a Sum-of-the-Parts analysis. In a Sum-of-the-Parts analysis, you value each division of a company using separate comparables and transactions, get to separate multiples, and then add up each division‚Äôs value to get the total for the company. Example:", "model_answer": "We have a manufacturing division with $100 million EBITDA, an entertainment division with $50 million EBITDA and a consumer goods division with $75 million EBITDA. We‚Äôve selected comparable companies and transactions for each division, and the median multiples come out to 5x EBITDA for manufacturing, 8x EBITDA for entertainment, and 4x EBITDA for consumer goods. Our calculation would be $100 * 5x + $50 * 8x + $75 * 4x = $1.2 billion for the company‚Äôs total value.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_002", "question": "In an acquisition scenario, use Section 382 and multiply the adjusted long-term rate ( by the equity purchase price of the seller to determine the maximum allowed NOL usage in each year ‚Äì and then use that to figure out the offset to taxable income.", "model_answer": "You might look at NOLs in a valuation but you rarely add them in ‚Äì if you did, they would be similar to cash and you would subtract NOLs to go from Equity Value to Enterprise Value, and vice versa.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_012", "question": "I have one company with a 40% EBITDA margin trading at 8x EBITDA, and another company with a 10% EBITDA margin trading at 16x EBITDA. What‚Äôs the problem with comparing these two valuations directly?", "model_answer": "There‚Äôs no ‚Äúrule‚Äù that says this is wrong or not allowed, but it can be misleading to compare companies with dramatically different margins. Due to basic arithmetic, the 40% margin company will usually have a lower multiple ‚Äì whether or not its actual value is lower. In this situation, we might consider screening based on margins and remove the outliers ‚Äì you would never try to ‚Äúnormalize‚Äù the EBITDA multiples based on margins.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_013", "question": "Walk me through how we might value an oil & gas company and how it‚Äôs different from a ‚Äústandard‚Äù company.", "model_answer": "You use the same methodologies, except: ‚Ä¢ You look at industry-specific multiples like P / MCFE and P / NAV in addition to the more standard ones. ‚Ä¢ You need to project the prices of commodities like oil and natural gas, and also the company‚Äôs reserves to determine its revenue and cash flows in future years. ‚Ä¢ Rather than a DCF, you use a NAV (Net Asset Value) model ‚Äì it‚Äôs similar, but everything flows from the company‚Äôs reserves rather than simple revenue growth / EBITDA margin projections. In addition to all of the above, there are also some accounting complications with energy companies and you need to think about what a ‚Äúproven‚Äù reserve is vs. what is more speculative.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_014", "question": "Walk me through how we would value a REIT (Real Estate Investment Trust) and how it differs from a ‚Äúnormal‚Äù company. Similar to energy, real estate is asset-intensive and a company‚Äôs value depends on how much cash flow specific properties generate. ‚Ä¢", "model_answer": "You look at Price / FFO (Funds From Operations) and Price / AFFO (Adjusted Funds From Operations), which add back Depreciation and subtract gains on property sales; NAV (Net Asset Value) is also important. ‚Ä¢ You value properties by dividing Net Operating Income (NOI) (Property‚Äôs Gross Income ‚Äì Operating Expenses) by the capitalization rate (based on market data). ‚Ä¢ Replacement Valuation is more common because you can actually estimate the cost of buying new land and building new properties. ‚Ä¢ A DCF is still a DCF, but it flows from specific properties and it might be useless depending on what kind of company you‚Äôre valuing. Discounted Cash Flow Questions & Answers ‚Äì Basic Beyond knowing the basics of how to construct a DCF, you also need to understand concepts such as WACC, Cost of Equity and the proper discount rates to use depending on the scenario. Interviewers also like to ask about Terminal Value ‚Äì how you calculate it, advantages and disadvantages of different methods, and signs that it‚Äôs ‚Äútoo high.‚Äù", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_001", "question": "Walk me through a DCF.", "model_answer": "‚ÄúA DCF values a company based on the Present Value of its Cash Flows and the Present Value of its Terminal Value. First, you project out a company‚Äôs financials using assumptions for revenue growth, expenses and Working Capital; then you get down to Free Cash Flow for each year, which you then sum up and discount to a Net Present Value, based on your discount rate ‚Äì usually the Weighted Average Cost of Capital. Once you have the present value of the Cash Flows, you determine the company‚Äôs Terminal Value, using either the Multiples Method or the Gordon Growth Method, and then also discount that back to its Net Present Value using WACC. Finally, you add the two together to determine the company‚Äôs Enterprise Value.‚Äù", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "val_adv_002", "question": "Walk me through how you get from Revenue to Free Cash Flow in the projections. Subtract COGS and Operating Expenses to get to Operating Income (EBIT). Then, multiply by (1 ‚Äì Tax Rate), add back Depreciation and other non-cash charges, and subtract Capital Expenditures and the change in Working Capital.", "model_answer": "Note: This gets you to Unlevered Free Cash Flow since you went off EBIT rather than EBT. You might want to confirm that this is what the interviewer is asking for.", "topic": "Valuation", "difficulty": "hard", "source": "BIWS_400"}, {"id": "dcf_basic_006", "question": "How do you calculate WACC? The formula is: Cost of Equity * (% Equity) + Cost of Debt * (% Debt) * (1 ‚Äì Tax Rate) + Cost of Preferred * (% Preferred).", "model_answer": "In all cases, the percentages refer to how much of the company‚Äôs capital structure is taken up by each component. For Cost of Equity, you can use the Capital Asset Pricing Model (CAPM ‚Äì see the next question) and for the others you usually look at comparable companies/debt issuances and the interest rates and yields issued by similar companies to get estimates.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_007", "question": "How do you calculate the Cost of Equity? Cost of Equity = Risk-Free Rate + Beta * Equity Risk Premium The risk-free rate represents how much a 10-year or 20-year US Treasury should yield;", "model_answer": "Beta is calculated based on the ‚Äúriskiness‚Äù of Comparable Companies and the Equity Risk Premium is the % by which stocks are expected to out-perform ‚Äúrisk-less‚Äù assets. Normally you pull the Equity Risk Premium from a publication called Ibbotson‚Äôs. Note: This formula does not tell the whole story. Depending on the bank and how precise you want to be, you could also add in a ‚Äúsize premium‚Äù and ‚Äúindustry premium‚Äù to account for how much a company is expected to out-perform its peers is according to its market cap or industry. Small company stocks are expected to out-perform large company stocks and certain industries are expected to out-perform others, and these premiums reflect these expectations.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_008", "question": "How do you get to Beta in the Cost of Equity calculation? You look up the Beta for each Comparable Company (usually on Bloomberg), un-lever each one, take the median of the set and then lever it based on your company‚Äôs capital structure. Then you use this Levered Beta in the Cost of Equity calculation.", "model_answer": "For your reference, the formulas for un-levering and re-levering Beta are below: Un-Levered Beta = Levered Beta / (1 + ((1 - Tax Rate) x (Total Debt/Equity))) Levered Beta = Un-Levered Beta x (1 + ((1 - Tax Rate) x (Total Debt/Equity)))", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_009", "question": "Why do you have to un-lever and re-lever Beta? Again, keep in mind our ‚Äúapples-to-apples‚Äù theme. When you look up the Betas on Bloomberg (or from whatever source you‚Äôre using) they will be levered to reflect the debt already assumed by each company.", "model_answer": "But each company‚Äôs capital structure is different and we want to look at how ‚Äúrisky‚Äù a company is regardless of what % debt or equity it has. To get that, we need to un-lever Beta each time. But at the end of the calculation, we need to re-lever it because we want the Beta used in the Cost of Equity calculation to reflect the true risk of our company, taking into account its capital structure this time.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_012", "question": "If you use Levered Free Cash Flow, what should you use as the Discount Rate?", "model_answer": "You would use the Cost of Equity rather than WACC since we‚Äôre not concerned with Debt or Preferred Stock in this case ‚Äì we‚Äôre calculating Equity Value, not Enterprise Value.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_013", "question": "How do you calculate the Terminal Value?", "model_answer": "You can either apply an exit multiple to the company‚Äôs Year 5 EBITDA, EBIT or Free Cash Flow (Multiples Method) or you can use the Gordon Growth method to estimate its value based on its growth rate into perpetuity. The formula for Terminal Value using Gordon Growth is: Terminal Value = Year 5 Free Cash Flow * (1 + Growth Rate) / (Discount Rate ‚Äì Growth Rate).", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_014", "question": "Why would you use Gordon Growth rather than the Multiples Method to calculate the Terminal Value? In banking, you almost always use the Multiples Method to calculate Terminal Value in a DCF. It‚Äôs much easier to get appropriate data for exit multiples since they are based on", "model_answer": "Comparable Companies ‚Äì picking a long-term growth rate, by contrast, is always a shot in the dark. However, you might use Gordon Growth if you have no good Comparable Companies or if you have reason to believe that multiples will change significantly in the industry several years down the road. For example, if an industry is very cyclical you might be better off using long-term growth rates rather than exit multiples.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_015", "question": "What‚Äôs an appropriate growth rate to use when calculating the Terminal Value? Normally you use the country‚Äôs long-term GDP growth rate, the rate of inflation, or something similarly conservative.", "model_answer": "For companies in mature economies, a long-term growth rate over 5% would be quite aggressive since most developed economies are growing at less than 5% per year.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_016", "question": "How do you select the appropriate exit multiple when calculating Terminal Value? Normally you look at the Comparable Companies and pick the median of the set, or something close to it.", "model_answer": "As with almost anything else in finance, you always show a range of exit multiples and what the Terminal Value looks like over that range rather than picking one specific number. So if the median EBITDA multiple of the set were 8x, you might show a range of values using multiples from 6x to 10x.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_018", "question": "What‚Äôs the flaw with basing terminal multiples on what public company comparables are trading at? The median multiples may change greatly in the next 5-10 years so it may no longer be accurate by the end of the period you‚Äôre looking at. This is why you normally look at a wide range of multiples and do a sensitivity to see how the valuation changes over that range.", "model_answer": "This method is particularly problematic with cyclical industries (e.g. semiconductors).", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_019", "question": "How do you know if your DCF is too dependent on future assumptions? The ‚Äústandard‚Äù answer: if significantly more than 50% of the company‚Äôs Enterprise Value comes from its Terminal Value, your DCF is probably too dependent on future assumptions.", "model_answer": "In reality, almost all DCFs are ‚Äútoo dependent on future assumptions‚Äù ‚Äì it‚Äôs actually quite rare to see a case where the Terminal Value is less than 50% of the Enterprise Value. But when it gets to be in the 80-90% range, you know that you may need to re-think your assumptions‚Ä¶", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_021", "question": "What about WACC ‚Äì will it be higher for a $5 billion or $500 million company?", "model_answer": "This is a bit of a trick question because it depends on whether or not the capital structure is the same for both companies. If the capital structure is the same in terms of percentages and interest rates and such, then WACC should be higher for the $500 million company for the same reasons as mentioned above. If the capital structure is not the same, then it could go either way depending on how much debt/preferred stock each one has and what the interest rates are.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_023", "question": "Cost of Equity tells us what kind of return an equity investor can expect for investing in a given company ‚Äì but what about dividends? Shouldn‚Äôt we factor dividend yield into the formula?", "model_answer": "Trick question. Dividend yields are already factored into Beta, because Beta describes returns in excess of the market as a whole ‚Äì and those returns include dividends.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_024", "question": "How can we calculate Cost of Equity WITHOUT using CAPM? There is an alternate formula: Cost of Equity = (Dividends per Share / Share Price) + Growth Rate of Dividends", "model_answer": "This is less common than the ‚Äústandard‚Äù formula but sometimes you use it for companies where dividends are more important or when you lack proper information on Beta and the other variables that go into calculating Cost of Equity with CAPM.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_025", "question": "Two companies are exactly the same, but one has debt and one does not ‚Äì which one will have the higher WACC?", "model_answer": "This is tricky ‚Äì the one without debt will have a higher WACC up to a certain point, because debt is ‚Äúless expensive‚Äù than equity. Why? ‚Ä¢ Interest on debt is tax-deductible (hence the (1 ‚Äì Tax Rate) multiplication in the WACC formula). ‚Ä¢ Debt is senior to equity in a company‚Äôs capital structure ‚Äì debt holders would be paid first in a liquidation or bankruptcy. ‚Ä¢ Intuitively, interest rates on debt are usually lower than the Cost of Equity numbers you see (usually over 10%). As a result, the Cost of Debt portion of WACC will contribute less to the total figure than the Cost of Equity portion will. However, the above is true only to a certain point. Once a company‚Äôs debt goes up high enough, the interest rate will rise dramatically to reflect the additional risk and so the Cost of Debt would start to increase ‚Äì if it gets high enough, it might become higher than Cost of Equity and additional debt would increase WACC. It‚Äôs a ‚ÄúU-shape‚Äù curve where debt decreases WACC to a point, then starts increasing it.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_027", "question": "What about a 1% change in revenue vs. a 1% change in the discount rate?", "model_answer": "In this case the discount rate is likely to have a bigger impact on the valuation, though the correct answer should start with, ‚ÄúIt could go either way, but most of the time‚Ä¶‚Äù", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_028", "question": "How do you calculate WACC for a private company?", "model_answer": "This is problematic because private companies don‚Äôt have market caps or Betas. In this case you would most likely just estimate WACC based on work done by auditors or valuation specialists, or based on what WACC for comparable public companies is.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_029", "question": "What should you do if you don‚Äôt believe management‚Äôs projections for a DCF model?", "model_answer": "You can take a few different approaches: ‚Ä¢ You can create your own projections. ‚Ä¢ You can modify management‚Äôs projections downward to make them more conservative. ‚Ä¢ You can show a sensitivity table based on different growth rates and margins and show the values assuming managements‚Äô projections and assuming a more conservative set of numbers. In reality, you‚Äôd probably do all of these if you had unrealistic projections.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_030", "question": "Why would you not use a DCF for a bank or other financial institution? Banks use debt differently than other companies and do not re-invest it in the business ‚Äì they use it to create products instead. Also, interest is a critical part of banks‚Äô business models and working capital takes up a huge part of their Balance Sheets ‚Äì so a DCF for a financial institution would not make much sense.", "model_answer": "For financial institutions, it‚Äôs more common to use a dividend discount model for valuation purposes.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_031", "question": "What types of sensitivity analyses would we look at in a DCF? Example sensitivities: ‚Ä¢", "model_answer": "Revenue Growth vs. Terminal Multiple ‚Ä¢ EBITDA Margin vs. Terminal Multiple ‚Ä¢ Terminal Multiple vs. Discount Rate ‚Ä¢ Long-Term Growth Rate vs. Discount Rate And any combination of these (except Terminal Multiple vs. Long-Term Growth Rate, which would make no sense).", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_032", "question": "A company has a high debt load and is paying off a significant portion of its principal each year. How do you account for this in a DCF? Trick question. You don‚Äôt account for this at all in a DCF, because paying off debt principal shows up in Cash Flow from Financing on the Cash Flow Statement ‚Äì but we only go down to Cash Flow from Operations and then subtract Capital Expenditures to get to Free Cash Flow.", "model_answer": "If we were looking at Levered Free Cash Flow, then our interest expense would decline in future years due to the principal being paid off ‚Äì but we still wouldn‚Äôt count the principal repayments themselves anywhere. Discounted Cash Flow Questions & Answers ‚Äì Advanced These more advanced questions cover how you use a DCF ‚Äúin real life‚Äù and some of the complexities that arise when you‚Äôre using it to value real companies. Most of these are more likely if you‚Äôre experienced and are interviewing for other investment banking or private equity positions.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_001", "question": "Explain why we would use the mid-year convention in a DCF.", "model_answer": "You use it to represent the fact that a company‚Äôs cash flow does not come 100% at the end of each year ‚Äì instead, it comes in evenly throughout each year. In a DCF without mid-year convention, we would use discount period numbers of 1 for the first year, 2 for the second year, 3 for the third year, and so on. With mid-year convention, we would instead use 0.5 for the first year, 1.5 for the second year, 2.5 for the third year, and so on.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_002", "question": "What discount period numbers would I use for the mid-year convention if I have a stub period ‚Äì e.g. Q4 of Year 1 ‚Äì in my DCF? The rule is that you divide the stub discount period by 2, and then you simply subtract 0.5 from the ‚Äúnormal‚Äù discount periods for the future years. Example for a Q4 stub:", "model_answer": "Q4 Year 1 Year 2 Year 3 Year 4 Year 5 Normal Discount Periods with Stub: 0.25 1.25 2.25 3.25 4.25 5.25 Mid-Year Discount Periods with Stub: 0.125 0.75 1.75 2.75 3.75 4.75", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_basic_003", "question": "How does the terminal value calculation change when we use the mid-year convention?", "model_answer": "When you‚Äôre discounting the terminal value back to the present value, you use different numbers for the discount period depending on whether you‚Äôre using the Multiples Method or Gordon Growth Method: ‚Ä¢ Multiples Method: You add 0.5 to the final year discount number to reflect the fact that you‚Äôre assuming the company gets sold at the end of the year.", "topic": "DCF", "difficulty": "easy", "source": "BIWS_400"}, {"id": "dcf_adv_004", "question": "If I‚Äôm working with a public company in a DCF, how do I calculate its per-share value? Once you get to Enterprise Value, ADD cash and then subtract debt, preferred stock, and minority interest (and any other debt-like items) to get to Equity Value.", "model_answer": "Then, you need to use a circular calculation that takes into account the basic shares outstanding, options, warrants, convertibles, and other dilutive securities. It‚Äôs circular because the dilution from these depends on the per-share price ‚Äì but the per-share price depends on number of shares outstanding, which depends on the per-share price. To resolve this, you need to enable iterative calculations in Excel so that it can cycle through to find an approximate per-share price.", "topic": "DCF", "difficulty": "hard", "source": "BIWS_400"}, {"id": "dcf_adv_007", "question": "We‚Äôre creating a DCF for a company that is planning to buy a factory for $100 in cash (no debt or other financing) in Year 4. Currently the present value of its Enterprise Value according to the DCF is $200. How would we change the DCF to account for the factory purchase, and what would our new Enterprise Value be?", "model_answer": "In this scenario, you would add CapEx spending of $100 in year 4 of the DCF, which would reduce Free Cash Flow for that year by $100. The Enterprise Value, in turn, would fall by the present value of that $100 decrease in Free Cash Flow. The actual math here is messy but you would calculate the present value by dividing $100 by ((1 + Discount Rate)^4) ‚Äì the ‚Äú4‚Äù just represents year 4 here. Then you would subtract this amount from the Enterprise Value. Merger Model Questions & Answers ‚Äì Basic You don‚Äôt need to understand merger models as well as an M&A banker does, but you do need to more than just the basics, especially if you‚Äôve had a finance internship or full- time job before. It‚Äôs important to know the effects of an acquisition, and understand concepts such as synergies and why Goodwill & Other Intangibles actually get created. One thing that‚Äôs not important? Walking through how all 3 statements are affected by an acquisition. In 99% of cases, you only care about the Income Statement in a merger model (despite rumors to the contrary).", "topic": "DCF", "difficulty": "hard", "source": "BIWS_400"}, {"id": "dcf_adv_001", "question": "Walk me through a basic merger model.", "model_answer": "‚ÄúA merger model is used to analyze the financial profiles of 2 companies, the purchase price and how the purchase is made, and determines whether the buyer‚Äôs EPS increases or decreases. Step 1 is making assumptions about the acquisition ‚Äì the price and whether it was cash, stock or debt or some combination of those. Next, you determine the valuations and shares outstanding of the buyer and seller and project out an Income Statement for each one. Finally, you combine the Income Statements, adding up line items such as Revenue and Operating Expenses, and adjusting for Foregone Interest on Cash and Interest Paid on Debt in the Combined Pre-Tax Income line; you apply the buyer‚Äôs Tax Rate to get the Combined Net Income, and then divide by the new share count to determine the combined EPS.‚Äù", "topic": "DCF", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_basic_004", "question": "Why would an acquisition be dilutive? An acquisition is dilutive if the additional amount of Net Income the seller contributes is not enough to offset the buyer‚Äôs foregone interest on cash, additional interest paid on debt, and the effects of issuing additional shares.", "model_answer": "Acquisition effects ‚Äì such as amortization of intangibles ‚Äì can also make an acquisition dilutive.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_005", "question": "Is there a rule of thumb for calculating whether an acquisition will be accretive or dilutive? If the deal involves just cash and debt, you can sum up the interest expense for debt and the foregone interest on cash, then compare it against the seller‚Äôs Pre-Tax Income.", "model_answer": "And if it‚Äôs an all-stock deal you can use a shortcut to assess whether it is accretive (see question #5). But if the deal involves cash, stock, and debt, there‚Äôs no quick rule-of-thumb you can use unless you‚Äôre lightning fast with mental math.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_006", "question": "A company with a higher P/E acquires one with a lower P/E ‚Äì is this accretive or dilutive? Trick question. You can‚Äôt tell unless you also know that it‚Äôs an all-stock deal. If it‚Äôs an all-cash or all-debt deal, the P/E multiples of the buyer and seller don‚Äôt matter because no stock is being issued.", "model_answer": "Sure, generally getting more earnings for less is good and is more likely to be accretive but there‚Äôs no hard-and-fast rule unless it‚Äôs an all-stock deal.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_007", "question": "What is the rule of thumb for assessing whether an M&A deal will be accretive or dilutive? In an all-stock deal, if the buyer has a higher P/E than the seller, it will be accretive; if the buyer has a lower P/E, it will be dilutive.", "model_answer": "On an intuitive level if you‚Äôre paying more for earnings than what the market values your own earnings at, you can guess that it will be dilutive; and likewise, if you‚Äôre paying less for earnings than what the market values your own earnings at, you can guess that it would be accretive.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_005", "question": "Creation of Goodwill & Other Intangibles ‚Äì These Balance Sheet items that represent a ‚Äúpremium‚Äù paid to a company‚Äôs ‚Äúfair value‚Äù also get created.", "model_answer": "Note: There‚Äôs actually more than this (see the advanced questions), but this is usually sufficient to mention in interviews.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_010", "question": "Why would a strategic acquirer typically be willing to pay more for a company than a private equity firm would?", "model_answer": "Because the strategic acquirer can realize revenue and cost synergies that the private equity firm cannot unless it combines the company with a complementary portfolio company. Those synergies boost the effective valuation for the target company.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_011", "question": "Why do Goodwill & Other Intangibles get created in an acquisition? These represent the value over the ‚Äúfair market value‚Äù of the seller that the buyer has paid. You calculate the number by subtracting the book value of a company from its equity purchase price.", "model_answer": "More specifically, Goodwill and Other Intangibles represent things like the value of customer relationships, brand names and intellectual property ‚Äì valuable, but not true financial Assets that show up on the Balance Sheet.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_012", "question": "What is the difference between Goodwill and Other Intangible Assets? Goodwill typically stays the same over many years and is not amortized. It changes only if there‚Äôs goodwill impairment (or another acquisition).", "model_answer": "Other Intangible Assets, by contrast, are amortized over several years and affect the Income Statement by hitting the Pre-Tax Income line. There‚Äôs also a difference in terms of what they each represent, but bankers rarely go into that level of detail ‚Äì accountants and valuation specialists worry about assigning each one to specific items.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_013", "question": "Is there anything else ‚Äúintangible‚Äù besides Goodwill & Other Intangibles that could also impact the combined company? Yes. You could also have a Purchased In-Process R&D Write-off and a Deferred", "model_answer": "Revenue Write-off. The first refers to any Research & Development projects that were purchased in the acquisition but which have not been completed yet. The logic is that unfinished R&D projects require significant resources to complete, and as such, the ‚Äúexpense‚Äù must be recognized as part of the acquisition. The second refers to cases where the seller has collected cash for a service but not yet recorded it as revenue, and the buyer must write-down the value of the Deferred Revenue to avoid ‚Äúdouble-counting‚Äù revenue.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_014", "question": "What are synergies, and can you provide a few examples? Synergies refer to cases where 2 + 2 = 5 (or 6, or 7‚Ä¶) in an acquisition. Basically, the buyer gets more value than out of an acquisition than what the financials would predict.", "model_answer": "There are 2 types: revenue synergies and cost (or expense) synergies. ‚Ä¢ Revenue Synergies: The combined company can cross-sell products to new customers or up-sell new products to existing customers. It might also be able to expand into new geographies as a result of the deal. ‚Ä¢ Cost Synergies: The combined company can consolidate buildings and administrative staff and can lay off redundant employees. It might also be able to shut down redundant stores or locations.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_015", "question": "How are synergies used in merger models? Revenue Synergies: Normally you add these to the Revenue figure for the combined company and then assume a certain margin on the Revenue ‚Äì this additional Revenue then flows through the rest of the combined Income Statement.", "model_answer": "Cost Synergies: Normally you reduce the combined COGS or Operating Expenses by this amount, which in turn boosts the combined Pre-Tax Income and thus Net Income, raising the EPS and making the deal more accretive.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_016", "question": "Are revenue or cost synergies more important? No one in M&A takes revenue synergies seriously because they‚Äôre so hard to predict. Cost synergies are taken a bit more seriously because it‚Äôs more straightforward to see how buildings and locations might be consolidated and how many redundant employees might be eliminated.", "model_answer": "That said, the chances of any synergies actually being realized are almost 0 so few take them seriously at all.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_017", "question": "All else being equal, which method would a company prefer to use when acquiring another company ‚Äì cash, stock, or debt? Assuming the buyer had unlimited resources, it would always prefer to use cash when buying another company. Why? ‚Ä¢", "model_answer": "Cash is ‚Äúcheaper‚Äù than debt because interest rates on cash are usually under 5% whereas debt interest rates are almost always higher than that. Thus, foregone interest on cash is almost always less than additional interest paid on debt for the same amount of cash/debt. ‚Ä¢ Cash is also less ‚Äúrisky‚Äù than debt because there‚Äôs no chance the buyer might fail to raise sufficient funds from investors. ‚Ä¢ It‚Äôs hard to compare the ‚Äúcost‚Äù directly to stock, but in general stock is the most ‚Äúexpensive‚Äù way to finance a transaction ‚Äì remember how the Cost of Equity is almost always higher than the Cost of Debt? That same principle applies here. ‚Ä¢ Cash is also less risky than stock because the buyer‚Äôs share price could change dramatically once the acquisition is announced.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_018", "question": "How much debt could a company issue in a merger or acquisition? Generally you would look at Comparable Companies/ Precedent Transactions to determine this. You would use the combined company‚Äôs LTM (Last Twelve Months)", "model_answer": "EBITDA figure, find the median Debt/EBITDA ratio of whatever companies you‚Äôre looking at, and apply that to your own EBITDA figure to get a rough idea of how much debt you could raise. You would also look at ‚ÄúDebt Comps‚Äù for companies in the same industry and see what types of debt and how many tranches they have used.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_019", "question": "How do you determine the Purchase Price for the target company in an acquisition?", "model_answer": "You use the same Valuation methodologies we already discussed. If the seller is a public company, you would pay more attention to the premium paid over the current share price to make sure it‚Äôs ‚Äúsufficient‚Äù (generally in the 15-30% range) to win shareholder approval. For private sellers, more weight is placed on the traditional methodologies.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_020", "question": "Let‚Äôs say a company overpays for another company ‚Äì what typically happens afterwards and can you give any recent examples? There would be an incredibly high amount of Goodwill & Other Intangibles created if the price is far above the fair market value of the company. Depending on how the acquisition goes, there might be a large goodwill impairment charge later on if the company decides it overpaid.", "model_answer": "A recent example is the eBay / Skype deal, in which eBay paid a huge premium and extremely high multiple for Skype. It created excess Goodwill & Other Intangibles, and eBay later ended up writing down much of the value and taking a large quarterly loss as a result.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_021", "question": "A buyer pays $100 million for the seller in an all-stock deal, but a day later the market decides it‚Äôs only worth $50 million. What happens?", "model_answer": "The buyer‚Äôs share price would fall by whatever per-share dollar amount corresponds to the $50 million loss in value. Note that it would not necessarily be cut in half. Depending on how the deal was structured, the seller would effectively only be receiving half of what it had originally negotiated. This illustrates one of the major risks of all-stock deals: sudden changes in share price could dramatically impact valuation.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_022", "question": "Why do most mergers and acquisitions fail? Like so many things, M&A is ‚Äúeasier said than done.‚Äù In practice it‚Äôs very difficult to acquire and integrate a different company, actually realize synergies and also turn the acquired company into a profitable division.", "model_answer": "Many deals are also done for the wrong reasons, such as CEO ego or pressure from shareholders. Any deal done without both parties‚Äô best interests in mind is likely to fail.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_023", "question": "What role does a merger model play in deal negotiations? The model is used as a sanity check and is used to test various assumptions. A company would never decide to do a deal based on the output of a model.", "model_answer": "It might say, ‚ÄúOk, the model tells us this deal could work and be moderately accretive ‚Äì it‚Äôs worth exploring more.‚Äù It would never say, ‚ÄúAha! This model predicts 21% accretion ‚Äì we should definitely acquire them now!‚Äù Emotions, ego and personalities play a far bigger role in M&A (and any type of negotiation) than numbers do.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_024", "question": "What types of sensitivities would you look at in a merger model? What variables would you look at?", "model_answer": "The most common variables to look at are Purchase Price, % Stock/Cash/Debt, Revenue Synergies, and Expense Synergies. Sometimes you also look at different operating sensitivities, like Revenue Growth or EBITDA Margin, but it‚Äôs more common to build these into your model as different scenarios instead. You might look at sensitivity tables showing the EPS accretion/dilution at different ranges for the Purchase Price vs. Cost Synergies, Purchase Price vs. Revenue Synergies, or Purchase Price vs. % Cash (and so on). Merger Model Questions & Answers ‚Äì Advanced These more advanced questions cover topics like the accounting treatment of M&A deals, deferred tax assets and liabilities, and different purchase methods like a stock purchase, asset purchase, and Section 338(h)(10) election. You‚Äôre unlikely to get these in entry-level interviews, but you never know‚Ä¶", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_001", "question": "What‚Äôs the difference between Purchase Accounting and Pooling Accounting in an M&A deal? In purchase accounting the seller‚Äôs shareholders‚Äô equity number is wiped out and the premium paid over that value is recorded as Goodwill on the combined balance sheet post-acquisition. In pooling accounting, you simply combine the 2 shareholders‚Äô equity numbers rather than worrying about Goodwill and the related items that get created.", "model_answer": "There are specific requirements for using pooling accounting, so in 99% of M&A deals you will use purchase accounting.", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_002", "question": "Walk me through a concrete example of how to calculate revenue synergies.", "model_answer": "‚ÄúLet‚Äôs say that Microsoft is going to acquire Yahoo. Yahoo makes money from search advertising online, and they make a certain amount of revenue per search (RPS). Let‚Äôs say this RPS is $0.10 right now. If Microsoft acquired it, we might assume that they could boost this RPS by $0.01 or $0.02 because of their superior monetization. So to calculate the additional revenue from this synergy, we would multiply this $0.01 or $0.02 by Yahoo‚Äôs total # of searches, get the total additional revenue, and then select a margin on it to determine how much flows through to the combined company‚Äôs Operating Income.‚Äù", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_basic_003", "question": "Walk me through an example of how to calculate expense synergies.", "model_answer": "‚ÄúLet‚Äôs say that Microsoft still wants to acquire Yahoo!. Microsoft has 5,000 SG&A-related employees, whereas Yahoo has around 1,000. Microsoft calculates that post-transaction, it will only need about 200 of Yahoo‚Äôs SG&A employees, and its existing employees can take over the rest of the work. To calculate the Operating Expenses the combined company would save, we would multiply these 800 employees Microsoft is going to fire post-transaction by their average salary.‚Äù", "topic": "Mergers_MA", "difficulty": "easy", "source": "BIWS_400"}, {"id": "ma_adv_004", "question": "How do you take into account NOLs in an M&A deal? You apply Section 382 to determine how much of the seller‚Äôs NOLs are usable each year. Allowable NOLs = Equity Purchase Price * Highest of Past 3 Months‚Äô Adjusted Long", "model_answer": "Term Rates So if our equity purchase price were $1 billion and the highest adjusted long-term rate were 5%, then we could use $1 billion * 5% = $50 million of NOLs each year. If the seller had $250 million in NOLs, then the combined company could use $50 million of them each year for 5 years to offset its taxable income. You can look at long-term rates right here:", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_005", "question": "Why do deferred tax liabilities (DTLs) and deferred tax assets (DTAs) get created in M&A deals? These get created when you write up assets ‚Äì both tangible and intangible ‚Äì and when you write down assets in a transaction. An asset write-up creates a deferred tax liability, and an asset write-down creates a deferred tax asset.", "model_answer": "You write down and write up assets because their book value ‚Äì what‚Äôs on the balance sheet ‚Äì often differs substantially from their ‚Äúfair market value.‚Äù An asset write-up creates a deferred tax liability because you‚Äôll have a higher depreciation expense on the new asset, which means you save on taxes in the short-term ‚Äì but eventually you‚Äôll have to pay them back, hence the liability. The opposite applies for an asset write-down and a deferred tax asset.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_006", "question": "How do DTLs and DTAs affect the Balance Sheet Adjustment in an M&A deal? You take them into account with everything else when calculating the amount of Goodwill & Other Intangibles to create on your pro-forma balance sheet. The formulas are as follows:", "model_answer": "Deferred Tax Asset = Asset Write-Down * Tax Rate Deferred Tax Liability = Asset Write-Up * Tax Rate So let‚Äôs say you were buying a company for $1 billion with half-cash and half-debt, and you had a $100 million asset write-up and a tax rate of 40%. In addition, the seller has total assets of $200 million, total liabilities of $150 million, and shareholders‚Äô equity of $50 million. Here‚Äôs what would happen to the combined company‚Äôs balance sheet (ignoring transaction/financing fees): ‚Ä¢ First, you simply add the seller‚Äôs Assets and Liabilities (but NOT Shareholders‚Äô Equity ‚Äì it is wiped out) to the buyer‚Äôs to get your ‚Äúinitial‚Äù balance sheet. Assets are up by $200 million and Liabilities are down by $150 million. ‚Ä¢ Then, Cash on the Assets side goes down by $500 million. ‚Ä¢ Debt on the Liabilities & Equity side goes up by $500 million. ‚Ä¢ You get a new Deferred Tax Liability of $40 million ($100 million * 40%) on the Liabilities & Equity side. ‚Ä¢ Assets are down by $300 million total and Liabilities & Shareholders‚Äô Equity are up by $690 million ($500 + $40 + $150). ‚Ä¢ So you need Goodwill & Intangibles of $990 million on the Assets side to make both sides balance.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_008", "question": "How do you account for DTLs in forward projections in a merger model? You create a book vs. cash tax schedule and figure out what the company owes in taxes based on the Pretax Income on its books, and then you determine what it actually pays in cash taxes based on its NOLs and newly created amortization and depreciation expenses (from any asset write-ups).", "model_answer": "Anytime the ‚Äúcash‚Äù tax expense exceeds the ‚Äúbook‚Äù tax expense you record this as an decrease to the Deferred Tax Liability on the Balance Sheet; if the ‚Äúbook‚Äù expense is higher, then you record that as an increase to the DTL.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_009", "question": "Explain the complete formula for how to calculate Goodwill in an M&A deal. Goodwill = Equity Purchase Price ‚Äì Seller Book Value + Seller‚Äôs Existing Goodwill ‚Äì Asset Write-Ups ‚Äì Seller‚Äôs Existing Deferred Tax Liability + Write-Down of Seller‚Äôs", "model_answer": "Existing Deferred Tax Asset + Newly Created Deferred Tax Liability A couple notes here: ‚Ä¢ Seller Book Value is just the Shareholders‚Äô Equity number. ‚Ä¢ You add the Seller‚Äôs Existing Goodwill because it gets written down to $0 in an M&A deal. ‚Ä¢ You subtract the Asset Write-Ups because these are additions to the Assets side of the Balance Sheet ‚Äì Goodwill is also an asset, so effectively you need less Goodwill to ‚Äúplug the hole.‚Äù ‚Ä¢ Normally you assume 100% of the Seller‚Äôs existing DTL is written down. ‚Ä¢ The seller‚Äôs existing DTA may or may not be written down completely (see the next question).", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_010", "question": "Explain why we would write down the seller‚Äôs existing Deferred Tax Asset in an M&A deal. You write it down to reflect the fact that Deferred Tax Assets include NOLs, and that you might use these NOLs post-transaction to offset the combined entity‚Äôs taxable income.", "model_answer": "In an asset or 338(h)(10) purchase you assume that the entire NOL balance goes to $0 in the transaction, and then you write down the existing Deferred Tax Asset by this NOL write-down. In a stock purchase the formula is: DTA Write-Down = Buyer Tax Rate * MAX(0, NOL Balance ‚Äì Allowed Annual NOL Usage * Expiration Period in Years) This formula is saying, ‚ÄúIf we‚Äôre going to use up all these NOLs post transaction, let‚Äôs not write anything down. Otherwise, let‚Äôs write down the portion that we cannot actually use post-transaction, i.e. whatever our existing NOL balance is minus the amount we can use per year times the number of years.‚Äù", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_011", "question": "What‚Äôs a Section 338(h)(10) election and why might a company want to use it in an M&A deal? A Section 338(h)(10) election blends the benefits of a stock purchase and an asset purchase: ‚Ä¢", "model_answer": "Legally it is a stock purchase, but accounting-wise it‚Äôs treated like an asset purchase. ‚Ä¢ The seller is still subject to double-taxation ‚Äì on its assets that have appreciated and on the proceeds from the sale. ‚Ä¢ But the buyer receives a step-up tax basis on the new assets it acquires, and it can depreciate/amortize them so it saves on taxes. Even though the seller still gets taxed twice, buyers will often pay more in a 338(h)(10) deal because of the tax-savings potential. It‚Äôs particularly helpful for: ‚Ä¢ Sellers with high NOL balances (more tax-savings for the buyer because this NOL balance will be written down completely ‚Äì and so more of the excess purchase price can be allocated to asset write-ups). ‚Ä¢ If the company has been an S-corporation for over 10 years ‚Äì in this case it doesn‚Äôt have to pay a tax on the appreciation of its assets. The requirements to use 338(h)(10) are complex and bankers don‚Äôt deal with this ‚Äì that is the role of lawyers and tax accountants.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_012", "question": "What is an exchange ratio and when would companies use it in an M&A deal? An exchange ratio is an alternate way of structuring a 100% stock M&A deal, or any M&A deal with a portion of stock involved.", "model_answer": "Let‚Äôs say you were going to buy a company for $100 million in an all-stock deal. Normally you would determine how much stock to issue by dividing the $100 million by the buyer‚Äôs stock price, and using that to get the new share count. With an exchange ratio, by contrast, you would tie the number of new shares to the buyer‚Äôs own shares ‚Äì so the seller might receive 1.5 shares of the buyer‚Äôs shares for each of its shares, rather than shares worth a specific dollar amount. Buyers might prefer to do this if they believe their stock price is going to decline post- transaction ‚Äì sellers, on the other hand, would prefer a fixed dollar amount in stock unless they believe the buyer‚Äôs share price will rise after the transaction.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_013", "question": "Walk me through the most important terms of a Purchase Agreement in an M&A deal. There are dozens, but here are the most important ones: ‚Ä¢", "model_answer": "Purchase Price: Stated as a per-share amount for public companies. ‚Ä¢ Form of Consideration: Cash, Stock, Debt‚Ä¶ ‚Ä¢ Transaction Structure: Stock, Asset, or 338(h)(10) ‚Ä¢ Treatment of Options: Assumed by the buyer? Cashed out? Ignored? ‚Ä¢ Employee Retention: Do employees have to sign non-solicit or non-compete agreements? What about management? ‚Ä¢ Reps & Warranties: What must the buyer and seller claim is true about their respective businesses? ‚Ä¢ No-Shop / Go-Shop: Can the seller ‚Äúshop‚Äù this offer around and try to get a better deal, or must it stay exclusive to this buyer?", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_014", "question": "What‚Äôs an Earnout and why would a buyer offer it to a seller in an M&A deal? An Earnout is a form of ‚Äúdeferred payment‚Äù in an M&A deal ‚Äì it‚Äôs most common with private companies and start-ups, and is highly unusual with public sellers.", "model_answer": "It is usually contingent on financial performance or other goals ‚Äì for example, the buyer might say, ‚ÄúWe‚Äôll give you an additional $10 million in 3 years if you can hit $100 million in revenue by then.‚Äù Buyers use it to incentivize sellers to continue to perform well and to discourage management teams from taking the money and running off to an island in the South Pacific once the deal is done.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_015", "question": "How would an accretion / dilution model be different for a private seller? The mechanics are the same, but the transaction structure is more likely to be an asset purchase or 338(h)(10) election; private sellers also don‚Äôt have Earnings Per Share so you would only project down to Net Income on the seller‚Äôs Income Statement.", "model_answer": "Note that accretion / dilution makes no sense if you have a private buyer because private companies do not have Earnings Per Share.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_016", "question": "How would I calculate ‚Äúbreak-even synergies‚Äù in an M&A deal and what does the number mean? To do this, you would set the EPS accretion / dilution to $0.00 and then back-solve in", "model_answer": "Excel to get the required synergies to make the deal neutral to EPS. It‚Äôs important because you want an idea of whether or not a deal ‚Äúworks‚Äù mathematically, and a high number for the break-even synergies tells you that you‚Äôre going to need a lot of cost savings or revenue synergies to make it work.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_017", "question": "Normally in an accretion / dilution model you care most about combining both companies‚Äô Income Statements. But let‚Äôs say I want to combine all 3 financial statements ‚Äì how would I do this?", "model_answer": "You combine the Income Statements like you normally would (see the previous question on this), and then you do the following:", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_018", "question": "How do you handle options, convertible debt, and other dilutive securities in a merger model? The exact treatment depends on the terms of the Purchase Agreement ‚Äì the buyer might assume them or it might allow the seller to ‚Äúcash them out‚Äù assuming that the per-share purchase price is above the exercise prices of these dilutive securities.", "model_answer": "If you assume they‚Äôre exercised, then you calculate dilution to the equity purchase price in the same way you normally would ‚Äì Treasury Stock Method for options, and assume that convertibles convert into normal shares using the conversion price.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_019", "question": "What are the main 3 transaction structures you could use to acquire another company? Stock Purchase, Asset Purchase, and 338(h)(10) Election. The basic differences:", "model_answer": "Stock Purchase: ‚Ä¢ Buyer acquires all asset and liabilities of the seller as well as off-balance sheet items. ‚Ä¢ The seller is taxed at the capital gains tax rate. ‚Ä¢ The buyer receives no step-up tax basis for the newly acquired assets, and it can‚Äôt depreciate/amortize them for tax purposes. ‚Ä¢ A Deferred Tax Liability gets created as a result of the above. ‚Ä¢ Most common for public companies and larger private companies. Asset Purchase: ‚Ä¢ Buyer acquires only certain assets and assumes only certain liabilities of the seller and gets nothing else. ‚Ä¢ Seller is taxed on the amount its assets have appreciated (what the buyer is paying for each one minus its book value) and also pays a capital gains tax on the proceeds. ‚Ä¢ The buyer receives a step-up tax basis for the newly acquired assets, and it can depreciate/amortize them for tax purposes. ‚Ä¢ No Deferred Tax Liability is created as a result of the above. ‚Ä¢ Most common for private companies, divestitures, and distressed public companies. Section 338(h)(10) Election: ‚Ä¢ Buyer acquires all asset and liabilities of the seller as well as off-balance sheet items. ‚Ä¢ Seller is taxed on the amount its assets have appreciated (what the buyer is paying for each one minus its book value) and also pays a capital gains tax on the proceeds. ‚Ä¢ The buyer receives a step-up tax basis for the newly acquired assets, and it can depreciate/amortize them for tax purposes. ‚Ä¢ No Deferred Tax Liability is created as a result of the above. ‚Ä¢ Most common for private companies, divestitures, and distressed public companies. ‚Ä¢ To compensate for the buyer‚Äôs favorable tax treatment, the buyer usually agrees to pay more than it would in an Asset Purchase.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_021", "question": "Explain what a contribution analysis is and why we might look at it in a merger model. A contribution analysis compares how much revenue, EBITDA, Pre-Tax Income, cash, and possibly other items the buyer and seller are ‚Äúcontributing‚Äù to estimate what the ownership of the combined company should be.", "model_answer": "For example, let‚Äôs say that the buyer is set to own 50% of the new company and the seller is set to own 50%. But the buyer has $100 million of revenue and the seller has $50 million of revenue ‚Äì a contribution analysis would tell us that the buyer ‚Äúshould‚Äù own 66% instead because it‚Äôs contributing 2/3 of the combined revenue. It‚Äôs most common to look at this with merger of equals scenarios, and less common when the buyer is significantly larger than the seller.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_022", "question": "How do you account for transaction costs, financing fees, and miscellaneous expenses in a merger model? In the ‚Äúold days‚Äù you used to capitalize these expenses and then amortize them; with the new accounting rules, you‚Äôre supposed to expense transaction and miscellaneous fees upfront, but capitalize the financing fees and amortize them over the life of the debt.", "model_answer": "Expensed transaction fees come out of Retained Earnings when you adjust the Balance Sheet, while capitalized financing fees appear as a new Asset on the Balance Sheet and are amortized each year according to the tenor of the debt. LBO Model Questions & Answers ‚Äì Basic The field is wide open when you get to questions on Leveraged Buyouts and LBO models. You need to know the basics, but it‚Äôs also important to understand how different variables affect the output and how and why a PE firm would structure a deal in a certain way. You‚Äôre more likely to get these types of questions if you‚Äôve already had a banking internship or if you‚Äôve worked in a group like Financial Sponsors that works extensively with PE firms. But even if neither of those applies to you, it‚Äôs still better to be over-prepared.", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "ma_adv_001", "question": "Walk me through a basic LBO model.", "model_answer": "‚ÄúIn an LBO Model, Step 1 is making assumptions about the Purchase Price, Debt/Equity ratio, Interest Rate on Debt and other variables; you might also assume something about the company‚Äôs operations, such as Revenue Growth or Margins, depending on how much information you have. Step 2 is to create a Sources & Uses section, which shows how you finance the transaction and what you use the capital for; this also tells you how much Investor Equity is required. Step 3 is to adjust the company‚Äôs Balance Sheet for the new Debt and Equity figures, and also add in Goodwill & Other Intangibles on the Assets side to make everything balance. In Step 4, you project out the company‚Äôs Income Statement, Balance Sheet and Cash Flow Statement, and determine how much debt is paid off each year, based on the available Cash Flow and the required Interest Payments. Finally, in Step 5, you make assumptions about the exit after several years, usually assuming an EBITDA Exit Multiple, and calculate the return based on how much equity is returned to the firm.‚Äù", "topic": "Mergers_MA", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_basic_004", "question": "How do you pick purchase multiples and exit multiples in an LBO model? The same way you do it anywhere else: you look at what comparable companies are trading at, and what multiples similar LBO transactions have had. As always, you also show a range of purchase and exit multiples using sensitivity tables.", "model_answer": "Sometimes you set purchase and exit multiples based on a specific IRR target that you‚Äôre trying to achieve ‚Äì but this is just for valuation purposes if you‚Äôre using an LBO model to value the company.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_005", "question": "What is an ‚Äúideal‚Äù candidate for an LBO?", "model_answer": "‚ÄúIdeal‚Äù candidates have stable and predictable cash flows, low-risk businesses, not much need for ongoing investments such as Capital Expenditures, as well as an opportunity for expense reductions to boost their margins. A strong management team also helps, as does a base of assets to use as collateral for debt. The most important part is stable cash flow.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_006", "question": "How do you use an LBO model to value a company, and why do we sometimes say that it sets the ‚Äúfloor valuation‚Äù for the company?", "model_answer": "You use it to value a company by setting a targeted IRR (for example, 25%) and then back-solving in Excel to determine what purchase price the PE firm could pay to achieve that IRR. This is sometimes called a ‚Äúfloor valuation‚Äù because PE firms almost always pay less for a company than strategic acquirers would.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_007", "question": "Give an example of a ‚Äúreal-life‚Äù LBO.", "model_answer": "The most common example is taking out a mortgage when you buy a house. Here‚Äôs how the analogy works: ‚Ä¢ Down Payment: Investor Equity in an LBO ‚Ä¢ Mortgage: Debt in an LBO ‚Ä¢ Mortgage Interest Payments: Debt Interest in an LBO ‚Ä¢ Mortgage Repayments: Debt Principal Repayments in an LBO ‚Ä¢ Selling the House: Selling the Company / Taking It Public in an LBO", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_008", "question": "Can you explain how the Balance Sheet is adjusted in an LBO model?", "model_answer": "First, the Liabilities & Equities side is adjusted ‚Äì the new debt is added on, and the Shareholders‚Äô Equity is ‚Äúwiped out‚Äù and replaced by however much equity the private equity firm is contributing. On the Assets side, Cash is adjusted for any cash used to finance the transaction, and then Goodwill & Other Intangibles are used as a ‚Äúplug‚Äù to make the Balance Sheet balance. Depending on the transaction, there could be other effects as well ‚Äì such as capitalized financing fees added to the Assets side.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_011", "question": "Do you need to project all 3 statements in an LBO model? Are there any", "model_answer": "‚Äúshortcuts?‚Äù Yes, there are shortcuts and you don‚Äôt necessarily need to project all 3 statements. For example, you do not need to create a full Balance Sheet ‚Äì bankers sometimes skip this if they are in a rush. You do need some form of Income Statement, something to track how the Debt balances change and some type of Cash Flow Statement to show how much cash is available to repay debt. But a full-blown Balance Sheet is not strictly required, because you can just make assumptions on the Net Change in Working Capital rather than looking at each item individually.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_013", "question": "Let‚Äôs say we‚Äôre analyzing how much debt a company can take on, and what the terms of the debt should be. What are reasonable leverage and coverage ratios?", "model_answer": "This is completely dependent on the company, the industry, and the leverage and coverage ratios for comparable LBO transactions. To figure out the numbers, you would look at ‚Äúdebt comps‚Äù showing the types, tranches, and terms of debt that similarly sized companies in the industry have used recently. There are some general rules: for example, you would never lever a company at 50x EBITDA, and even during the bubble leverage rarely exceeded 5-10x EBITDA.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_014", "question": "What is the difference between bank debt and high-yield debt?", "model_answer": "This is a simplification, but broadly speaking there are 2 ‚Äútypes‚Äù of debt: ‚Äúbank debt‚Äù and ‚Äúhigh-yield debt.‚Äù There are many differences, but here are a few of the most important ones: ‚Ä¢ High-yield debt tends to have higher interest rates than bank debt (hence the name ‚Äúhigh-yield‚Äù). ‚Ä¢ High-yield debt interest rates are usually fixed, whereas bank debt interest rates are ‚Äúfloating‚Äù ‚Äì they change based on LIBOR or the Fed interest rate. ‚Ä¢ High-yield debt has incurrence covenants while bank debt has maintenance covenants. The main difference is that incurrence covenants prevent you from doing something (such as selling an asset, buying a factory, etc.) while maintenance covenants require you to maintain a minimum financial performance (for example, the Debt/EBITDA ratio must be below 5x at all times). ‚Ä¢ Bank debt is usually amortized ‚Äì the principal must be paid off over time ‚Äì whereas with high-yield debt, the entire principal is due at the end (bullet maturity). Usually in a sizable Leveraged Buyout, the PE firm uses both types of debt. Again, there are many different types of debt ‚Äì this is a simplification, but it‚Äôs enough for entry-level interviews.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_017", "question": "Why would a private equity firm buy a company in a ‚Äúrisky‚Äù industry, such as technology?", "model_answer": "Although technology is more ‚Äúrisky‚Äù than other markets, remember that there are mature, cash flow-stable companies in almost every industry. There are some PE firms that specialize in very specific goals, such as: ‚Ä¢ Industry consolidation ‚Äì buying competitors in a similar market and combining them to increase efficiency and win more customers. ‚Ä¢ Turnarounds ‚Äì taking struggling companies and making them function properly again. ‚Ä¢ Divestitures ‚Äì selling off divisions of a company or taking a division and turning it into a strong stand-alone entity. So even if a company isn‚Äôt doing well or seems risky, the firm might buy it if it falls into one of these categories.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_019", "question": "What is meant by the ‚Äútax shield‚Äù in an LBO?", "model_answer": "This means that the interest a firm pays on debt is tax-deductible ‚Äì so they save money on taxes and therefore increase their cash flow as a result of having debt from the LBO. Note, however, that their cash flow is still lower than it would be without the debt ‚Äì saving on taxes helps, but the added interest expenses still reduces Net Income over what it would be for a debt-free company.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_020", "question": "What is a dividend recapitalization (‚Äúdividend recap‚Äù)? In a dividend recap, the company takes on new debt solely to pay a special dividend out to the PE firm that bought it.", "model_answer": "It would be like if you made your friend take out a personal loan just so he/she could pay you a lump sum of cash with the loan proceeds. As you might guess, dividend recaps have developed a bad reputation, though they‚Äôre still commonly used.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_021", "question": "Why would a PE firm choose to do a dividend recap of one of its portfolio companies? Primarily to boost returns. Remember, all else being equal, more leverage means a higher return to the firm.", "model_answer": "With a dividend recap, the PE firm is ‚Äúrecovering‚Äù some of its equity investment in the company ‚Äì and as we saw earlier, the lower the equity investment, the better, since it‚Äôs easier to earn a higher return on a smaller amount of capital.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_022", "question": "How would a dividend recap impact the 3 financial statements in an LBO? No changes to the Income Statement. On the Balance Sheet, Debt would go up and Shareholders‚Äô Equity would go down and they would cancel each other out so that everything remained in balance.", "model_answer": "On the Cash Flow Statement, there would be no changes to Cash Flow from Operations or Investing, but under Financing the additional Debt raised would cancel out the Cash paid out to the investors, so Net Change in Cash would not change. LBO Model Questions & Answers ‚Äì Advanced Some of these questions are very obscure. This section is most applicable if you‚Äôre interviewing for PE jobs, or if you have a lot of LBO experience on your resume and you really need to know the in‚Äôs and out‚Äôs of LBO models. Note that there is a lot of overlap between Merger Model and LBO Model questions, because many of the elements in a Merger Model like Purchase Price Allocation, Deferred Tax Assets / Liabilities, and the creation of Goodwill work the same way in both models. Rather than repeating everything here, I would just point you to the Advanced Merger Model section if you want to review those concepts.", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_basic_001", "question": "Tell me about all the different kinds of debt you could use in an LBO and the differences between everything. Here‚Äôs a handy chart to explain all of this. Note that this chart does not cover every single feature or every single type of debt in the universe ‚Äì just the most important ones, and what you‚Äôre likely to be asked about in finance interviews:", "model_answer": "Debt Type Revolver Term Loan A Term Loan B Senior Subordinated Mezzanine Notes Notes Interest Rate: Lowest Low Higher Higher Higher Highest Floating / Floating Fixed Fixed? Cash Pay? Yes Cash / PIK Tenor: 3-5 years 4-6 years 4-8 years 7-10 years 8-10 years 8-12 years Amortization: None Straight Line Minimal Bullet Prepayment? Yes No Investors: Conservative Banks HFs, Merchant Banks, Mezzanine Funds Seniority Senior Secured Senior Senior Equity Unsecured Subordinated Secured? Yes Sometimes No Call No Sometimes Yes Protection? Covenants: Maintenance Incurrence", "topic": "LBO", "difficulty": "easy", "source": "BIWS_400"}, {"id": "lbo_adv_002", "question": "How would an asset write-up or write-down affect an LBO model? / Walk me through how you adjust the Balance Sheet in an LBO model. All of this is very similar to what you would see in a merger model ‚Äì you calculate", "model_answer": "Goodwill, Other Intangibles, and the rest of the write-ups in the same way, and then the Balance Sheet adjustments (e.g. subtracting cash, adding in capitalized financing fees, writing up assets, wiping out goodwill, adjusting the deferred tax assets / liabilities, adding in new debt, etc.) are almost the same. The key differences: ‚Ä¢ In an LBO model you assume that the existing Shareholders‚Äô Equity is wiped out and replaced by the equity the private equity firm contributes to buy the company; you may also add in Preferred Stock, Management Rollover, or Rollover from Option Holders to this number as well depending on what you‚Äôre assuming for transaction financing. ‚Ä¢ In an LBO model you‚Äôll usually be adding a lot more tranches of debt vs. what you would see in a merger model. ‚Ä¢ In an LBO model you‚Äôre not combining two companies‚Äô Balance Sheets.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_003", "question": "Normally we care about the IRR for the equity investors in an LBO ‚Äì the PE firm that buys the company ‚Äì but how do we calculate the IRR for the debt investors? For the debt investors, you need to calculate the interest and principal payments they receive from the company each year.", "model_answer": "Then you simply use the IRR function in Excel and start with the negative amount of the original debt for ‚ÄúYear 0,‚Äù assume that the interest and principal payments each year are your ‚Äúcash flows‚Äù and then assume that the remaining debt balance in the final year is your ‚Äúexit value.‚Äù Most of the time, returns for debt investors will be lower than returns for the equity investors ‚Äì but if the deal goes poorly or the PE firm can‚Äôt sell the company for a good price, the reverse could easily be true.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_004", "question": "Why might a private equity firm allot some of a company‚Äôs new equity in an LBO to a management option pool, and how would this affect the model?", "model_answer": "This is done for the same reason you have an Earnout in an M&A deal: the PE firm wants to incentivize the management team and keep everyone on-board until they exit the investment. The difference is that there‚Äôs no technical limit on how much management might receive from such an option pool: if they hit it out of the park, maybe they‚Äôll all become millionaires. In your LBO model, you would need to calculate a per-share purchase price when the PE firm exits the investment, and then calculate how much of the proceeds go to the management team based on the Treasury Stock Method. An option pool by itself would reduce the PE firm‚Äôs return, but this is offset by the fact that the company should perform better with this incentive in place.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_005", "question": "Why you would you use PIK (Payment In Kind) debt rather than other types of debt, and how does it affect the debt schedules and the other statements? Unlike ‚Äúnormal‚Äù debt, a PIK loan does not require the borrower to make cash interest payments ‚Äì instead, the interest just accrues to the loan principal, which keeps going up over time. A PIK ‚Äútoggle‚Äù allows the company to choose whether to pay the interest in cash or have it accrue to the principal (these have disappeared since the credit crunch).", "model_answer": "PIK is more risky than other forms of debt and carries with it a higher interest rate than traditional bank debt or high yield debt. Adding it to the debt schedules is similar to adding high-yield debt with a bullet maturity ‚Äì except instead of assuming cash interest payments, you assume that the interest accrues to the principal instead. You should then include this interest on the Income Statement, but you need to add back any PIK interest on the Cash Flow Statement because it‚Äôs a non-cash expense.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_006", "question": "What are some examples of incurrence covenants? Maintenance covenants? Incurrence Covenants: ‚Ä¢", "model_answer": "Company cannot take on more than $2 billion of total debt. ‚Ä¢ Proceeds from any asset sales must be earmarked to repay debt. ‚Ä¢ Company cannot make acquisitions of over $200 million in size. ‚Ä¢ Company cannot spend more than $100 million on CapEx each year. Maintenance Covenants: ‚Ä¢ Total Debt / EBITDA cannot exceed 3.0 x ‚Ä¢ Senior Debt / EBITDA cannot exceed 2.0 x ‚Ä¢ (Total Cash Payable Debt + Capitalized Leases) / EBITDAR cannot exceed 4.0 x ‚Ä¢ EBITDA / Interest Expense cannot fall below 5.0 x ‚Ä¢ EBITDA / Cash Interest Expense cannot fall below 3.0 x ‚Ä¢ (EBITDA ‚Äì CapEx) / Interest Expense cannot fall below 2.0 x", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_007", "question": "Just like a normal M&A deal, you can structure an LBO either as a stock purchase or as an asset purchase. Can you also use Section 338(h)(10) election? In most cases, no ‚Äì because one of the requirements for Section 338(h)(10) is that the buyer must be a C corporation. Most private equity firms are organized as LLCs or", "model_answer": "Limited Partnerships, and when they acquire companies in an LBO, they create an LLC shell company that ‚Äúacquires‚Äù the company on paper.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_008", "question": "Walk me through how you calculate optional repayments on debt in an LBO model.", "model_answer": "First, note that you only look at optional repayments for Revolvers and Term Loans ‚Äì high-yield debt doesn‚Äôt have a prepayment option, so effectively it‚Äôs always $0. First, you check how much cash flow you have available based on your Beginning Cash Balance, Minimum Cash Balance, Cash Flow Available for Debt Repayment from the Cash Flow Statement, and how much you use to make Mandatory Debt Repayments. Then, if you‚Äôve used your Revolver at all you pay off the maximum amount that you can with the cash flow you have available. Next, for Term Loan A you assume that you pay off the maximum you can, taking into account that you‚Äôve lost any cash flow you used to pay down the Revolver. You also need to take into account that you might have paid off some of Term Loan A‚Äôs principal as part of the Mandatory Repayments. Finally, you do the same thing for Term Loan B, subtracting from the ‚Äúcash flow available for debt repayment‚Äù what you‚Äôve already used up on the Revolver and Term Loan A. And just like Term Loan A, you need to take into account any Mandatory Repayments you‚Äôve made so that you don‚Äôt pay off more than the entire Term Loan B balance. The formulas here get very messy and depend on how your model is set up, but this is the basic idea for optional debt repayments.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_009", "question": "Explain how a Revolver is used in an LBO model.", "model_answer": "You use a Revolver when the cash required for your Mandatory Debt Repayments exceeds the cash flow you have available to repay them. The formula is: Revolver Borrowing = MAX(0, Total Mandatory Debt Repayment ‚Äì Cash Flow Available to Repay Debt). The Revolver starts off ‚Äúundrawn,‚Äù meaning that you don‚Äôt actually borrow money and don‚Äôt accrue a balance unless you need it ‚Äì similar to how credit cards work. You add any required Revolver Borrowing to your running total for cash flow available for debt repayment before you calculate Mandatory and Optional Debt Repayments. Within the debt repayments themselves, you assume that any Revolver Borrowing from previous years is paid off first with excess cash flow before you pay off any Term Loans.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_010", "question": "How would you adjust the Income Statement in an LBO model?", "model_answer": "The most common adjustments: ‚Ä¢ Cost Savings ‚Äì Often you assume the PE firm cuts costs by laying off employees, which could affect COGS, Operating Expenses, or both. ‚Ä¢ New Depreciation Expense ‚Äì This comes from any PP&E write-ups in the transaction. ‚Ä¢ New Amortization Expense ‚Äì This includes both the amortization from written- up intangibles and from capitalized financing fees. ‚Ä¢ Interest Expense on LBO Debt ‚Äì You need to include both cash and PIK interest here. ‚Ä¢ Sponsor Management Fees ‚Äì Sometimes PE firms charge a ‚Äúmanagement fee‚Äù to a company to account for the time and effort they spend managing it. ‚Ä¢ Common Stock Dividend ‚Äì Although private companies don‚Äôt pay dividends to shareholders, they could pay out a dividend recap to the PE investors. ‚Ä¢ Preferred Stock Dividend ‚Äì If Preferred Stock is used as a form of financing in the transaction, you need to account for Preferred Stock Dividends on the Income Statement. Cost Savings and new Depreciation / Amortization hit the Operating Income line; Interest Expense and Sponsor Management Fees hit Pre-Tax Income; and you need to subtract the dividend items from your Net Income number.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_011", "question": "In an LBO model, is it possible for debt investors to get a higher return than the PE firm? What does it tell us about the company we‚Äôre modeling? Yes, and it happens more commonly than you‚Äôd think. Remember, high-yield debt investors often get interest rates of 10-15% or more ‚Äì which effectively guarantees an", "model_answer": "IRR in that range for them. So no matter what happens to the company or the market, that debt gets repaid and the debt investors get the interest payments. But let‚Äôs say that the median EBITDA multiples contract, or that the company fails to grow or actually shrinks ‚Äì in these cases the PE firm could easily get an IRR below what the debt investors get.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_012", "question": "Most of the time, increased leverage means an increased IRR. Explain how increasing the leverage could reduce the IRR. This scenario is admittedly rare, but it could happen if the increase leverage increases interest payments or debt repayments to very high levels, preventing the company from using its cash flow for other purposes.", "model_answer": "Sometimes in LBO models, increasing the leverage increases the IRR up to a certain point ‚Äì but then after that the IRR starts falling as the interest payments or principal repayments become ‚Äútoo big.‚Äù For this scenario to happen you would need a ‚Äúperfect storm‚Äù of:", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_003", "question": "Relatively high purchase premium or purchase multiple to make it more difficult to get a high IRR in the first place. Brain Teaser Questions & Answers", "model_answer": "Brain teasers are silly to ask in interviews, but that doesn‚Äôt mean you won‚Äôt get them. The questions below just scrape the surface of what‚Äôs out there, but they are among the more common types seen in interviews. The key with brain teasers is to keep your cool and attempt to reason your way through any question, even if you haven‚Äôt a clue as to the answer. This is one case where saying nothing or stating you don‚Äôt know hurts you.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_001", "question": "A car drives 60 miles at an average speed of 30 miles per hour. How fast should the driver drive to travel the same 60 miles in the same time period, but at an average of 60 miles per hour?", "model_answer": "This is not possible. To travel 60 miles at an average speed of 30 miles per hour, 2 hours are required; to travel at an average of 60 miles per hour in those same 2 hours, you‚Äôd need to go 120 miles rather than 60 miles. The most common mistake is to respond with 90 miles per hour or 120 miles per hour ‚Äì if you get a question like this in an interview, be sure to ask clarifying questions that could point you in the right direction. In this case, for example, we might have reframed the question and asked if it was really, ‚ÄúHow do you travel 60 miles in 2 hours at an average speed of 60 miles per hour?‚Äù If he said yes, we‚Äôd instantly know it was not possible.", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}, {"id": "lbo_adv_002", "question": "What is the angle formed by the hands of the clock when it is 1:45? 142.5 degrees. If we just think of the clock hour hand at 1 and the minute hand at the 45 position (near 9 o‚Äôclock), that is 120 degrees since they are 4 ‚Äúnumbers‚Äù apart, and each number on the clock represents 30 degrees (360/12).", "model_answer": "However, recall that the hour hand has already moved by the time the minute hand has reached the 45 position ‚Äì it is now closer to 2 o‚Äôclock. 45 represent ¬æ of an hour, so the hour hand will have moved ¬æ of 30 degrees, or 22.5 degrees. If we add them together, we see that 120 + 22.5 = 142.5", "topic": "LBO", "difficulty": "hard", "source": "BIWS_400"}];

  // Session state
  let currentTopic = 'All';
  let filteredQuestions = [];
  let currentIndex = 0;
  let sessionResults = {}; // id -> 'mastered' | 'partial' | 'missed'
  let pendingNextQuestion = null; // AI-suggested next question text

  const TOPIC_LABELS = {
    'All': 'All Topics',
    'Accounting': 'Accounting',
    'Enterprise_Value': 'Enterprise Value',
    'Valuation': 'Valuation',
    'DCF': 'DCF',
    'Mergers_MA': 'M&A',
    'LBO': 'LBO'
  };

  function getFilteredQuestions(topic) {
    if (topic === 'All') return [...QUESTION_BANK];
    return QUESTION_BANK.filter(q => q.topic === topic);
  }

  function selectTopic(topic) {
    currentTopic = topic;
    filteredQuestions = getFilteredQuestions(topic);
    currentIndex = 0;
    pendingNextQuestion = null;

    // Update nav active state
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    const navEl = document.getElementById('nav-' + topic);
    if (navEl) navEl.classList.add('active');

    // Update breadcrumb + pill
    const label = TOPIC_LABELS[topic] || topic;
    document.getElementById('breadcrumbTopic').textContent = label;
    document.getElementById('topbarTopicPill').textContent = label;

    // Reset session results for new topic
    sessionResults = {};

    // Load first question
    loadQuestionAt(0);
    updateProgressUI();
  }

  function loadQuestionAt(index) {
    if (!filteredQuestions.length) return;
    currentIndex = Math.max(0, Math.min(index, filteredQuestions.length - 1));
    const q = filteredQuestions[currentIndex];
    displayQuestion(q, currentIndex);
    saveStateToServer();
  }

  function loadNextQuestion() {
    // If AI suggested a specific follow-up question, find closest match in bank
    if (pendingNextQuestion) {
      const suggested = pendingNextQuestion.toLowerCase();
      // Try to find it in the bank
      const match = filteredQuestions.find(q => 
        q.question.toLowerCase().includes(suggested.slice(0, 40)) ||
        suggested.includes(q.question.toLowerCase().slice(0, 40))
      );
      if (match) {
        const idx = filteredQuestions.indexOf(match);
        pendingNextQuestion = null;
        loadQuestionAt(idx);
        return;
      }
    }

    // Otherwise advance to next unmastered question
    const start = currentIndex + 1;
    for (let i = 0; i < filteredQuestions.length; i++) {
      const idx = (start + i) % filteredQuestions.length;
      const q = filteredQuestions[idx];
      if (sessionResults[q.id] !== 'mastered') {
        pendingNextQuestion = null;
        loadQuestionAt(idx);
        return;
      }
    }

    // All mastered ‚Äî loop back
    loadQuestionAt((currentIndex + 1) % filteredQuestions.length);
  }

  function displayQuestion(q, index) {
    document.getElementById('questionText').textContent = q.question;

    // Update meta tags
    const topicLabel = TOPIC_LABELS[q.topic] || q.topic;
    document.getElementById('qTagTopic').textContent = topicLabel;
    document.getElementById('qTagDifficulty').textContent = q.difficulty === 'hard' ? 'Advanced' : 'Basic';
    document.getElementById('qNumber').textContent = 'Q' + (index + 1) + ' of ' + filteredQuestions.length;

    // Reset hint
    const hint = document.getElementById('questionHint');
    if (hint) hint.textContent = '';

    updateProgressUI();
  }

  function updateProgressUI() {
    const total = filteredQuestions.length;
    const mastered = Object.values(sessionResults).filter(v => v === 'mastered').length;
    const partial = Object.values(sessionResults).filter(v => v === 'partial').length;
    const missed = Object.values(sessionResults).filter(v => v === 'missed').length;
    const answered = mastered + partial + missed;

    document.getElementById('progressLabel').textContent = answered + ' of ' + total + ' questions';
    const pct = total > 0 ? (answered / total) * 100 : 0;
    document.getElementById('progressFill').style.width = pct + '%';

    document.getElementById('statMastered').textContent = mastered;
    document.getElementById('statPartial').textContent = partial;
    document.getElementById('statMissed').textContent = missed;

    // Update nav badges
    const topics = ['All', 'Accounting', 'Enterprise_Value', 'Valuation', 'DCF', 'Mergers_MA', 'LBO'];
    topics.forEach(t => {
      const el = document.getElementById('badge-' + t);
      if (!el) return;
      const tqs = t === 'All' ? QUESTION_BANK : QUESTION_BANK.filter(q => q.topic === t);
      const tMastered = tqs.filter(q => sessionResults[q.id] === 'mastered').length;
      el.textContent = tMastered + '/' + tqs.length;
    });
  }

  function recordQuestionResult(score) {
    const q = filteredQuestions[currentIndex];
    if (!q) return;
    let status;
    if (score >= 95) status = 'mastered';
    else if (score >= 75) status = 'partial';
    else status = 'missed';
    sessionResults[q.id] = status;
    updateProgressUI();
    // Persist to server
    saveResultToServer(q.id, q.topic, status, score);
  }

  // ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  (function init() {
    const token = localStorage.getItem('apex_token');
    if (token) {
      // loadProgressFromServer will handle topic/position restoration
      loadProgressFromServer();
    } else {
      // Not logged in ‚Äî load default view, modal is already showing
      const params = new URLSearchParams(window.location.search);
      const topicParam = params.get('topic');
      const validTopics = ['All', 'Accounting', 'Enterprise_Value', 'Valuation', 'DCF', 'Mergers_MA', 'LBO'];
      const startTopic = validTopics.includes(topicParam) ? topicParam : 'All';
      selectTopic(startTopic);
    }
  })();

  // ‚îÄ‚îÄ‚îÄ AUTH & PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  // ‚îÄ‚îÄ Auth Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function switchAuthTab(tab) {
    document.getElementById('authLoginForm').style.display = tab === 'login' ? '' : 'none';
    document.getElementById('authRegisterForm').style.display = tab === 'register' ? '' : 'none';
    document.getElementById('tabLogin').classList.toggle('active', tab === 'login');
    document.getElementById('tabRegister').classList.toggle('active', tab === 'register');
    document.getElementById('authError').textContent = '';
  }

  async function doLogin() {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const btn = document.getElementById('loginBtn');
    if (!email || !password) return showAuthError('Please fill in all fields');
    btn.disabled = true; btn.textContent = 'Signing in‚Ä¶';
    showAuthError('');
    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      let data;
      const text = await res.text();
      try { data = JSON.parse(text); } catch(e) { throw new Error('Server error: ' + text.slice(0, 100)); }
      if (!res.ok) throw new Error(data.error || 'Login failed ('+res.status+')');
      onAuthSuccess(data.token, data.name);
    } catch(e) {
      showAuthError(e.message);
    } finally {
      btn.disabled = false; btn.textContent = 'Sign In';
    }
  }

  async function doRegister() {
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;
    const btn = document.getElementById('registerBtn');
    if (!email || !password) return showAuthError('Please fill in all fields');
    btn.disabled = true; btn.textContent = 'Creating account‚Ä¶';
    showAuthError('');
    try {
      const res = await fetch('/api/auth/register', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password, name })
      });
      let data;
      const text = await res.text();
      try { data = JSON.parse(text); } catch(e) { throw new Error('Server error: ' + text.slice(0, 100)); }
      if (!res.ok) throw new Error(data.error || 'Registration failed ('+res.status+')');
      onAuthSuccess(data.token, data.name);
    } catch(e) {
      showAuthError(e.message);
    } finally {
      btn.disabled = false; btn.textContent = 'Create Account';
    }
  }

  function showAuthError(msg) {
    document.getElementById('authError').textContent = msg;
  }

  function doLogout() {
    localStorage.removeItem('apex_token');
    localStorage.removeItem('apex_user');
    authToken = null; currentUser = null;
    document.getElementById('userBadge').style.display = 'none';
    document.getElementById('authOverlay').classList.remove('hidden');
    // Reset all progress locally
    sessionResults = {};
    updateProgressUI();
  }

  async function onAuthSuccess(token, name) {
    authToken = token;
    currentUser = name;
    localStorage.setItem('apex_token', token);
    localStorage.setItem('apex_user', name);
    document.getElementById('authOverlay').classList.add('hidden');
    document.getElementById('userBadge').style.display = 'flex';
    document.getElementById('userDisplayName').textContent = name;
    await loadProgressFromServer();
  }

  // ‚îÄ‚îÄ Progress: Load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function loadProgressFromServer() {
    if (!authToken) return;
    try {
      const res = await fetch('/api/progress/load', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      });
      if (!res.ok) return;
      const data = await res.json();

      // Restore question results into sessionResults
      if (data.results) {
        data.results.forEach(r => {
          sessionResults[r.question_id] = r.status;
        });
      }

      // Restore last topic + position (URL param overrides saved state)
      const params = new URLSearchParams(window.location.search);
      const topicParam = params.get('topic');
      const validTopics = ['All', 'Accounting', 'Enterprise_Value', 'Valuation', 'DCF', 'Mergers_MA', 'LBO'];
      if (topicParam && validTopics.includes(topicParam)) {
        selectTopic(topicParam);
      } else if (data.state) {
        const savedTopic = validTopics.includes(data.state.last_topic) ? data.state.last_topic : 'All';
        selectTopic(savedTopic);
        loadQuestionAt(data.state.last_question_index || 0);
      }

      updateProgressUI();
    } catch(e) {
      console.log('Progress load error:', e.message);
    }
  }

  // ‚îÄ‚îÄ Progress: Save result ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function saveResultToServer(questionId, topic, status, score) {
    if (!authToken) return;
    try {
      await fetch('/api/progress/save-result', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + authToken },
        body: JSON.stringify({ questionId, topic, status, score })
      });
      showSaveIndicator();
    } catch(e) {
      console.log('Save result error:', e.message);
    }
  }

  // ‚îÄ‚îÄ Progress: Save state (debounced) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function saveStateToServer() {
    if (!authToken) return;
    clearTimeout(saveStateTimer);
    saveStateTimer = setTimeout(async () => {
      try {
        const q = filteredQuestions[currentIndex];
        await fetch('/api/progress/save-state', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + authToken },
          body: JSON.stringify({ topic: currentTopic, questionIndex: currentIndex })
        });
      } catch(e) {}
    }, 1500);
  }

  function showSaveIndicator() {
    const el = document.getElementById('saveIndicator');
    el.classList.add('visible');
    setTimeout(() => el.classList.remove('visible'), 2000);
  }

  // ‚îÄ‚îÄ Boot: check for saved token ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  (function checkAuth() {
    const token = localStorage.getItem('apex_token');
    const name = localStorage.getItem('apex_user');
    if (token && name) {
      authToken = token;
      currentUser = name;
      document.getElementById('authOverlay').classList.add('hidden');
      document.getElementById('userBadge').style.display = 'flex';
      document.getElementById('userDisplayName').textContent = name;
    } else {
      // Ping server to confirm auth endpoints are live
      fetch('/api/ping').then(r => r.json()).then(d => {
        document.getElementById('authServerStatus').textContent = '‚óè Server connected';
        document.getElementById('authServerStatus').style.color = '#4ade80';
      }).catch(() => {
        document.getElementById('authServerStatus').textContent = '‚óè Server unreachable ‚Äî deploy may still be starting';
        document.getElementById('authServerStatus').style.color = 'var(--accent-red)';
      });
    }
  })();

</script>

</body>
</html>
