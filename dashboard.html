<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard â€” Apex</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #F7F6F3;
    --surface: #FFFFFF;
    --border: #E8E5DF;
    --border-strong: #D4CFC6;
    --text-primary: #1A1814;
    --text-secondary: #6B6560;
    --text-tertiary: #9E9890;
    --accent-green: #16A34A;
    --accent-amber: #D97706;
    --accent-red: #DC2626;
    --accent-blue: #2563EB;
    --sidebar-width: 240px;
    --radius: 10px;
    --radius-sm: 6px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
  }

  /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sidebar {
    width: var(--sidebar-width);
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    z-index: 10;
    overflow-y: auto;
  }

  .sidebar-logo {
    padding: 20px 20px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
  }

  .logo-mark {
    width: 32px; height: 32px;
    background: var(--text-primary);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
  }

  .logo-mark svg { width: 16px; height: 16px; }

  .logo-name {
    font-family: 'DM Serif Display', serif;
    font-size: 17px;
    letter-spacing: -0.3px;
  }

  .sidebar-nav {
    padding: 12px 10px;
    flex: 1;
  }

  .nav-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    padding: 8px 10px 6px;
  }

  .nav-item {
    display: flex; align-items: center; gap: 9px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 13.5px;
    color: var(--text-secondary);
    transition: all 0.15s;
    text-decoration: none;
    margin-bottom: 1px;
  }

  .nav-item:hover { background: var(--bg); color: var(--text-primary); }
  .nav-item.active { background: var(--bg); color: var(--text-primary); font-weight: 500; }
  .nav-item svg { width: 15px; height: 15px; flex-shrink: 0; opacity: 0.7; }
  .nav-item.active svg { opacity: 1; }

  .nav-badge {
    margin-left: auto;
    font-size: 11px;
    background: var(--text-primary);
    color: white;
    padding: 1px 7px;
    border-radius: 20px;
  }

  .nav-badge.subtle {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text-tertiary);
  }

  .sidebar-bottom {
    padding: 12px 10px;
    border-top: 1px solid var(--border);
    flex-shrink: 0;
  }

  .user-card {
    display: flex; align-items: center; gap: 9px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    cursor: pointer;
  }

  .user-avatar {
    width: 28px; height: 28px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 600; color: white;
    flex-shrink: 0;
  }

  .user-name { font-size: 13px; font-weight: 500; }
  .user-plan { font-size: 11px; color: var(--text-tertiary); }

  /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .main {
    margin-left: var(--sidebar-width);
    flex: 1;
    min-height: 100vh;
    padding: 40px 44px;
    max-width: calc(100vw - var(--sidebar-width));
  }

  /* â”€â”€ GREETING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .greeting-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 32px;
    animation: fadeUp 0.4s ease both;
  }

  .greeting-text h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 32px;
    letter-spacing: -0.5px;
    line-height: 1.2;
    margin-bottom: 6px;
  }

  .greeting-text p {
    font-size: 14px;
    color: var(--text-secondary);
  }

  .greeting-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }

  .streak-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 7px 13px;
    border-radius: 99px;
    font-size: 13px;
    font-weight: 500;
  }

  .streak-badge .fire { font-size: 15px; }

  .today-goal {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  /* â”€â”€ SESSION SUMMARY BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .summary-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    margin-bottom: 36px;
    animation: fadeUp 0.4s ease 0.05s both;
  }

  .summary-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 18px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s, transform 0.2s;
    cursor: default;
  }

  .summary-card:hover {
    border-color: var(--border-strong);
    transform: translateY(-1px);
  }

  .summary-card::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 3px;
    border-radius: 0 0 var(--radius) var(--radius);
  }

  .summary-card.green::after { background: var(--accent-green); }
  .summary-card.amber::after { background: var(--accent-amber); }
  .summary-card.blue::after { background: var(--accent-blue); }
  .summary-card.neutral::after { background: var(--border-strong); }

  .summary-label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-tertiary);
    margin-bottom: 8px;
  }

  .summary-value {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    letter-spacing: -0.5px;
    line-height: 1;
    margin-bottom: 4px;
  }

  .summary-sub {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  /* â”€â”€ SECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .section-title {
    font-family: 'DM Serif Display', serif;
    font-size: 20px;
    letter-spacing: -0.3px;
  }

  .section-link {
    font-size: 12.5px;
    color: var(--text-tertiary);
    text-decoration: none;
    transition: color 0.15s;
    cursor: pointer;
  }

  .section-link:hover { color: var(--text-primary); }

  /* â”€â”€ TOPIC CARDS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .topics-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin-bottom: 36px;
    animation: fadeUp 0.4s ease 0.1s both;
  }

  .topic-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 22px 22px 18px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .topic-card:hover {
    border-color: var(--text-primary);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(26,24,20,0.07);
  }

  .topic-card-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .topic-icon-wrap {
    width: 40px; height: 40px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  /* Mastery ring */
  .mastery-ring {
    position: relative;
    width: 48px; height: 48px;
    flex-shrink: 0;
  }

  .mastery-ring svg { transform: rotate(-90deg); }
  .ring-track { fill: none; stroke: var(--border); stroke-width: 4; }
  .ring-fill {
    fill: none;
    stroke-width: 4;
    stroke-linecap: round;
    stroke-dasharray: 126;
    transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .ring-fill.green { stroke: var(--accent-green); }
  .ring-fill.amber { stroke: var(--accent-amber); }
  .ring-fill.blue { stroke: var(--accent-blue); }
  .ring-fill.empty { stroke: var(--border); }

  .ring-center {
    position: absolute;
    inset: 0;
    display: flex; align-items: center; justify-content: center;
    flex-direction: column;
  }

  .ring-pct {
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
  }

  .topic-name {
    font-family: 'DM Serif Display', serif;
    font-size: 18px;
    letter-spacing: -0.2px;
    margin-bottom: 4px;
  }

  .topic-count {
    font-size: 12.5px;
    color: var(--text-tertiary);
    margin-bottom: 14px;
  }

  /* Mini progress bar */
  .topic-progress-track {
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .topic-progress-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .topic-progress-fill.green { background: var(--accent-green); }
  .topic-progress-fill.amber { background: var(--accent-amber); }
  .topic-progress-fill.blue { background: var(--accent-blue); }
  .topic-progress-fill.empty { background: var(--border-strong); width: 0 !important; }

  .topic-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .topic-mastered {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .topic-mastered strong {
    color: var(--text-primary);
    font-weight: 600;
  }

  .topic-cta {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    gap: 3px;
    transition: color 0.15s;
  }

  .topic-card:hover .topic-cta { color: var(--text-primary); }

  /* "Start" card */
  .topic-card.start-card {
    background: var(--text-primary);
    border-color: var(--text-primary);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .topic-card.start-card .topic-name { color: white; }
  .topic-card.start-card .topic-count { color: rgba(255,255,255,0.5); }
  .topic-card.start-card .topic-mastered { color: rgba(255,255,255,0.5); }
  .topic-card.start-card .topic-mastered strong { color: white; }
  .topic-card.start-card .topic-cta { color: rgba(255,255,255,0.6); }
  .topic-card.start-card:hover .topic-cta { color: white; }
  .topic-card.start-card .topic-progress-track { background: rgba(255,255,255,0.15); }
  .topic-card.start-card .ring-track { stroke: rgba(255,255,255,0.15); }
  .topic-card.start-card .ring-pct { color: white; }

  /* â”€â”€ ACTIVITY + RECOMMENDED ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 36px;
    animation: fadeUp 0.4s ease 0.15s both;
  }

  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .panel-title {
    font-size: 13.5px;
    font-weight: 600;
  }

  .panel-label {
    font-size: 11px;
    color: var(--text-tertiary);
  }

  /* Activity heatmap */
  .activity-body { padding: 16px 20px; }

  .heatmap-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 4px;
    margin-bottom: 10px;
  }

  .heatmap-col { display: flex; flex-direction: column; gap: 4px; }

  .heat-cell {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 3px;
    background: var(--border);
    transition: background 0.2s;
    cursor: pointer;
    position: relative;
  }

  .heat-cell:hover::after {
    content: attr(data-tip);
    position: absolute;
    bottom: calc(100% + 4px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--text-primary);
    color: white;
    font-size: 10px;
    padding: 3px 7px;
    border-radius: 4px;
    white-space: nowrap;
    z-index: 10;
    pointer-events: none;
  }

  .heat-cell.l1 { background: #D1FAE5; }
  .heat-cell.l2 { background: #6EE7B7; }
  .heat-cell.l3 { background: #10B981; }
  .heat-cell.l4 { background: #065F46; }

  .heatmap-months {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 4px;
  }

  .month-label {
    font-size: 9px;
    color: var(--text-tertiary);
    text-align: center;
  }

  .heatmap-legend {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 10px;
    justify-content: flex-end;
  }

  .legend-label { font-size: 10px; color: var(--text-tertiary); }
  .legend-cell {
    width: 10px; height: 10px;
    border-radius: 2px;
    background: var(--border);
  }

  .legend-cell.l1 { background: #D1FAE5; }
  .legend-cell.l2 { background: #6EE7B7; }
  .legend-cell.l3 { background: #10B981; }
  .legend-cell.l4 { background: #065F46; }

  /* Recommended questions */
  .rec-list { }

  .rec-item {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    transition: background 0.15s;
  }

  .rec-item:last-child { border-bottom: none; }
  .rec-item:hover { background: var(--bg); }

  .rec-priority {
    width: 7px; height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 5px;
  }

  .rec-priority.high { background: var(--accent-red); }
  .rec-priority.mid { background: var(--accent-amber); }
  .rec-priority.low { background: var(--accent-green); }

  .rec-content { flex: 1; }

  .rec-q {
    font-size: 13.5px;
    font-weight: 500;
    line-height: 1.5;
    margin-bottom: 4px;
    color: var(--text-primary);
  }

  .rec-meta {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .rec-tag {
    font-size: 10.5px;
    padding: 2px 7px;
    border-radius: 4px;
    font-weight: 500;
  }

  .rec-tag.accounting { background: #EFF6FF; color: #2563EB; }
  .rec-tag.valuation { background: #F0FDF4; color: #16A34A; }
  .rec-tag.lbo { background: #FFF7ED; color: #C2410C; }
  .rec-tag.ma { background: #FDF4FF; color: #9333EA; }

  .rec-reason {
    font-size: 11px;
    color: var(--text-tertiary);
  }

  .rec-arrow {
    flex-shrink: 0;
    color: var(--text-tertiary);
    transition: color 0.15s;
    font-size: 14px;
    margin-top: 2px;
  }

  .rec-item:hover .rec-arrow { color: var(--text-primary); }

  /* â”€â”€ RECENT SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .recent-section {
    animation: fadeUp 0.4s ease 0.2s both;
    margin-bottom: 36px;
  }

  .session-row {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    transition: all 0.15s;
    margin-bottom: 8px;
  }

  .session-row:hover {
    border-color: var(--border-strong);
    transform: translateX(2px);
  }

  .session-date {
    font-size: 12px;
    color: var(--text-tertiary);
    width: 80px;
    flex-shrink: 0;
  }

  .session-topic {
    flex: 1;
  }

  .session-topic-name {
    font-size: 13.5px;
    font-weight: 500;
    margin-bottom: 2px;
  }

  .session-topic-sub {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .session-stats-row {
    display: flex;
    gap: 20px;
    flex-shrink: 0;
  }

  .session-stat {
    text-align: center;
  }

  .session-stat-val {
    font-family: 'DM Serif Display', serif;
    font-size: 18px;
    letter-spacing: -0.3px;
  }

  .session-stat-label {
    font-size: 10px;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .session-score-pill {
    padding: 5px 14px;
    border-radius: 99px;
    font-size: 13px;
    font-weight: 600;
    flex-shrink: 0;
  }

  .session-score-pill.high { background: #D1FAE5; color: #065F46; }
  .session-score-pill.mid { background: #FEF3C7; color: #92400E; }
  .session-score-pill.low { background: #FEE2E2; color: #991B1B; }

  /* â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 1100px) {
    .topics-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 900px) {
    .summary-bar { grid-template-columns: repeat(2, 1fr); }
    .two-col { grid-template-columns: 1fr; }
  }

  @media (max-width: 768px) {
    .sidebar { display: none; }
    .main { margin-left: 0; padding: 24px 20px; }
    .topics-grid { grid-template-columns: 1fr; }
    .summary-bar { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-mark">
      <svg viewBox="0 0 16 16" fill="none">
        <path d="M8 2L13 5V11L8 14L3 11V5L8 2Z" stroke="white" stroke-width="1.5" stroke-linejoin="round"/>
        <circle cx="8" cy="8" r="2" fill="white"/>
      </svg>
    </div>
    <span class="logo-name">Apex</span>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-section-label">Overview</div>
    <a class="nav-item active" href="dashboard.html">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Dashboard
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Performance
    </a>

    <div class="nav-section-label" style="margin-top:10px;">Practice</div>
    <a class="nav-item" href="practice-screen.html">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Practice
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>
      Saved Questions
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="user-card">
      <div class="user-avatar" id="userAvatar">?</div>
      <div>
        <div class="user-name" id="sidebarUserName">Loadingâ€¦</div>
        <div class="user-plan">Free plan Â· <a href="#" style="color:var(--accent-blue);text-decoration:none;font-size:11px;">Upgrade</a></div>
      </div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">

  <!-- GREETING -->
  <div class="greeting-row">
    <div class="greeting-text">
      <h1 id="greetingText">Good morning.</h1>
      <p id="greetingSubtext">Loading your progressâ€¦</p>
    </div>
    <div class="greeting-meta">
      <div class="streak-badge">
        <span class="fire">ðŸ”¥</span>
        <span id="streakText">â€” day streak</span>
      </div>
      <div class="today-goal" id="todayGoal">Loadingâ€¦</div>
    </div>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="summary-bar">
    <div class="summary-card green">
      <div class="summary-label">Questions Mastered</div>
      <div class="summary-value" id="statMastered">â€”</div>
      <div class="summary-sub" id="statMasteredSub">of 188 total</div>
    </div>
    <div class="summary-card amber">
      <div class="summary-label">Avg. Score</div>
      <div class="summary-value" id="statAvgScore">â€”<span style="font-size:16px;color:var(--text-tertiary)">/100</span></div>
      <div class="summary-sub" id="statAvgScoreSub">No sessions yet</div>
    </div>
    <div class="summary-card blue">
      <div class="summary-label">Weakest Area</div>
      <div class="summary-value" id="statWeakest" style="font-size:20px;padding-top:4px;">â€”</div>
      <div class="summary-sub" id="statWeakestSub">Based on your scores</div>
    </div>
    <div class="summary-card neutral">
      <div class="summary-label">Sessions</div>
      <div class="summary-value" id="statSessions">â€”</div>
      <div class="summary-sub" id="statSessionsSub">Total questions answered</div>
    </div>
  </div>

  <!-- TOPIC MASTERY -->
  <div class="section-header">
    <h2 class="section-title">Topic Mastery</h2>
    <span class="section-link">View all topics â†’</span>
  </div>

  <div class="topics-grid" id="topicsGrid">
    <!-- populated by JS -->
  </div>

  <!-- ACTIVITY + RECOMMENDED -->
  <div class="two-col">

    <!-- Activity heatmap -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Practice Activity</span>
        <span class="panel-label">Past 12 weeks</span>
      </div>
      <div class="activity-body">
        <div class="heatmap-grid" id="heatmap"></div>
        <div class="heatmap-months" id="heatmapMonths"></div>
        <div class="heatmap-legend">
          <span class="legend-label">Less</span>
          <div class="legend-cell"></div>
          <div class="legend-cell l1"></div>
          <div class="legend-cell l2"></div>
          <div class="legend-cell l3"></div>
          <div class="legend-cell l4"></div>
          <span class="legend-label">More</span>
        </div>
      </div>
    </div>

    <!-- Recommended questions -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Recommended for You</span>
        <span class="panel-label">Based on your gaps</span>
      </div>
      <div class="rec-list">
        <div class="rec-item" onclick="window.location='practice-screen.html'">
          <div class="rec-priority high"></div>
          <div class="rec-content">
            <div class="rec-q">Walk me through the cash flow statement from net income to FCF.</div>
            <div class="rec-meta">
              <span class="rec-tag accounting">Accounting</span>
              <span class="rec-reason">Missed 3x this week</span>
            </div>
          </div>
          <div class="rec-arrow">â†’</div>
        </div>
        <div class="rec-item">
          <div class="rec-priority high"></div>
          <div class="rec-content">
            <div class="rec-q">What's the difference between enterprise value and equity value?</div>
            <div class="rec-meta">
              <span class="rec-tag valuation">Valuation</span>
              <span class="rec-reason">Not yet attempted</span>
            </div>
          </div>
          <div class="rec-arrow">â†’</div>
        </div>
        <div class="rec-item">
          <div class="rec-priority mid"></div>
          <div class="rec-content">
            <div class="rec-q">Walk me through a DCF. What are its key limitations?</div>
            <div class="rec-meta">
              <span class="rec-tag valuation">Valuation</span>
              <span class="rec-reason">Scored 54 last time</span>
            </div>
          </div>
          <div class="rec-arrow">â†’</div>
        </div>
        <div class="rec-item">
          <div class="rec-priority low"></div>
          <div class="rec-content">
            <div class="rec-q">What are the main ways to value a company?</div>
            <div class="rec-meta">
              <span class="rec-tag valuation">Valuation</span>
              <span class="rec-reason">Good to reinforce</span>
            </div>
          </div>
          <div class="rec-arrow">â†’</div>
        </div>
      </div>
    </div>

  </div>

  <!-- RECENT SESSIONS -->
  <div class="recent-section">
    <div class="section-header">
      <h2 class="section-title">Recent Sessions</h2>
      <span class="section-link">View history â†’</span>
    </div>
    <div id="sessionsList">
      <!-- populated by JS -->
    </div>
  </div>

</main>

<script>
  // â”€â”€ TOPIC DEFINITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const TOPICS = [
    { key: 'Accounting',      label: 'Accounting',            total: 42 },
    { key: 'Enterprise_Value',label: 'Enterprise Value',      total: 12 },
    { key: 'Valuation',       label: 'Valuation',             total: 38 },
    { key: 'DCF',             label: 'DCF',                   total: 27 },
    { key: 'Mergers_MA',      label: 'Mergers & Acquisitions',total: 41 },
    { key: 'LBO',             label: 'Leveraged Buyouts',     total: 28 },
  ];
  const TOTAL_QS = TOPICS.reduce((s, t) => s + t.total, 0);

  // â”€â”€ GREETING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setGreeting(name) {
    const h = new Date().getHours();
    const period = h < 12 ? 'morning' : h < 17 ? 'afternoon' : 'evening';
    const first = name ? name.split(' ')[0] : '';
    document.getElementById('greetingText').textContent =
      `Good ${period}${first ? ', ' + first : ''}.`;
  }

  // â”€â”€ TOPIC CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildTopicCards(masteredByTopic) {
    const grid = document.getElementById('topicsGrid');
    grid.innerHTML = '';
    TOPICS.forEach(t => {
      const mastered = masteredByTopic[t.key] || 0;
      const pct = Math.round((mastered / t.total) * 100);
      const offset = Math.round(126 * (1 - pct / 100));
      const ringClass = pct >= 80 ? 'ring-fill high' : pct >= 40 ? 'ring-fill mid' : pct > 0 ? 'ring-fill low' : 'ring-fill empty';
      const barClass = pct > 0 ? 'topic-progress-fill' : 'topic-progress-fill empty';
      const cta = mastered === 0 ? 'Begin' : mastered === t.total ? 'Review' : 'Continue';

      const card = document.createElement('a');
      card.className = 'topic-card';
      card.href = `practice-screen.html?topic=${t.key}`;
      card.innerHTML = `
        <div class="topic-card-top">
          <div>
            <div class="topic-name">${t.label}</div>
            <div class="topic-count">${t.total} questions</div>
          </div>
          <div class="mastery-ring">
            <svg width="48" height="48" viewBox="0 0 48 48">
              <circle class="ring-track" cx="24" cy="24" r="20"/>
              <circle class="${ringClass}" cx="24" cy="24" r="20" style="stroke-dashoffset:${offset}"/>
            </svg>
            <div class="ring-center"><span class="ring-pct"${pct === 0 ? ' style="color:var(--text-tertiary)"' : ''}>${pct}%</span></div>
          </div>
        </div>
        <div class="topic-progress-track">
          <div class="${barClass}" style="width:${pct}%"></div>
        </div>
        <div class="topic-footer">
          <div class="topic-mastered"><strong>${mastered}</strong> / ${t.total} mastered</div>
          <div class="topic-cta">${cta} <span>â†’</span></div>
        </div>`;
      grid.appendChild(card);
    });
  }

  // â”€â”€ SESSION HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildSessionsList(history) {
    const el = document.getElementById('sessionsList');
    if (!history || history.length === 0) {
      el.innerHTML = `<div style="padding:24px;text-align:center;color:var(--text-tertiary);font-size:13px;">No sessions yet â€” start practicing to see your history here.</div>`;
      return;
    }
    // Group by day, show last 5 days of activity
    const byDay = {};
    history.forEach(s => {
      const d = new Date(s.created_at * 1000);
      const key = d.toISOString().slice(0, 10);
      if (!byDay[key]) byDay[key] = [];
      byDay[key].push(s);
    });

    const today = new Date().toISOString().slice(0, 10);
    const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);

    el.innerHTML = Object.entries(byDay).slice(0, 5).map(([date, sessions]) => {
      const avgScore = Math.round(sessions.reduce((s, r) => s + r.score, 0) / sessions.length);
      const mastered = sessions.filter(s => s.status === 'mastered').length;
      const scoreClass = avgScore >= 85 ? 'high' : avgScore >= 65 ? 'mid' : 'low';
      const topicCounts = {};
      sessions.forEach(s => { topicCounts[s.topic] = (topicCounts[s.topic] || 0) + 1; });
      const topTopic = Object.entries(topicCounts).sort((a,b) => b[1]-a[1])[0];
      const topicLabel = TOPICS.find(t => t.key === topTopic[0])?.label || topTopic[0];

      const d = new Date(date);
      const dayLabel = date === today ? 'Today' : date === yesterday ? 'Yesterday'
        : d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      const dayShort = date === today ? '' : date === yesterday ? ''
        : d.toLocaleDateString('en-US', { weekday: 'short' });

      return `<div class="session-row">
        <div class="session-date">${dayLabel}${dayShort ? `<br><span style="font-size:11px;color:var(--text-tertiary)">${dayShort}</span>` : ''}</div>
        <div class="session-topic">
          <div class="session-topic-name">${topicLabel}</div>
          <div class="session-topic-sub">${sessions.length} question${sessions.length !== 1 ? 's' : ''} answered</div>
        </div>
        <div class="session-stats-row">
          <div class="session-stat"><div class="session-stat-val">${avgScore}</div><div class="session-stat-label">Avg Score</div></div>
          <div class="session-stat"><div class="session-stat-val">${mastered}</div><div class="session-stat-label">Mastered</div></div>
        </div>
        <div class="session-score-pill ${scoreClass}">${avgScore}/100</div>
      </div>`;
    }).join('');
  }

  // â”€â”€ HEATMAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildHeatmap(activityData) {
    const heatmapEl = document.getElementById('heatmap');
    const monthsEl = document.getElementById('heatmapMonths');
    heatmapEl.innerHTML = '';
    monthsEl.innerHTML = '';

    // Build lookup: date -> questions_answered
    const actMap = {};
    (activityData || []).forEach(a => { actMap[a.date] = a.questions_answered; });

    // 12 weeks Ã— 7 days, ending today
    const now = new Date();
    const weeks = [];
    for (let w = 11; w >= 0; w--) {
      const week = [];
      for (let d = 6; d >= 0; d--) {
        const date = new Date(now);
        date.setDate(date.getDate() - (w * 7 + d));
        const key = date.toISOString().slice(0, 10);
        const count = actMap[key] || 0;
        const level = count === 0 ? 0 : count <= 3 ? 1 : count <= 7 ? 2 : count <= 12 ? 3 : 4;
        week.push({ level, count, date: key });
      }
      weeks.push(week);
    }

    weeks.forEach((week, wi) => {
      const col = document.createElement('div');
      col.className = 'heatmap-col';
      week.forEach(({ level, count, date }) => {
        const cell = document.createElement('div');
        cell.className = `heat-cell${level > 0 ? ` l${level}` : ''}`;
        const tip = count === 0 ? 'No questions' : `${count} question${count !== 1 ? 's' : ''}`;
        cell.setAttribute('data-tip', `${date}: ${tip}`);
        col.appendChild(cell);
      });
      heatmapEl.appendChild(col);
    });

    // Month labels
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    for (let i = 0; i < 12; i++) {
      const d = new Date(now);
      d.setDate(d.getDate() - (11 - i) * 7);
      const el = document.createElement('div');
      el.className = 'month-label';
      el.textContent = months[d.getMonth()];
      monthsEl.appendChild(el);
    }
  }

  // â”€â”€ SUMMARY STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildSummary(results, history, streak) {
    const mastered = results.filter(r => r.status === 'mastered').length;
    document.getElementById('statMastered').textContent = mastered;
    document.getElementById('statMasteredSub').textContent = `of ${TOTAL_QS} total`;

    if (history && history.length > 0) {
      const avgScore = Math.round(history.reduce((s, r) => s + r.score, 0) / history.length);
      document.getElementById('statAvgScore').innerHTML = `${avgScore}<span style="font-size:16px;color:var(--text-tertiary)">/100</span>`;
      document.getElementById('statAvgScoreSub').textContent = `Across ${history.length} answers`;

      // Weakest topic = lowest avg score among topics with â‰¥3 attempts
      const topicScores = {};
      history.forEach(s => {
        if (!topicScores[s.topic]) topicScores[s.topic] = [];
        topicScores[s.topic].push(s.score);
      });
      const weakest = Object.entries(topicScores)
        .filter(([, scores]) => scores.length >= 3)
        .map(([topic, scores]) => ({ topic, avg: scores.reduce((a,b)=>a+b,0)/scores.length }))
        .sort((a,b) => a.avg - b.avg)[0];
      if (weakest) {
        const label = TOPICS.find(t => t.key === weakest.topic)?.label || weakest.topic;
        document.getElementById('statWeakest').textContent = label;
        document.getElementById('statWeakestSub').textContent = `Avg score: ${Math.round(weakest.avg)}/100`;
      } else {
        document.getElementById('statWeakest').textContent = 'â€”';
        document.getElementById('statWeakestSub').textContent = 'Answer 3+ questions per topic';
      }

      const totalSessions = new Set(history.map(s => new Date(s.created_at * 1000).toISOString().slice(0,10))).size;
      document.getElementById('statSessions').textContent = totalSessions;
      document.getElementById('statSessionsSub').textContent = `${history.length} total answers`;
    }

    // Streak
    document.getElementById('streakText').textContent = `${streak || 0}-day streak`;

    // Subtext
    const todayCount = (history || []).filter(s => {
      const d = new Date(s.created_at * 1000).toISOString().slice(0,10);
      return d === new Date().toISOString().slice(0,10);
    }).length;
    document.getElementById('greetingSubtext').textContent = todayCount > 0
      ? `${todayCount} question${todayCount !== 1 ? 's' : ''} answered today. Keep going.`
      : `Ready to practice? Pick a topic below.`;
    document.getElementById('todayGoal').textContent = `${todayCount} answered today`;
  }

  // â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    const token = localStorage.getItem('apex_token');
    const name = localStorage.getItem('apex_user');

    // Set user identity immediately from localStorage
    if (name) {
      setGreeting(name);
      const initials = name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
      document.getElementById('userAvatar').textContent = initials;
      document.getElementById('sidebarUserName').textContent = name;
    } else {
      setGreeting('');
    }

    // Build empty state immediately so page isn't blank
    buildTopicCards({});
    buildHeatmap([]);
    buildSummary([], [], 0);
    buildSessionsList([]);

    // Fetch live progress if logged in
    if (token) {
      try {
        const res = await fetch('/api/progress/load', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (res.ok) {
          const data = await res.json();

          // Build mastered count per topic
          const masteredByTopic = {};
          (data.results || []).forEach(r => {
            if (r.status === 'mastered') {
              masteredByTopic[r.topic] = (masteredByTopic[r.topic] || 0) + 1;
            }
          });

          buildTopicCards(masteredByTopic);
          buildHeatmap(data.activity || []);
          buildSummary(data.results || [], data.history || [], data.streak || 0);
          buildSessionsList(data.history || []);
        }
      } catch(e) {
        console.log('Progress load error:', e.message);
      }
    }

    // Animate rings after render
    setTimeout(() => {
      document.querySelectorAll('.ring-fill').forEach(ring => {
        const target = ring.style.strokeDashoffset;
        ring.style.strokeDashoffset = '126';
        setTimeout(() => { ring.style.strokeDashoffset = target; }, 50);
      });
      document.querySelectorAll('.topic-progress-fill').forEach(bar => {
        const target = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => { bar.style.width = target; }, 50);
      });
    }, 100);
  }

  init();
</script>

</body>
</html>
